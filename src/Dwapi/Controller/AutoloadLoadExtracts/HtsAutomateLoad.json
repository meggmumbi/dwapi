{
    "loadHtsFromEmrCommand": {
        "extracts": [
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsClient",
                    "display": "Hts Clients",
                    "extractSql": "SELECT  distinct d.patient_id as PatientPK,\r\n\t                d.national_unique_patient_identifier                              as NUPI,\r\n                    pkv.PKV                                                           as Pkv,                  \r\n                    \r\n\t(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n\t'KenyaEMR' as Emr,\r\n\t'Kenya HMIS II' AS Project,\r\n\tid.identifier AS HtsNumber,\r\n\td.hts_recency_id as HtsRecencyId,\r\n\td.DOB,\r\n\tcase when d.Gender='M' then 'Male' else 'Female' end as Gender,\r\n\td.marital_status as MaritalStatus,\r\n\td.occupation as Occupation,\r\n\tt.population_type as PopulationType,\r\n\tt.key_population_type as KeyPopulationType,\r\n\tt.priority_population_type as PriorityPopulationType,\r\n\tt.disability_type as PatientDisabled,\r\n\tA.county_district as County,\r\n\tA.state_province as SubCounty,\r\n\tA.address4 as Ward\r\nFROM\r\nkenyaemr_etl.etl_patient_demographics  d\r\nINNER JOIN\r\nkenyaemr_etl.etl_hts_test t ON d.patient_id=t.patient_id\r\ninner join (select x.patient_id as patient_id,\r\nx.sxFirstName,\r\nx.sxLastname,\r\nx.sxMiddleName,\r\nx.dmFirstName,\r\nx.dmLastName,\r\nx.dmMiddleName,\r\nx.Gender,\r\nx.DOB,\r\nCASE\r\nWHEN locate(';', dmLastName) > 0 THEN CONCAT(\r\nCAST(LEFT(Gender, 1) AS CHAR CHARACTER SET utf8),\r\nCAST(sxFirstName AS CHAR CHARACTER SET utf8), CAST(\r\nSUBSTRING(dmLastName, locate(';', dmLastName) + 1, LENGTH(dmLastName))\r\nAS\r\nCHAR CHARACTER SET utf8),\r\nCAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n)\r\nELSE CONCAT(\r\nCAST(LEFT(Gender, 1)AS CHAR CHARACTER SET utf8),\r\nCAST(sxFirstName AS CHAR CHARACTER SET utf8),\r\nCAST(dmLastName AS CHAR CHARACTER SET utf8),\r\nCAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n)\r\nEND      AS PKV\r\nfrom (SELECT patient_id,\r\nSOUNDEX(UPPER(REPLACE(given_name, '0', 'O')))                           AS sxFirstName,\r\nSOUNDEX(UPPER(REPLACE(family_name, '0', 'O')))                          AS sxLastName,\r\nSOUNDEX(UPPER(REPLACE(middle_name, '0', 'O')))                          AS sxMiddleName,\r\nfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(given_name, '0', 'O')))  AS dmFirstName,\r\nfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(family_name, '0', 'O'))) AS dmLastName,\r\nfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(middle_name, '0', 'O'))) AS dmMiddleName,\r\nGender,\r\nDOB\r\nFROM kenyaemr_etl.etl_patient_demographics)x)pkv on pkv.patient_id = d.patient_id\r\nLEFT JOIN location_attribute SC ON SC.location_id = t.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n  location SN ON SN.location_id =t.encounter_location\r\nLEFT JOIN person_address A ON A.person_id=d.patient_id\r\nLEFT JOIN patient_identifier id ON id.patient_id = t.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')\r\ngroup by d.patient_id",
                    "rank": 1,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsClientsExtract",
                    "tempTableName": "TempHtsClientsExtract",
                    "id": "8578ad00-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 1013,
                        "loaded": 1013,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 1013,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsClientTests",
                    "display": "Hts Client Tests",
                    "extractSql": "SELECT\r\n                    t.patient_id as PatientPK,                    \r\n                    (select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n                    (select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n                    'KenyaEMR' as Emr,\r\n                    'Kenya HMIS II' AS Project,\r\n                    demographics.openmrs_id  AS HtsNumber,\r\n                    t.encounter_id as EncounterId,\r\n                    t.visit_date as TestDate,\r\n                    t.ever_tested_for_hiv as EverTestedForHiv,\r\n                    t.months_since_last_test as MonthsSinceLastTest,\r\n                    t.client_tested_as as ClientTestedAs,\r\n                    case t.hts_entry_point\r\n                    when 5485 then 'In Patient Department(IPD)'\r\n                    when 160542 then 'Out Patient Department(OPD)'\r\n                    when 162181 then 'Peadiatric Clinic'\r\n                    when 160552 then 'Nutrition Clinic'\r\n                    when 160538 then 'PMTCT ANC'\r\n                    when 160456 then 'PMTCT MAT'\r\n                    when 1623 then 'PMTCT PNC'\r\n                    when 160541 then 'TB'\r\n                    when 162050 then 'CCC'\r\n                    when 159940 then 'VCT'\r\n                    when 159938 then 'Home Based Testing'\r\n                    when 159939 then 'Mobile Outreach'\r\n                    when 162223 then 'VMMC'\r\n                    when 160546 then 'STI Clinic'\r\n                    when 160522 then 'Emergency'\r\n                    when 163096 then 'Community Testing'\r\n                    when 5622 then 'Other' end                                    as EntryPoint,\r\n                    case t.test_strategy\r\n                    when 164163 then 'HP: Hospital Patient Testing'\r\n                    when 164953 then 'NP: HTS for non-patients'\r\n                    when 164954 then 'VI:Integrated VCT Center'\r\n                    when 164955 then 'VS:Stand Alone VCT Center'\r\n                    when 159938 then 'HB:Home Based Testing'\r\n                    when 159939 then 'MO: Mobile Outreach HTS'\r\n                    when 161557 then 'Index testing'\r\n                    when 166606 then 'SNS - Social Networks'\r\n                    when 5622 then 'O:Other'\r\n                    end                                                           as TestStrategy,\r\n                    t.test_1_result                                                   as TestResult1,\r\n                    t.approach as Approach,\r\n                    t.setting as Setting,\r\n                    t.test_2_result                                                   as TestResult2,\r\n                    t.final_test_result                                               as FinalTestResult,\r\n                    t.patient_given_result                                            as PatientGivenResult,\r\n                    t.tb_screening                                                    as TbScreening,\r\n                    t.patient_had_hiv_self_test                                       as ClientSelfTested,\r\n                    t.couple_discordant                                               as CoupleDiscordant,\r\n                    CASE t.test_type\r\n                    WHEN 1 THEN 'Initial'\r\n                    WHEN 2 THEN 'Repeat'\r\n                    END                                                           AS TestType,\r\n                    t.patient_consented                                               as Consent,\r\n                    t.hts_risk_category                                               as HtsRiskCategory,\r\n                    t.hts_risk_score                                                  as HtsRiskScore,\r\n                    t.date_created                                                    as Date_Created,\r\n                    t.date_last_modified                                              as Date_Last_Modified\r\n                    FROM kenyaemr_etl.etl_hts_test t\r\n                    inner join kenyaemr_etl.etl_patient_demographics demographics on t.patient_id = demographics.patient_id",
                    "rank": 2,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsClientTests",
                    "tempTableName": "TempHtsClientTestsExtract",
                    "id": "8578afbc-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 1150,
                        "loaded": 1150,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 1150,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsPartnerNotificationServices",
                    "display": "Hts Partner Notification Services",
                    "extractSql": "SELECT\r\nDISTINCT\r\n               t.patient_id AS PatientPK,\r\n               (select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n               (select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n               'KenyaEMR' as Emr,\r\n               'Kenya HMIS II' AS Project,\r\n               id.identifier AS HtsNumber,\r\n               ohpc.patient_id AS PartnerPatientPk,\r\n               ohpc.id AS PartnerPersonId,\r\n    YEAR(ohpc.date_created)-YEAR(ohpc.birth_date)  AS Age,\r\n               ohpc.sex,\r\n               CASE ohpc.relationship_type\r\n                                              WHEN 970          THEN  'parent (Mother)'\r\n                                              WHEN 971           THEN  'parent(Father)'\r\n                                              WHEN 972          THEN  'sibling'\r\n                                              WHEN 1528        THEN  'Child'\r\n                                              WHEN 5617          THEN  'spouse'\r\n            WHEN 163565  THEN  'partner'\r\n                                              WHEN 162221  THEN  'cowife'\r\n               END     AS RelationsipToIndexClient,\r\n\r\n    /*Screened for IPV? CASE?*/\r\n               CASE WHEN ohpc.ipv_outcome IS NOT NUll THEN 'Yes' ELSE 'No' END AS  ScreenedForIpv,\r\n\r\n               ohpc.ipv_outcome AS IpvScreeningOutcome,\r\n               CASE ohpc.living_with_patient\r\n                               WHEN 1065 THEN 'Yes'\r\n                               WHEN 1066 THEN 'No'\r\n               END AS CurrentlyLivingWithIndexClient,\r\n    /*knowledgeof HIV Status*/\r\n    ohpc.baseline_hiv_status as KnowledgeOfHivStatus,\r\n\r\npnsApprocah.name AS  PnsApproach,\r\nohpc.consented_contact_listing as  PnsConsent,\r\ncase when ctrace.status is null then 'N' else 'Y' end as LinkedToCare,\r\nctrace.encounter_date as  LinkDateLinkedToCare,\r\nctrace.unique_patient_no as CccNumber,\r\nctrace.facility_linked_to as FacilityLinkedTo,\r\nohpc.birth_date as DoB,\r\nohpc.date_created as DateElicited ,\r\nmarital.name as  MaritalStatus\r\n\r\n\r\n  FROM\r\n               kenyaemr_etl.etl_hts_test t\r\nINNER JOIN\r\n        kenyaemr_hiv_testing_patient_contact ohpc ON ohpc.patient_related_to=t.patient_id\r\nLEFT JOIN\r\n                location_attribute SC ON SC.location_id = t.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n  location SN ON SN.location_id =t.encounter_location\r\n  LEFT JOIN\r\n               patient_identifier id ON id.patient_id = t.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')\r\nleft JOIN patient openmrs ON  openmrs.patient_id = id.patient_id\r\nleft JOIN kenyaemr_hiv_testing_client_trace ctrace ON  ctrace.client_id = ohpc.id and ctrace.status='Contacted and Linked'\r\nleft join concept_name marital ON marital.concept_id = ohpc.marital_status and marital.locale='en' and marital.concept_name_type = 'FULLY_SPECIFIED'\r\nleft join concept_name pnsApprocah ON pnsApprocah.concept_id = ohpc.pns_approach and pnsApprocah.locale='en' and pnsApprocah.concept_name_type = 'FULLY_SPECIFIED'\r\n ",
                    "rank": 7,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsPartnerNotificationServices",
                    "tempTableName": "TempHtsPartnerNotificationServicesExtract",
                    "id": "8578c042-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 9,
                        "loaded": 9,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 9,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsTestKits",
                    "display": "Hts Test Kits",
                    "extractSql": "SELECT\r\n    t.patient_id AS PatientPK,    \r\n\t(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n\t'KenyaEMR' as Emr,\r\n\t'Kenya HMIS II' AS Project,\r\n    id.identifier AS HtsNumber,\r\n\tt.encounter_id AS EncounterId,\r\n\tt.test_1_kit_name AS TestKitName1,\r\n\tt.test_1_kit_lot_no AS TestKitLotNumber1,\r\n\tt.test_1_kit_expiry as TestKitExpiry1,\r\n\tt.test_1_result as TestResult1,\r\n\tt.test_2_kit_name as TestKitName2,\r\n\tt.test_2_kit_lot_no as TestKitLotNumber2,\r\n\tt.test_2_kit_expiry as TestKitExpiry2,\r\n\tt.test_2_result as TestResult2,\r\n\tt.syphillis_test_result as SyphilisResult,\r\n\tt.date_created as Date_Created,\r\n    t.date_last_modified as Date_Last_Modified\r\nFROM\r\n\tkenyaemr_etl.etl_hts_test t\r\ninner join\r\n\tkenyaemr_etl.etl_patient_demographics demographics on t.patient_id=demographics.patient_id\r\nLEFT JOIN\r\n\t location_attribute SC ON SC.location_id = t.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n  location SN ON SN.location_id =t.encounter_location\r\nLEFT JOIN patient_identifier id ON id.patient_id = t.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')",
                    "rank": 4,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsTestKits",
                    "tempTableName": "TempHtsTestKitsExtract",
                    "id": "8578b700-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 1152,
                        "loaded": 1152,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 1152,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsClientLinkage",
                    "display": "Hts Client Linkage",
                    "extractSql": "select distinct a.patient_id as PatientPK,\r\n(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n'KenyaEMR' as Emr,\r\n'Kenya HMIS II' AS Project,\r\nid.identifier AS HtsNumber,\r\nref.date_to_enrol as DatePrefferedToBeEnrolled,\r\nref.facility_referred_to as FacilityReferredTo,\r\na.provider_handed_to as HandedOverTo,\r\nNULL HandedOverToCadre,\r\na.facility_linked_to as EnrolledFacilityName,\r\nref.visit_date as ReferralDate,\r\na.enrollment_date as DateEnrolled,\r\na.ccc_number as ReportedCCCNumber,\r\na.art_start_date as ReportedStartARTDate\r\nfrom (SELECT Distinct patient_id, encounter_id,ccc_number,enrollment_date,\r\nart_start_date,provider_handed_to,facility_linked_to,encounter_location FROM\r\n(SELECT DISTINCT htsrl.patient_id, encounter_id,ccc_number,enrollment_date,\r\nart_start_date,provider_handed_to,facility_linked_to,encounter_location\r\nFROM kenyaemr_etl.etl_hts_referral_and_linkage htsrl\r\nUNION ALL\r\nSELECT DISTINCT t.patient_id,t.encounter_id,unique_patient_no ccc_number,e.visit_date DateEnrolled,\r\nar.art_start_date,provider_handed_to,facility_linked_to,t.encounter_location\r\nFROM kenyaemr_etl.etl_hts_test t\r\nINNER JOIN kenyaemr_etl.etl_patient_demographics pt ON pt.patient_id=t.patient_id AND pt.voided=0\r\nINNER JOIN kenyaemr_etl.etl_hiv_enrollment e ON e.patient_id=t.patient_id AND e.voided=0\r\nLEFT JOIN kenyaemr_etl.etl_hts_referral_and_linkage l ON l.patient_id=t.patient_id\r\nLEFT JOIN (SELECT patient_id,min(date_started) as art_start_date FROM kenyaemr_etl.etl_drug_event\r\ngroup by patient_id)ar on ar.patient_id=t.patient_id\r\nWHERE t.test_type = 1 AND t.final_test_result='Positive' AND t.voided=0 AND l.patient_id IS NULL)a\r\n) a\r\nleft join kenyaemr_etl.etl_hts_referral ref on a.patient_id=ref.patient_id\r\nLEFT JOIN location_attribute SC ON (SC.location_id = a.encounter_location or SC.location_id=ref.encounter_location ) AND SC.attribute_type_id=1\r\nLEFT JOIN location SN ON (SN.location_id =a.encounter_location or SN.location_id =ref.encounter_location )\r\nLEFT JOIN patient_identifier id ON (id.patient_id = a.patient_id or id.patient_id = ref.patient_id ) AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')\r\nLEFT JOIN kenyaemr_etl.etl_hiv_enrollment EN ON EN.patient_id =a.patient_id\r\nwhere a.patient_id in (select patient_id from kenyaemr_etl.etl_hts_test)",
                    "rank": 3,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsClientLinkage",
                    "tempTableName": "TempHtsClientsLinkageExtract",
                    "id": "8578b21e-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 54,
                        "loaded": 54,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 54,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsPartnerTracing",
                    "display": "Hts Partner Tracing",
                    "extractSql": "select distinct\r\nt.patient_id as PatientPK,\r\nid.identifier as HtsNumber,\r\nclient_id as PartnerPersonId,\r\ncontact_type as TraceType,\r\nencounter_date as TraceDate,\r\n(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n'KenyaEMR' as Emr,\r\n'Kenya HMIS II' AS Project,\r\nstatus as TraceOutcome,\r\ntc.appointment_date as BookingDate\r\nfrom\r\n\tkenyaemr_hiv_testing_patient_contact pc\r\ninner join\r\n\tkenyaemr_etl.etl_hts_test t on pc.patient_related_to=t.patient_id\r\ninner join\r\n\tkenyaemr_hiv_testing_client_trace tc on pc.id=tc.client_id\r\nLEFT JOIN\r\n\tpatient_identifier id ON id.patient_id = t.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\n\tfrom patient_identifier_type where name='OpenMRS ID')\r\nLEFT JOIN\r\n\t location_attribute SC ON SC.location_id = t.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n\tlocation SN ON SN.location_id =t.encounter_location; ",
                    "rank": 6,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsPartnerTracing",
                    "tempTableName": "TempHtsPartnerTracingExtract",
                    "id": "8578bbba-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsClientTracing",
                    "display": "Hts Client Tracing",
                    "extractSql": "SELECT\r\n\tht.patient_id as PatientPK,\r\n\t(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n\thtsrl.tracing_type as TracingType,\r\n\thtsrl.visit_date as TracingDate,\r\n\t'KenyaEMR' as Emr,\r\n\t'Kenya HMIS II' AS Project,\r\n\tid.identifier AS HtsNumber,\r\n\thtsrl.tracing_status as TracingOutcome\r\nFROM\r\n\tkenyaemr_etl.etl_hts_test ht\r\nINNER JOIN\r\n\tkenyaemr_etl.etl_hts_test t ON ht.patient_id=t.patient_id\r\nLEFT  JOIN\r\n\tkenyaemr_etl.etl_hts_referral_and_linkage htsrl  ON ht.patient_id=htsrl.patient_id\r\nLEFT JOIN\r\n  location SN ON SN.location_id =htsrl.encounter_location\r\nLEFT JOIN\r\n\t location_attribute SC ON SC.location_id = htsrl.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n patient_identifier id ON id.patient_id = htsrl.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')\r\n WHERE SC.value_reference IS NOT NULL",
                    "rank": 5,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsClientTracing",
                    "tempTableName": "TempHtsClientTracingExtract",
                    "id": "8578b962-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 173,
                        "loaded": 173,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 173,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsEligibilityExtract",
                    "display": "Hts Eligibility Screening",
                    "extractSql": "SELECT t.patient_id as PatientPK,\r\n                            (select siteCode from kenyaemr_etl.etl_default_facility_info)               as SiteCode,\r\n                            (select FacilityName from kenyaemr_etl.etl_default_facility_info)           as FacilityName,\r\n                            'KenyaEMR'                                                                  as Emr,\r\n                            'Kenya HMIS II'                                                             as Project,\r\n                            demographics.openmrs_id                                                     as HtsNumber,\r\n                            t.visit_id                                                                  as VisitID,\r\n                            t.encounter_id                                                              as EncounterId,\r\n                            t.visit_date                                                                as VisitDate,\r\n                            '' as ForcedSex,                          \r\n                            case t.population_type\r\n                                when 164928 then 'General Population'\r\n                                when 164929 then 'Key Population'\r\n                                when 138643\r\n                                    then 'Priority Population' end                                      as PopulationType,\r\n                            t.key_population_type                                                       as KeyPopulation,\r\n                            t.priority_population_type                                                  as PriorityPopulation,\r\n                            case t.department\r\n                                when 160542 then 'OPD:Out-patient department'\r\n                                when 5485 then 'IPD:In-patient department'\r\n                                when 160473 then 'Emergency'\r\n                                when 160538 then 'PMTCT'\r\n                                when 159940\r\n                                    then 'VCT' end                                                      as Department,\r\n                            case t.patient_type\r\n                                when 164163 then 'HP:Hospital Patient'\r\n                                when 164953\r\n                                    then 'NP:Non-Hospital Patient' end                                  as PatientType,\r\n                            case t.is_health_worker when 1065 then 'Yes' when 1066 then 'No' end        as IsHealthWorker,\r\n                            t.relationship_with_contact                                                 as RelationshipWithContact,\r\n                            \tcase t.mother_hiv_status when 703 then 'Positive' when 664 then 'Negative' when 1067 then 'Unknown' end as MothersStatus,\r\n                            case t.tested_hiv_before when 1065 then 'Yes' when 1066 then 'No' end       as TestedHIVBefore,\r\n                            case t.who_performed_test\r\n                                when 5619 then 'HTS Provider'\r\n                                when 164952\r\n                                    then 'Self Tested' end                                              as WhoPerformedTest,\r\n                            (case t.test_results\r\n                                 when 703 then 'Positive'\r\n                                 when 664 then 'Negative'\r\n                                 when 1067 then 'Unknown'\r\n                                 else '' end)                                                           as ResultOfHIV,\r\n                            if(t.who_performed_test = 164952,t.date_tested,null)                             as DateTestedSelf,\t\r\n                            if(t.who_performed_test = 164952,case t.test_results\t\r\n                            when 703 then 'Positive'\t\r\n                            when 664 then 'Negative'\t\r\n                            when 1067 then 'Unknown'\t\r\n                            else '' end,null)                                                           as ResultOfHIVSelf,\t\r\n                            if(t.who_performed_test = 5619,t.date_tested, null)                             as DateTestedProvider,\r\n                            case t.started_on_art when 1065 then 'Yes' when 1066 then 'No' end          as StartedOnART,\r\n                            t.upn_number                                                                as CCCNumber,\r\n                            case t.ever_had_sex when 1 then 'Yes' when 2 then 'No' end                  as EverHadSex,\r\n                            case t.sexually_active when 1065 then 'Yes' when 1066 then 'No' end         as SexuallyActive,\r\n                            case t.new_partner when 1065 then 'Yes' when 1066 then 'No' end             as NewPartner,\r\n                            (case t.partner_hiv_status\r\n                                 when 703 then 'Positive'\r\n                                 when 664 then 'Negative'\r\n                                 when 1067 then 'Unknown'\r\n                                 else '' end)                                                           as PartnerHIVStatus,\r\n                            case t.couple_discordant when 1065 then 'Yes' when 1066 then 'No' end       as CoupleDiscordant,\r\n                            case t.multiple_partners when 1 then 'Yes' when 0 then 'No' end             as MultiplePartners,\r\n                            t.number_partners                                                           as NumberOfPartners,\r\n                            case t.alcohol_sex\r\n                                when 1066 then 'Not at all'\r\n                                when 1385 then 'Sometimes'\r\n                                when 165027\r\n                                    then 'Always' end                                                   as AlcoholSex,\r\n                            case t.money_sex when 1065 then 'Yes' when 1066 then 'No' end               as MoneySex,\r\n                            case t.condom_burst when 1065 then 'Yes' when 1066 then 'No' end            as CondomBurst,\r\n                            case t.unknown_status_partner when 1065 then 'Yes' when 1066 then 'No' end  as UnknownStatusPartner,\r\n                            case t.known_status_partner when 163289 then 'Yes' when 1066 then 'No' end  as KnownStatusPartner,\r\n                            case t.pregnant when 1065 then 'Yes' when 1066 then 'No' end                as Pregnant,\r\n                            case t.breastfeeding_mother when 1065 then 'Yes' when 1066 then 'No' end    as BreastfeedingMother,\r\n                            case t.experienced_gbv when 1065 then 'Yes' when 1066 then 'No' end         as ExperiencedGBV,\r\n                            t.type_of_gbv                                                               as TypeGBV,\t\r\n                            t.service_received                                                          as ReceivedServices,\r\n                            case t.currently_on_prep when 1065 then 'Yes' when 1066 then 'No' end       as CurrentlyOnPrEP,\r\n                            \tcase t.recently_on_pep when 1 then 'Yes' when 0 then 'No' end              as CurrentlyOnPEP,\r\n                            case t.recently_had_sti when 1065 then 'Yes' when 1066 then 'No' end       as CurrentlyHasSTI,\r\n                            case t.tb_screened when 1065 then 'Yes' when 1066 then 'No' end  ScreenedTB,\t\r\n                            case t.cough when 159799 then 'Yes' when 1066 then 'No' end as Cough,\t\r\n                            case t.fever when 1494 then 'Yes' when 1066 then 'No' end as Fever,\t\r\n                            case t.weight_loss when 832 then 'Yes' when 1066 then 'No' end as WeightLoss,\t\r\n                            case t.night_sweats when 133027 then 'Yes' when 1066 then 'No' end as NightSweats,\t\r\n                            case t.contact_with_tb_case when 124068 then 'Yes' when 1066 then 'No' end as ContactWithTBCase,\t\r\n                            case t.lethargy when 116334 then 'Yes' when 1066 then 'No' end as Lethargy,\t\r\n                            case t.tb_status when 1660 then 'No TB signs' when 142177 then 'Presumed TB' when 1662 then 'TB Confirmed' end as TBStatus,\r\n                            case t.shared_needle when 1065 then 'Yes' when 1066 then 'No' end           as SharedNeedle,\r\n                            case t.needle_stick_injuries when 153574 then 'Yes' when 1066 then 'No' end as NeedleStickInjuries,\r\n                            case t.traditional_procedures when 1065 then 'Yes' when 1066 then 'No' end  as TraditionalProcedures,\r\n                            t.child_reasons_for_ineligibility                                           as ChildReasonsForIneligibility,\r\n                            \t''                                                                          as AssessmentOutcome,\r\n                            case t.eligible_for_test when 1065 then 'Yes' when 1066 then 'No' end       as EligibleForTest,\r\n                            \tt.reasons_for_ineligibility as ReasonsForIneligibility,\t\r\n                            t.specific_reason_for_ineligibility                                         as SpecificReasonForIneligibility,\t\r\n                            case t.referred_for_testing when 1065 then 'Yes' when 1066 then 'No' end    as ReferredForTesting,\r\n                            t.date_created                                                              as DateCreated,\r\n                            t.date_last_modified                                                        as DateLastModified\r\n                     FROM kenyaemr_etl.etl_hts_eligibility_screening t\r\n                              inner join kenyaemr_etl.etl_patient_demographics demographics on t.patient_id = demographics.patient_id\r\n                              LEFT JOIN openmrs.location_attribute SC ON SC.location_id = t.location_id AND SC.attribute_type_id = 1\r\n                              LEFT JOIN openmrs.location SN ON SN.location_id = t.location_id group by t.encounter_id",
                    "rank": 8,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsEligibilityExtract",
                    "tempTableName": "TempHtsEligibilityExtract",
                    "id": "7bb8b081-c206-49ba-aac0-48bf14fdc84e",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 339,
                        "loaded": 332,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 332,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsClient",
                    "display": "Hts Clients",
                    "extractSql": "SELECT  distinct d.patient_id as PatientPK,\r\n\t                d.national_unique_patient_identifier                              as NUPI,\r\n                    pkv.PKV                                                           as Pkv,                  \r\n                    \r\n\t(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n\t'KenyaEMR' as Emr,\r\n\t'Kenya HMIS II' AS Project,\r\n\tid.identifier AS HtsNumber,\r\n\td.hts_recency_id as HtsRecencyId,\r\n\td.DOB,\r\n\tcase when d.Gender='M' then 'Male' else 'Female' end as Gender,\r\n\td.marital_status as MaritalStatus,\r\n\td.occupation as Occupation,\r\n\tt.population_type as PopulationType,\r\n\tt.key_population_type as KeyPopulationType,\r\n\tt.priority_population_type as PriorityPopulationType,\r\n\tt.disability_type as PatientDisabled,\r\n\tA.county_district as County,\r\n\tA.state_province as SubCounty,\r\n\tA.address4 as Ward\r\nFROM\r\nkenyaemr_etl.etl_patient_demographics  d\r\nINNER JOIN\r\nkenyaemr_etl.etl_hts_test t ON d.patient_id=t.patient_id\r\ninner join (select x.patient_id as patient_id,\r\nx.sxFirstName,\r\nx.sxLastname,\r\nx.sxMiddleName,\r\nx.dmFirstName,\r\nx.dmLastName,\r\nx.dmMiddleName,\r\nx.Gender,\r\nx.DOB,\r\nCASE\r\nWHEN locate(';', dmLastName) > 0 THEN CONCAT(\r\nCAST(LEFT(Gender, 1) AS CHAR CHARACTER SET utf8),\r\nCAST(sxFirstName AS CHAR CHARACTER SET utf8), CAST(\r\nSUBSTRING(dmLastName, locate(';', dmLastName) + 1, LENGTH(dmLastName))\r\nAS\r\nCHAR CHARACTER SET utf8),\r\nCAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n)\r\nELSE CONCAT(\r\nCAST(LEFT(Gender, 1)AS CHAR CHARACTER SET utf8),\r\nCAST(sxFirstName AS CHAR CHARACTER SET utf8),\r\nCAST(dmLastName AS CHAR CHARACTER SET utf8),\r\nCAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n)\r\nEND      AS PKV\r\nfrom (SELECT patient_id,\r\nSOUNDEX(UPPER(REPLACE(given_name, '0', 'O')))                           AS sxFirstName,\r\nSOUNDEX(UPPER(REPLACE(family_name, '0', 'O')))                          AS sxLastName,\r\nSOUNDEX(UPPER(REPLACE(middle_name, '0', 'O')))                          AS sxMiddleName,\r\nfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(given_name, '0', 'O')))  AS dmFirstName,\r\nfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(family_name, '0', 'O'))) AS dmLastName,\r\nfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(middle_name, '0', 'O'))) AS dmMiddleName,\r\nGender,\r\nDOB\r\nFROM kenyaemr_etl.etl_patient_demographics)x)pkv on pkv.patient_id = d.patient_id\r\nLEFT JOIN location_attribute SC ON SC.location_id = t.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n  location SN ON SN.location_id =t.encounter_location\r\nLEFT JOIN person_address A ON A.person_id=d.patient_id\r\nLEFT JOIN patient_identifier id ON id.patient_id = t.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')\r\ngroup by d.patient_id",
                    "rank": 1,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsClientsExtract",
                    "tempTableName": "TempHtsClientsExtract",
                    "id": "8578ad00-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 1013,
                        "loaded": 1013,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 1013,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsClientTests",
                    "display": "Hts Client Tests",
                    "extractSql": "SELECT\r\n                    t.patient_id as PatientPK,                    \r\n                    (select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n                    (select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n                    'KenyaEMR' as Emr,\r\n                    'Kenya HMIS II' AS Project,\r\n                    demographics.openmrs_id  AS HtsNumber,\r\n                    t.encounter_id as EncounterId,\r\n                    t.visit_date as TestDate,\r\n                    t.ever_tested_for_hiv as EverTestedForHiv,\r\n                    t.months_since_last_test as MonthsSinceLastTest,\r\n                    t.client_tested_as as ClientTestedAs,\r\n                    case t.hts_entry_point\r\n                    when 5485 then 'In Patient Department(IPD)'\r\n                    when 160542 then 'Out Patient Department(OPD)'\r\n                    when 162181 then 'Peadiatric Clinic'\r\n                    when 160552 then 'Nutrition Clinic'\r\n                    when 160538 then 'PMTCT ANC'\r\n                    when 160456 then 'PMTCT MAT'\r\n                    when 1623 then 'PMTCT PNC'\r\n                    when 160541 then 'TB'\r\n                    when 162050 then 'CCC'\r\n                    when 159940 then 'VCT'\r\n                    when 159938 then 'Home Based Testing'\r\n                    when 159939 then 'Mobile Outreach'\r\n                    when 162223 then 'VMMC'\r\n                    when 160546 then 'STI Clinic'\r\n                    when 160522 then 'Emergency'\r\n                    when 163096 then 'Community Testing'\r\n                    when 5622 then 'Other' end                                    as EntryPoint,\r\n                    case t.test_strategy\r\n                    when 164163 then 'HP: Hospital Patient Testing'\r\n                    when 164953 then 'NP: HTS for non-patients'\r\n                    when 164954 then 'VI:Integrated VCT Center'\r\n                    when 164955 then 'VS:Stand Alone VCT Center'\r\n                    when 159938 then 'HB:Home Based Testing'\r\n                    when 159939 then 'MO: Mobile Outreach HTS'\r\n                    when 161557 then 'Index testing'\r\n                    when 166606 then 'SNS - Social Networks'\r\n                    when 5622 then 'O:Other'\r\n                    end                                                           as TestStrategy,\r\n                    t.test_1_result                                                   as TestResult1,\r\n                    t.approach as Approach,\r\n                    t.setting as Setting,\r\n                    t.test_2_result                                                   as TestResult2,\r\n                    t.final_test_result                                               as FinalTestResult,\r\n                    t.patient_given_result                                            as PatientGivenResult,\r\n                    t.tb_screening                                                    as TbScreening,\r\n                    t.patient_had_hiv_self_test                                       as ClientSelfTested,\r\n                    t.couple_discordant                                               as CoupleDiscordant,\r\n                    CASE t.test_type\r\n                    WHEN 1 THEN 'Initial'\r\n                    WHEN 2 THEN 'Repeat'\r\n                    END                                                           AS TestType,\r\n                    t.patient_consented                                               as Consent,\r\n                    t.hts_risk_category                                               as HtsRiskCategory,\r\n                    t.hts_risk_score                                                  as HtsRiskScore,\r\n                    t.date_created                                                    as Date_Created,\r\n                    t.date_last_modified                                              as Date_Last_Modified\r\n                    FROM kenyaemr_etl.etl_hts_test t\r\n                    inner join kenyaemr_etl.etl_patient_demographics demographics on t.patient_id = demographics.patient_id",
                    "rank": 2,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsClientTests",
                    "tempTableName": "TempHtsClientTestsExtract",
                    "id": "8578afbc-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 1150,
                        "loaded": 1150,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 1150,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsPartnerNotificationServices",
                    "display": "Hts Partner Notification Services",
                    "extractSql": "SELECT\r\nDISTINCT\r\n               t.patient_id AS PatientPK,\r\n               (select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n               (select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n               'KenyaEMR' as Emr,\r\n               'Kenya HMIS II' AS Project,\r\n               id.identifier AS HtsNumber,\r\n               ohpc.patient_id AS PartnerPatientPk,\r\n               ohpc.id AS PartnerPersonId,\r\n    YEAR(ohpc.date_created)-YEAR(ohpc.birth_date)  AS Age,\r\n               ohpc.sex,\r\n               CASE ohpc.relationship_type\r\n                                              WHEN 970          THEN  'parent (Mother)'\r\n                                              WHEN 971           THEN  'parent(Father)'\r\n                                              WHEN 972          THEN  'sibling'\r\n                                              WHEN 1528        THEN  'Child'\r\n                                              WHEN 5617          THEN  'spouse'\r\n            WHEN 163565  THEN  'partner'\r\n                                              WHEN 162221  THEN  'cowife'\r\n               END     AS RelationsipToIndexClient,\r\n\r\n    /*Screened for IPV? CASE?*/\r\n               CASE WHEN ohpc.ipv_outcome IS NOT NUll THEN 'Yes' ELSE 'No' END AS  ScreenedForIpv,\r\n\r\n               ohpc.ipv_outcome AS IpvScreeningOutcome,\r\n               CASE ohpc.living_with_patient\r\n                               WHEN 1065 THEN 'Yes'\r\n                               WHEN 1066 THEN 'No'\r\n               END AS CurrentlyLivingWithIndexClient,\r\n    /*knowledgeof HIV Status*/\r\n    ohpc.baseline_hiv_status as KnowledgeOfHivStatus,\r\n\r\npnsApprocah.name AS  PnsApproach,\r\nohpc.consented_contact_listing as  PnsConsent,\r\ncase when ctrace.status is null then 'N' else 'Y' end as LinkedToCare,\r\nctrace.encounter_date as  LinkDateLinkedToCare,\r\nctrace.unique_patient_no as CccNumber,\r\nctrace.facility_linked_to as FacilityLinkedTo,\r\nohpc.birth_date as DoB,\r\nohpc.date_created as DateElicited ,\r\nmarital.name as  MaritalStatus\r\n\r\n\r\n  FROM\r\n               kenyaemr_etl.etl_hts_test t\r\nINNER JOIN\r\n        kenyaemr_hiv_testing_patient_contact ohpc ON ohpc.patient_related_to=t.patient_id\r\nLEFT JOIN\r\n                location_attribute SC ON SC.location_id = t.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n  location SN ON SN.location_id =t.encounter_location\r\n  LEFT JOIN\r\n               patient_identifier id ON id.patient_id = t.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')\r\nleft JOIN patient openmrs ON  openmrs.patient_id = id.patient_id\r\nleft JOIN kenyaemr_hiv_testing_client_trace ctrace ON  ctrace.client_id = ohpc.id and ctrace.status='Contacted and Linked'\r\nleft join concept_name marital ON marital.concept_id = ohpc.marital_status and marital.locale='en' and marital.concept_name_type = 'FULLY_SPECIFIED'\r\nleft join concept_name pnsApprocah ON pnsApprocah.concept_id = ohpc.pns_approach and pnsApprocah.locale='en' and pnsApprocah.concept_name_type = 'FULLY_SPECIFIED'\r\n ",
                    "rank": 7,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsPartnerNotificationServices",
                    "tempTableName": "TempHtsPartnerNotificationServicesExtract",
                    "id": "8578c042-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 9,
                        "loaded": 9,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 9,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsTestKits",
                    "display": "Hts Test Kits",
                    "extractSql": "SELECT\r\n    t.patient_id AS PatientPK,    \r\n\t(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n\t'KenyaEMR' as Emr,\r\n\t'Kenya HMIS II' AS Project,\r\n    id.identifier AS HtsNumber,\r\n\tt.encounter_id AS EncounterId,\r\n\tt.test_1_kit_name AS TestKitName1,\r\n\tt.test_1_kit_lot_no AS TestKitLotNumber1,\r\n\tt.test_1_kit_expiry as TestKitExpiry1,\r\n\tt.test_1_result as TestResult1,\r\n\tt.test_2_kit_name as TestKitName2,\r\n\tt.test_2_kit_lot_no as TestKitLotNumber2,\r\n\tt.test_2_kit_expiry as TestKitExpiry2,\r\n\tt.test_2_result as TestResult2,\r\n\tt.syphillis_test_result as SyphilisResult,\r\n\tt.date_created as Date_Created,\r\n    t.date_last_modified as Date_Last_Modified\r\nFROM\r\n\tkenyaemr_etl.etl_hts_test t\r\ninner join\r\n\tkenyaemr_etl.etl_patient_demographics demographics on t.patient_id=demographics.patient_id\r\nLEFT JOIN\r\n\t location_attribute SC ON SC.location_id = t.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n  location SN ON SN.location_id =t.encounter_location\r\nLEFT JOIN patient_identifier id ON id.patient_id = t.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')",
                    "rank": 4,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsTestKits",
                    "tempTableName": "TempHtsTestKitsExtract",
                    "id": "8578b700-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 1152,
                        "loaded": 1152,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 1152,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsClientLinkage",
                    "display": "Hts Client Linkage",
                    "extractSql": "select distinct a.patient_id as PatientPK,\r\n(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n'KenyaEMR' as Emr,\r\n'Kenya HMIS II' AS Project,\r\nid.identifier AS HtsNumber,\r\nref.date_to_enrol as DatePrefferedToBeEnrolled,\r\nref.facility_referred_to as FacilityReferredTo,\r\na.provider_handed_to as HandedOverTo,\r\nNULL HandedOverToCadre,\r\na.facility_linked_to as EnrolledFacilityName,\r\nref.visit_date as ReferralDate,\r\na.enrollment_date as DateEnrolled,\r\na.ccc_number as ReportedCCCNumber,\r\na.art_start_date as ReportedStartARTDate\r\nfrom (SELECT Distinct patient_id, encounter_id,ccc_number,enrollment_date,\r\nart_start_date,provider_handed_to,facility_linked_to,encounter_location FROM\r\n(SELECT DISTINCT htsrl.patient_id, encounter_id,ccc_number,enrollment_date,\r\nart_start_date,provider_handed_to,facility_linked_to,encounter_location\r\nFROM kenyaemr_etl.etl_hts_referral_and_linkage htsrl\r\nUNION ALL\r\nSELECT DISTINCT t.patient_id,t.encounter_id,unique_patient_no ccc_number,e.visit_date DateEnrolled,\r\nar.art_start_date,provider_handed_to,facility_linked_to,t.encounter_location\r\nFROM kenyaemr_etl.etl_hts_test t\r\nINNER JOIN kenyaemr_etl.etl_patient_demographics pt ON pt.patient_id=t.patient_id AND pt.voided=0\r\nINNER JOIN kenyaemr_etl.etl_hiv_enrollment e ON e.patient_id=t.patient_id AND e.voided=0\r\nLEFT JOIN kenyaemr_etl.etl_hts_referral_and_linkage l ON l.patient_id=t.patient_id\r\nLEFT JOIN (SELECT patient_id,min(date_started) as art_start_date FROM kenyaemr_etl.etl_drug_event\r\ngroup by patient_id)ar on ar.patient_id=t.patient_id\r\nWHERE t.test_type = 1 AND t.final_test_result='Positive' AND t.voided=0 AND l.patient_id IS NULL)a\r\n) a\r\nleft join kenyaemr_etl.etl_hts_referral ref on a.patient_id=ref.patient_id\r\nLEFT JOIN location_attribute SC ON (SC.location_id = a.encounter_location or SC.location_id=ref.encounter_location ) AND SC.attribute_type_id=1\r\nLEFT JOIN location SN ON (SN.location_id =a.encounter_location or SN.location_id =ref.encounter_location )\r\nLEFT JOIN patient_identifier id ON (id.patient_id = a.patient_id or id.patient_id = ref.patient_id ) AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')\r\nLEFT JOIN kenyaemr_etl.etl_hiv_enrollment EN ON EN.patient_id =a.patient_id\r\nwhere a.patient_id in (select patient_id from kenyaemr_etl.etl_hts_test)",
                    "rank": 3,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsClientLinkage",
                    "tempTableName": "TempHtsClientsLinkageExtract",
                    "id": "8578b21e-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 54,
                        "loaded": 54,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 54,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsPartnerTracing",
                    "display": "Hts Partner Tracing",
                    "extractSql": "select distinct\r\nt.patient_id as PatientPK,\r\nid.identifier as HtsNumber,\r\nclient_id as PartnerPersonId,\r\ncontact_type as TraceType,\r\nencounter_date as TraceDate,\r\n(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n'KenyaEMR' as Emr,\r\n'Kenya HMIS II' AS Project,\r\nstatus as TraceOutcome,\r\ntc.appointment_date as BookingDate\r\nfrom\r\n\tkenyaemr_hiv_testing_patient_contact pc\r\ninner join\r\n\tkenyaemr_etl.etl_hts_test t on pc.patient_related_to=t.patient_id\r\ninner join\r\n\tkenyaemr_hiv_testing_client_trace tc on pc.id=tc.client_id\r\nLEFT JOIN\r\n\tpatient_identifier id ON id.patient_id = t.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\n\tfrom patient_identifier_type where name='OpenMRS ID')\r\nLEFT JOIN\r\n\t location_attribute SC ON SC.location_id = t.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n\tlocation SN ON SN.location_id =t.encounter_location; ",
                    "rank": 6,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsPartnerTracing",
                    "tempTableName": "TempHtsPartnerTracingExtract",
                    "id": "8578bbba-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsClientTracing",
                    "display": "Hts Client Tracing",
                    "extractSql": "SELECT\r\n\tht.patient_id as PatientPK,\r\n\t(select FacilityName from kenyaemr_etl.etl_default_facility_info) as FacilityName,\r\n(select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n\thtsrl.tracing_type as TracingType,\r\n\thtsrl.visit_date as TracingDate,\r\n\t'KenyaEMR' as Emr,\r\n\t'Kenya HMIS II' AS Project,\r\n\tid.identifier AS HtsNumber,\r\n\thtsrl.tracing_status as TracingOutcome\r\nFROM\r\n\tkenyaemr_etl.etl_hts_test ht\r\nINNER JOIN\r\n\tkenyaemr_etl.etl_hts_test t ON ht.patient_id=t.patient_id\r\nLEFT  JOIN\r\n\tkenyaemr_etl.etl_hts_referral_and_linkage htsrl  ON ht.patient_id=htsrl.patient_id\r\nLEFT JOIN\r\n  location SN ON SN.location_id =htsrl.encounter_location\r\nLEFT JOIN\r\n\t location_attribute SC ON SC.location_id = htsrl.encounter_location AND SC.attribute_type_id=1\r\nLEFT JOIN\r\n patient_identifier id ON id.patient_id = htsrl.patient_id AND id.identifier_type = (select patient_identifier_type_id\r\nfrom patient_identifier_type\r\nwhere name='OpenMRS ID')\r\n WHERE SC.value_reference IS NOT NULL",
                    "rank": 5,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsClientTracing",
                    "tempTableName": "TempHtsClientTracingExtract",
                    "id": "8578b962-c34b-11e9-9cb5-2a2ae2dbcce4",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 173,
                        "loaded": 173,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 173,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "DWHStage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "HTS",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "HtsEligibilityExtract",
                    "display": "Hts Eligibility Screening",
                    "extractSql": "SELECT t.patient_id as PatientPK,\r\n                            (select siteCode from kenyaemr_etl.etl_default_facility_info)               as SiteCode,\r\n                            (select FacilityName from kenyaemr_etl.etl_default_facility_info)           as FacilityName,\r\n                            'KenyaEMR'                                                                  as Emr,\r\n                            'Kenya HMIS II'                                                             as Project,\r\n                            demographics.openmrs_id                                                     as HtsNumber,\r\n                            t.visit_id                                                                  as VisitID,\r\n                            t.encounter_id                                                              as EncounterId,\r\n                            t.visit_date                                                                as VisitDate,\r\n                            '' as ForcedSex,                          \r\n                            case t.population_type\r\n                                when 164928 then 'General Population'\r\n                                when 164929 then 'Key Population'\r\n                                when 138643\r\n                                    then 'Priority Population' end                                      as PopulationType,\r\n                            t.key_population_type                                                       as KeyPopulation,\r\n                            t.priority_population_type                                                  as PriorityPopulation,\r\n                            case t.department\r\n                                when 160542 then 'OPD:Out-patient department'\r\n                                when 5485 then 'IPD:In-patient department'\r\n                                when 160473 then 'Emergency'\r\n                                when 160538 then 'PMTCT'\r\n                                when 159940\r\n                                    then 'VCT' end                                                      as Department,\r\n                            case t.patient_type\r\n                                when 164163 then 'HP:Hospital Patient'\r\n                                when 164953\r\n                                    then 'NP:Non-Hospital Patient' end                                  as PatientType,\r\n                            case t.is_health_worker when 1065 then 'Yes' when 1066 then 'No' end        as IsHealthWorker,\r\n                            t.relationship_with_contact                                                 as RelationshipWithContact,\r\n                            \tcase t.mother_hiv_status when 703 then 'Positive' when 664 then 'Negative' when 1067 then 'Unknown' end as MothersStatus,\r\n                            case t.tested_hiv_before when 1065 then 'Yes' when 1066 then 'No' end       as TestedHIVBefore,\r\n                            case t.who_performed_test\r\n                                when 5619 then 'HTS Provider'\r\n                                when 164952\r\n                                    then 'Self Tested' end                                              as WhoPerformedTest,\r\n                            (case t.test_results\r\n                                 when 703 then 'Positive'\r\n                                 when 664 then 'Negative'\r\n                                 when 1067 then 'Unknown'\r\n                                 else '' end)                                                           as ResultOfHIV,\r\n                            if(t.who_performed_test = 164952,t.date_tested,null)                             as DateTestedSelf,\t\r\n                            if(t.who_performed_test = 164952,case t.test_results\t\r\n                            when 703 then 'Positive'\t\r\n                            when 664 then 'Negative'\t\r\n                            when 1067 then 'Unknown'\t\r\n                            else '' end,null)                                                           as ResultOfHIVSelf,\t\r\n                            if(t.who_performed_test = 5619,t.date_tested, null)                             as DateTestedProvider,\r\n                            case t.started_on_art when 1065 then 'Yes' when 1066 then 'No' end          as StartedOnART,\r\n                            t.upn_number                                                                as CCCNumber,\r\n                            case t.ever_had_sex when 1 then 'Yes' when 2 then 'No' end                  as EverHadSex,\r\n                            case t.sexually_active when 1065 then 'Yes' when 1066 then 'No' end         as SexuallyActive,\r\n                            case t.new_partner when 1065 then 'Yes' when 1066 then 'No' end             as NewPartner,\r\n                            (case t.partner_hiv_status\r\n                                 when 703 then 'Positive'\r\n                                 when 664 then 'Negative'\r\n                                 when 1067 then 'Unknown'\r\n                                 else '' end)                                                           as PartnerHIVStatus,\r\n                            case t.couple_discordant when 1065 then 'Yes' when 1066 then 'No' end       as CoupleDiscordant,\r\n                            case t.multiple_partners when 1 then 'Yes' when 0 then 'No' end             as MultiplePartners,\r\n                            t.number_partners                                                           as NumberOfPartners,\r\n                            case t.alcohol_sex\r\n                                when 1066 then 'Not at all'\r\n                                when 1385 then 'Sometimes'\r\n                                when 165027\r\n                                    then 'Always' end                                                   as AlcoholSex,\r\n                            case t.money_sex when 1065 then 'Yes' when 1066 then 'No' end               as MoneySex,\r\n                            case t.condom_burst when 1065 then 'Yes' when 1066 then 'No' end            as CondomBurst,\r\n                            case t.unknown_status_partner when 1065 then 'Yes' when 1066 then 'No' end  as UnknownStatusPartner,\r\n                            case t.known_status_partner when 163289 then 'Yes' when 1066 then 'No' end  as KnownStatusPartner,\r\n                            case t.pregnant when 1065 then 'Yes' when 1066 then 'No' end                as Pregnant,\r\n                            case t.breastfeeding_mother when 1065 then 'Yes' when 1066 then 'No' end    as BreastfeedingMother,\r\n                            case t.experienced_gbv when 1065 then 'Yes' when 1066 then 'No' end         as ExperiencedGBV,\r\n                            t.type_of_gbv                                                               as TypeGBV,\t\r\n                            t.service_received                                                          as ReceivedServices,\r\n                            case t.currently_on_prep when 1065 then 'Yes' when 1066 then 'No' end       as CurrentlyOnPrEP,\r\n                            \tcase t.recently_on_pep when 1 then 'Yes' when 0 then 'No' end              as CurrentlyOnPEP,\r\n                            case t.recently_had_sti when 1065 then 'Yes' when 1066 then 'No' end       as CurrentlyHasSTI,\r\n                            case t.tb_screened when 1065 then 'Yes' when 1066 then 'No' end  ScreenedTB,\t\r\n                            case t.cough when 159799 then 'Yes' when 1066 then 'No' end as Cough,\t\r\n                            case t.fever when 1494 then 'Yes' when 1066 then 'No' end as Fever,\t\r\n                            case t.weight_loss when 832 then 'Yes' when 1066 then 'No' end as WeightLoss,\t\r\n                            case t.night_sweats when 133027 then 'Yes' when 1066 then 'No' end as NightSweats,\t\r\n                            case t.contact_with_tb_case when 124068 then 'Yes' when 1066 then 'No' end as ContactWithTBCase,\t\r\n                            case t.lethargy when 116334 then 'Yes' when 1066 then 'No' end as Lethargy,\t\r\n                            case t.tb_status when 1660 then 'No TB signs' when 142177 then 'Presumed TB' when 1662 then 'TB Confirmed' end as TBStatus,\r\n                            case t.shared_needle when 1065 then 'Yes' when 1066 then 'No' end           as SharedNeedle,\r\n                            case t.needle_stick_injuries when 153574 then 'Yes' when 1066 then 'No' end as NeedleStickInjuries,\r\n                            case t.traditional_procedures when 1065 then 'Yes' when 1066 then 'No' end  as TraditionalProcedures,\r\n                            t.child_reasons_for_ineligibility                                           as ChildReasonsForIneligibility,\r\n                            \t''                                                                          as AssessmentOutcome,\r\n                            case t.eligible_for_test when 1065 then 'Yes' when 1066 then 'No' end       as EligibleForTest,\r\n                            \tt.reasons_for_ineligibility as ReasonsForIneligibility,\t\r\n                            t.specific_reason_for_ineligibility                                         as SpecificReasonForIneligibility,\t\r\n                            case t.referred_for_testing when 1065 then 'Yes' when 1066 then 'No' end    as ReferredForTesting,\r\n                            t.date_created                                                              as DateCreated,\r\n                            t.date_last_modified                                                        as DateLastModified\r\n                     FROM kenyaemr_etl.etl_hts_eligibility_screening t\r\n                              inner join kenyaemr_etl.etl_patient_demographics demographics on t.patient_id = demographics.patient_id\r\n                              LEFT JOIN openmrs.location_attribute SC ON SC.location_id = t.location_id AND SC.attribute_type_id = 1\r\n                              LEFT JOIN openmrs.location SN ON SN.location_id = t.location_id group by t.encounter_id",
                    "rank": 8,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempHtsClientsExtracts",
                    "tableName": "HtsEligibilityExtract",
                    "tempTableName": "TempHtsEligibilityExtract",
                    "id": "7bb8b081-c206-49ba-aac0-48bf14fdc84e",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 339,
                        "loaded": 332,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 332,
                        "sent": 0
                    }
                }
            }
        ]
    }
}
