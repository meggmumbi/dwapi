{
    "extracts": [
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempPatientMnchExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "PatientMnchExtract",
                "display": "Mnch Patient",
                "extractSql": "select pkv.pkv as PKV,\r\n                         d.patient_id                                                    as PatientPK,\r\n                         d.national_unique_patient_identifier                            as NUPI,\r\n                         i.siteCode                                                      as SiteCode,\r\n                         d.openmrs_id                                                    as PatientMNCHID,\r\n                         d.hei_no                                                        as PatientHEIID,\r\n                         'KenyaEMR'                                                      as Emr,\r\n                         'Kenya HMIS II'                                                 as Project,\r\n                         i.FacilityName                                                  as FacilityName,\r\n                          0 as FacilityId,\r\n                         (case d.Gender when 'F' then 'Female' when 'M' then 'Male' end) as Gender,\r\n                         d.DOB                                                           as DOB,\r\n                         coalesce(c.hei_enrolment_date, m.mch_enrolment_date)            as FirstEnrollmentAtMnch,\r\n                         coalesce(c.hei_encounter_id, m.mch_encounter_id)                as EncounterId,\r\n                         d.occupation                                                    as Occupation,\r\n                         d.marital_status                                                as MaritalStatus,\r\n                         d.education_level                                               as EducationLevel,\r\n                         a.county                                                        as PatientResidentCounty,\r\n                         a.sub_county                                                    as PatientResidentSubCounty,\r\n                         a.ward                                                          as PatientResidentWard,\r\n                         (case e.in_school when 1 then 'Yes' when 2 then 'No' end)       as Inschool,\r\n                         d.date_created                                                  as Date_Created,\r\n                         d.date_last_modified                                            as Date_Last_Modified\r\n                  from kenyaemr_etl.etl_patient_demographics d\r\n                         left join (select m.patient_id, min(date(m.visit_date)) as mch_enrolment_date,mid(min(concat(date(m.visit_date),m.encounter_id)),11) as mch_encounter_id\r\n                                    from kenyaemr_etl.etl_mch_enrollment m group by m.patient_id)m on d.patient_id = m.patient_id\r\n                         left join (select c.patient_id, min(date(c.visit_date)) as hei_enrolment_date, mid(min(concat(date(c.visit_date),c.encounter_id)),11) as hei_encounter_id\r\n                                    from kenyaemr_etl.etl_hei_enrollment c group by c.patient_id)c on d.patient_id = c.patient_id\r\n                         left join (select a.patient_id, a.county, a.sub_county, a.ward from kenyaemr_etl.etl_person_address a)a\r\n                           on d.patient_id = a.patient_id\r\n                         left join (select e.patient_id as patient_id, e.in_school as in_school from kenyaemr_etl.etl_hiv_enrollment e)e\r\n                           on d.patient_id = e.patient_id\r\n                         inner join (select x.patient_id as patient_id,\r\n                                            x.sxFirstName,\r\n                                            x.sxLastname,\r\n                                            x.sxMiddleName,\r\n                                            x.dmFirstName,\r\n                                            x.dmLastName,\r\n                                            x.dmMiddleName,\r\n                                            x.Gender,\r\n                                            x.DOB,\r\n                                            CASE\r\n                                              WHEN locate(';', dmLastName) > 0 THEN CONCAT(\r\n                                                                                      CAST(LEFT(Gender, 1) AS CHAR CHARACTER SET utf8),\r\n                                                                                      CAST(sxFirstName AS CHAR CHARACTER SET utf8), CAST(\r\n                                                                                                                                      SUBSTRING(dmLastName, locate(';', dmLastName) + 1, LENGTH(dmLastName))\r\n                                                                                                                                      AS\r\n                                                                                                                                      CHAR CHARACTER SET utf8),\r\n                                                                                      CAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n                                                )\r\n                                              ELSE CONCAT(\r\n                                                     CAST(LEFT(Gender, 1)AS CHAR CHARACTER SET utf8),\r\n                                                     CAST(sxFirstName AS CHAR CHARACTER SET utf8),\r\n                                                     CAST(dmLastName AS CHAR CHARACTER SET utf8),\r\n                                                     CAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n                                                )\r\n                                                                                                    END      AS PKV\r\n                                                                                         from (SELECT patient_id,\r\n                                                                                                      SOUNDEX(UPPER(REPLACE(given_name, '0', 'O')))                           AS sxFirstName,\r\n                                                                                                      SOUNDEX(UPPER(REPLACE(family_name, '0', 'O')))                          AS sxLastName,\r\n                                                                                                      SOUNDEX(UPPER(REPLACE(middle_name, '0', 'O')))                          AS sxMiddleName,\r\n                                                                                                      fn_getPatientNameDoubleMetaphone(UPPER(REPLACE(given_name, '0', 'O')))  AS dmFirstName,\r\n                                                                                                      fn_getPatientNameDoubleMetaphone(UPPER(REPLACE(family_name, '0', 'O'))) AS dmLastName,\r\n                                                                                                      fn_getPatientNameDoubleMetaphone(UPPER(REPLACE(middle_name, '0', 'O'))) AS dmMiddleName,\r\n                                                                                                      Gender,\r\n                                                                                                      DOB\r\n                                                                                               FROM kenyaemr_etl.etl_patient_demographics)x)pkv on pkv.patient_id = d.patient_id\r\n                                                                             join kenyaemr_etl.etl_default_facility_info i\r\n                                                                      where m.patient_id is not null\r\n                                                                         or c.patient_id is not null\r\n                                                                      group by EncounterId",
                "rank": 19,
                "isPriority": true,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "PatientMnchExtract",
                "tempTableName": "TempPatientMnchExtract",
                "id": "82650e9a-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 164,
                    "loaded": 164,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 164,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempAncVisitExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "AncVisitExtract",
                "display": "Anc Visit",
                "extractSql": "select d.patient_id                                                                             PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                               SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                                                                             PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                               Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                                          Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\ti.facilityName                                                                           FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.visit_id                                                                               VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.visit_date                                                                             VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\te.anc_number                                                                             ANCClinicNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.anc_visit_number                                                                       ANCVisitNo,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.maturity                                                                               GestationWeeks,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.height                                                                                 Height,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.weight                                                                                 Weight,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.temperature                                                                            Temp,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.pulse_rate                                                                             PulseRate,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.respiratory_rate                                                                       RespiratoryRate,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.oxygen_saturation                                                                      OxygenSaturation,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.muac                                                                                   MUAC,\r\n\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('/', a.systolic_bp, a.diastolic_bp)                                            BP,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.breast_exam_done when 1065 then 'Yes' when 1066 then 'No' end                     BreastExam,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.anc_exercises when 1065 then 'Yes' when 1066 then 'No' end                        AntenatalExercises,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       FGM,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       FGMComplications,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.hemoglobin                                                                             Haemoglobin,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       DiabetesTest,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.tb_screening\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1660 then 'NO signs'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 142177 then 'TB presumed'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 164128 then 'No signs and started on INH'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1662 then 'TB Rx'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160737\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Not done (ND)' end                                                       TBScreening,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.cacx_screening\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159393 then 'Presumed'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Confirmed'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1118 then 'Not Done'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'N/A' end                                                                 CACxScreen,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.cacx_screening_method\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 885 then 'Pap Smear'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162816 then 'VIA'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 164977 then 'VILI'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Other' end                                                               CACxScreenMethod,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.who_stage\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1204 then 1\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1205 then 2\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1206 then 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1207\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 4 end                                                                     WHOStaging,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.vl_sample_taken when 856 then 'Yes' when 1066 then 'No' end                       VLSampleTaken,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       VLDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcoalesce(a.viral_load, a.ldl)                                                            VLResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.syphilis_treated_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'NA' end                                                                          SyphilisTreatment,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase e.hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Positive' then 'KP'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Unknown' then 'Unknown'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Negative' end                                                            HIVStatusBeforeANC,\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(a.final_test_result is not null or a.test_1_result is not null or a.test_2_result is not null, 'Yes',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'No')                                                                                 HIVTestingDone,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       HIVTestType,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.test_1_kit_lot_no                                                                      HIVTest1,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.test_1_result                                                                          HIVTest1Result,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.test_2_kit_lot_no                                                                      HIVTest2,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       HIVTest2Result,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.final_test_result                                                                      HIVTestFinalResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.syphilis_test_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1229 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1228 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1271 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1402 then 'ND'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'No' end                                                                          SyphilisTestDone,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       SyphilisTestType,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.syphilis_test_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1229 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1228 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'N/A' end                                                                         SyphilisTestResults,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.syphilis_treated_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'NA' end                                                                          SyphilisTreated,\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(a.final_test_result = 'Positive' or e.hiv_status = 'Positive', case a.prophylaxis_given\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 105281 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 74250 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'N/A' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'NA')                                                                                 MotherProphylaxisGiven,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.date_given_haart                                                                       MotherGivenHAART,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.baby_azt_dispensed\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160123 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'NA' end                                                                  AZTBabyDispense,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.baby_nvp_dispensed\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 80586 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'NA' end                                                                  NVPBabyDispense,\r\n\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case ci.chronic_illness\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 149019 then 'Alzheimers Disease and other Dementias'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 148432 then 'Arthritis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 153754 then 'Asthma'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159351 then 'Cancer'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 119270 then 'Cardiovascular diseases'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 120637 then 'Chronic Hepatitis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 145438 then 'Chronic Kidney Disease'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1295 then 'Chronic Obstructive Pulmonary Disease(COPD)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 120576 then 'Chronic Renal Failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 119692 then 'Cystic Fibrosis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 120291 then 'Deafness and Hearing impairment'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 119481 then 'Diabetes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 118631 then 'Endometriosis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117855 then 'Epilepsy'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117789 then 'Glaucoma'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 139071 then 'Heart Disease'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115728 then 'Hyperlipidaemia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117399 then 'Hypertension'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117321 then 'Hypothyroidism'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 151342 then 'Mental illness'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 133687 then 'Multiple Sclerosis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115115 then 'Obesity'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 114662 then 'Osteoporosis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117703 then 'Sickle Cell Anaemia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 118976 then 'Thyroid disease'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend SEPARATOR\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'|')                                                                        ChronicIllness,\r\n\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('|', nullif(case a.counselled_on_birth_plans when 159758 then 'Birth plans' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_danger_signs\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159857 then 'Danger signs' end, ''), nullif(case a.counselled_on_family_planning\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156277 then 'Family planning'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_hiv when 1914 then 'HIV' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_supplimental_feeding\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159854\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Supplimental feeding' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_breast_care when 159856 then 'Breast care' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_infant_feeding\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161651 then 'Infant feeding' end, ''), nullif(case a.counselled_on_treated_nets\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1381 then 'ITN'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t''))               CounselledOn,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.partner_hiv_tested\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'NA' end                                                                          PartnerHIVTestingANC,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.partner_hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'HIV Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'HIV Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'UNKNOWN' end                                                             PartnerHIVStatusANC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       PostParturmFP,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.deworming                                                                              Deworming,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.IPT_malaria                                                                            MalariaProphylaxis,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.TTT                                                                                    TetanusDose,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.iron_supplement                                                                        IronSupplementsGiven,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.bed_nets                                                                               ReceivedMosquitoNet,\r\n\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('|', nullif(case a.TTT when 'Yes' then 'Tetanus Toxoid' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.IPT_malaria when 'Yes' then 'Malaria  Prophylaxis' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.iron_supplement when 'Yes' then 'Folate / Iron ' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.deworming when 'Yes' then 'Mebendazole' end, ''), nullif(case a.bed_nets\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Long-Lasting Insecticidal Net' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'')) as PreventiveServices,\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(a.urine_microscopy is not null or a.urinary_albumin is not null or a.glucose_measurement is not null\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tor a.urine_ph is not null or a.urine_gravity is not null or a.urine_nitrite_test is not null\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tor a.urine_dipstick_for_blood is not null or a.urine_leukocyte_esterace_test is not null or\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.urinary_ketone is not null\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tor a.urine_bile_pigment_test is not null or a.urine_bile_salt_test is not null or\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.urine_colour is not null or a.urine_turbidity is not null, 'Yes',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'No')                                                                                 UrinalysisVariables,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.referred_from\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' END                                                               ReferredFrom,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.referred_to\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' END                                                            as ReferredTo,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       ReferralReasons,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.next_appointment_date                                                                  NextAppointmentANC,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.clinical_notes                                                                         ClinicalNotes,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.date_created                                                                           Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\tGREATEST(COALESCE(a.date_last_modified, e.date_last_modified, ci.date_last_modified),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCOALESCE(a.date_last_modified, e.date_last_modified,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tci.date_last_modified))                                             as Date_Last_Modified\r\n\t\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mch_antenatal_visit a on d.patient_id = a.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\tleft join kenyaemr_etl.etl_allergy_chronic_illness ci on a.visit_id = ci.visit_id\r\n\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mch_enrollment e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\twhere a.visit_id is not null\r\n\t\t\t\t\tgroup by a.visit_id",
                "rank": 22,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "AncVisitExtract",
                "tempTableName": "TempAncVisitExtract",
                "id": "82651494-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempCwcEnrolmentExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "CwcEnrolmentExtract",
                "display": "Cwc Enrolment",
                "extractSql": "select d.patient_id              as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\td.openmrs_id              as PatientMNCH_ID,\r\n\t\t\t\t\t\t\t\t\t\t\ti.siteCode                as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\td.cwc_number              as PatientIDCWC,\r\n\t\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\td.hei_no                  as HEIID,\r\n\t\t\t\t\t\t\t\t\t\t\tpkv.PKV                   as Pkv,\r\n\t\t\t\t\t\t\t\t\t\t\te.initial_reg_at_cwc      as RegistrationAtCWC,\r\n\t\t\t\t\t\t\t\t\t\t\te.child_exposed           as MothersPkv,\r\n\t\t\t\t\t\t\t\t\t\t\te.initial_reg_at_cwc      as RegistrationAtHEI,\r\n\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'           as Project,\r\n\t\t\t\t\t\t\t\t\t\t\te.visit_id                as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\tnull      as Gestation,\r\n\t\t\t\t\t\t\t\t\t\t\te.birth_weight            as BirthWeight,\r\n\t\t\t\t\t\t\t\t\t\t\te.birth_length            as BirthLength,\r\n\t\t\t\t\t\t\t\t\t\t\te.birth_order             as BirthOrder,\r\n\t\t\t\t\t\t\t\t\t\t\te.birth_type              as BirthType,\r\n\t\t\t\t\t\t\t\t\t\t\te.place_of_delivery       as PlaceOfdelivery,\r\n\t\t\t\t\t\t\t\t\t\t\te.mode_of_delivery        as ModeOfDelivery,\r\n\t\t\t\t\t\t\t\t\t\t\te.has_special_needs       as SpecialNeeds,\r\n\t\t\t\t\t\t\t\t\t\t\te.reason_for_special_care as SpecialCare,\r\n\t\t\t\t\t\t\t\t\t\t\t'' as HEI,\r\n\t\t\t\t\t\t\t\t\t\t\te.is_mother_alive         as MotherAlive,\r\n\t\t\t\t\t\t\t\t\t\t\te.mother_ccc_no           as MothersCCCNo,\r\n\t\t\t\t\t\t\t\t\t\t\te.mother_art_regimen      as ARTRegimenMother,\r\n\t\t\t\t\t\t\t\t\t\t\t'' \t\t\t\t\t\t as ARTMother,\r\n\t\t\t\t\t\t\t\t\t\t\tnull\t\t\t\t\t\t as ARTStartDateMother,\r\n\t\t\t\t\t\t\t\t\t\t\tnull as HEIDate,\r\n\t\t\t\t\t\t\t\t\t\t\te.transfer_in             as TransferIn,\r\n\t\t\t\t\t\t\t\t\t\t\te.trf_in_date             as TransferInDate,\r\n\t\t\t\t\t\t\t\t\t\t\t'' \t\t\t\t         as TransferredFrom,\r\n\t\t\t\t\t\t\t\t\t\t\te.nvp_during_bf           as NVP,\r\n\t\t\t\t\t\t\t\t\t\t\te.breast_feeding          as BreastFeeding,\r\n\t\t\t\t\t\t\t\t\t\t\te.referred_from           as ReferredFrom,\r\n\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                            d.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\tinner join (select e.patient_id                                                             as patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.permanent_registration_serial                                          as permanent_reg_serial,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin(e.visit_date)                                                        as initial_reg_at_cwc,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.child_exposed\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 822 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end                                           as child_exposed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.visit_id                                                               as visit_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.gestation_at_birth                                                     as gestation_at_birth,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.birth_weight                                                           as birth_weight,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.birth_length                                                           as birth_length,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.birth_order                                                            as birth_order,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.birth_type\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159913 then 'Single'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159914 then 'Twins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159915 then 'Triplets'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 113450 then 'Quadruplets'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 113440 then 'Quintuplets' end                                     as birth_type,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.place_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1589 then 'Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1536 then 'Home'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end                                             as place_of_delivery,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.mode_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1170 then 'SVD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1171 then 'C-Section' end                                         as mode_of_delivery,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.need_for_special_care\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161628 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No' end                                                as has_special_needs,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.reason_for_special_care\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 116222 then 'Birth weight less than 2.5 kg'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162071 then 'Birth less than 2 years after last birth'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162072 then 'Fifth or more child'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162073 then 'Teenage mother'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162074 then 'Brother or sisters undernourished'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162075 then 'Multiple births(Twins,triplets)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162076 then 'Child in family dead'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1174 then 'Orphan'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161599 then 'Child has disability'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1859 then 'Parent HIV positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 123174\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'History/signs of child abuse/neglect' end                as reason_for_special_care,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.mother_alive when 1 then 'Yes' when 0 then 'No' else '' end       as is_mother_alive,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.parent_ccc_number                                                      as mother_ccc_no,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.mother_drug_regimen                                                    as mother_art_regimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.transfer_in when 1065 then 'Yes' when 1066 then 'No' end          as transfer_in,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.transfer_in_date                                                       as trf_in_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.facility_transferred_from                                              as facility_trf_from,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.mother_on_NVP_during_breastfeeding                                     as nvp_during_bf,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.mother_breastfeeding when 1065 then 'Yes' when 1066 then 'No' end as breast_feeding,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.referral_source\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160537 then 'Paediatric'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160542 then 'OPD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160456 then 'Maternity'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162050 then 'CCC'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160538 then 'MCH/PMTCT'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end                                             as referred_from,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmd.parent_pid as parent_pid\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_enrollment e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select d.patient_id as parent_pid, d.unique_patient_no as parent_ccc\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d)md\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton e.parent_ccc_number = md.parent_ccc\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by e.patient_id) e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select x.patient_id as patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.sxFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.sxLastname,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.sxMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.dmFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.dmLastName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.dmMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.Gender,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.DOB,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCASE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN locate(';', dmLastName) > 0 THEN CONCAT(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(LEFT(Gender, 1) AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(sxFirstName AS CHAR CHARACTER SET utf8), CAST(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSUBSTRING(dmLastName, locate(';', dmLastName) + 1, LENGTH(dmLastName))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE CONCAT(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(LEFT(Gender, 1)AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(sxFirstName AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(dmLastName AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEND      AS PKV\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (SELECT patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(given_name, '0', 'O')))                           AS sxFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(family_name, '0', 'O')))                          AS sxLastName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(middle_name, '0', 'O')))                          AS sxMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(given_name, '0', 'O')))  AS dmFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(family_name, '0', 'O'))) AS dmLastName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(middle_name, '0', 'O'))) AS dmMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tGender,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDOB\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tFROM kenyaemr_etl.etl_patient_demographics)x)pkv on pkv.patient_id = e.parent_pid\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                "rank": 26,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "CwcEnrolmentExtract",
                "tempTableName": "TempCwcEnrolmentExtract",
                "id": "826519c6-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempCwcVisitExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "CwcVisitExtract",
                "display": "Cwc Visit",
                "extractSql": "select d.patient_id           as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\ti.siteCode             as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'             as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'        as Project,\r\n\t\t\t\t\t\t\t\t\t\t\ti.FacilityName         as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\td.openmrs_id           as PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t\tv.visit_date           as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\tv.visit_id             as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\tv.height               as Height,\r\n\t\t\t\t\t\t\t\t\t\t\tv.weight               as Weight,\r\n\t\t\t\t\t\t\t\t\t\t\tv.temperature          as Temp,\r\n\t\t\t\t\t\t\t\t\t\t\tv.pulse_rate           as PulseRate,\r\n\t\t\t\t\t\t\t\t\t\t\tv.respiratory_rate     as RespiratoryRate,\r\n\t\t\t\t\t\t\t\t\t\t\tv.oxygen_saturation    as OxygenSaturation,\r\n\t\t\t\t\t\t\t\t\t\t\tv.muac                 as MUAC,\r\n\t\t\t\t\t\t\t\t\t\t\tv.weight_category      as WeightCategory,\r\n\t\t\t\t\t\t\t\t\t\t\tv.stunted              as Stunted,\r\n\t\t\t\t\t\t\t\t\t\t\tv.infant_feeding       as InfantFeeding,\r\n\t\t\t\t\t\t\t\t\t\t\tv.medication_given     as MedicationGiven,\r\n\t\t\t\t\t\t\t\t\t\t\tv.tb_assessment        as TBAssessment,\r\n\t\t\t\t\t\t\t\t\t\t\tv.mnps_supplementation as MNPsSupplementation,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as Immunization,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as ImmunizationGiven,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as DangerSigns,\r\n\t\t\t\t\t\t\t\t\t\t\tv.milestones           as Milestones,\r\n\t\t\t\t\t\t\t\t\t\t\tv.vitaminA_given       as VitaminA,\r\n\t\t\t\t\t\t\t\t\t\t\tv.disability           as Disability,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as ReceivedMosquitoNet,\r\n\t\t\t\t\t\t\t\t\t\t\tv.dewormed             as Dewormed,\r\n\t\t\t\t\t\t\t\t\t\t\tv.referred_from        as ReferredFrom,\r\n\t\t\t\t\t\t\t\t\t\t\tv.referred_to          as ReferredTo,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as ReferralReasons,\r\n\t\t\t\t\t\t\t\t\t\t\tv.follow_up            as FollowUP,\r\n\t\t\t\t\t\t\t\t\t\t\tv.appointment_date     as NextAppointment,\r\n\t\t\t\t\t\t\t\t\t\t\tv.dna_pcr              as dnapcr,\r\n\t\t\t\t\t\t\t\t\t\t\tv.dna_pcr_date         as dnapcrdate,\r\n\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                                     d.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\tinner join (select v.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.visit_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.visit_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.height,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.weight,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.temperature,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.pulse_rate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.respiratory_rate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.oxygen_saturation,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case v.muac\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160909 then 'Green'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160910 then 'Yellow'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 127778 then 'Red'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse '' end)                                                       as muac,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.weight_category\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 123814 then 'Underweight(UW)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 126598 then 'Severely Underweight(SUW)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 114413 then 'Overweight(OW)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115115 then 'Obese(O)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1115 then 'Normal(N)' end                                      as weight_category,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.stunted when 164085 then 'Yes' when 1115 then 'No' end         as stunted,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.infant_feeding\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5526 then 'Exclusive Breastfeeding(EBF)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1595 then 'Exclusive Replacement(ERF)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 6046 then 'Mixed Feeding(MF)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'Not Breastfeeding' end                                        as infant_feeding,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('|', nullif(case v.azt_given when 'Yes' then 'AZT' when 'No' then '' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case v.nvp_given when 'Yes' then 'NVP' when 'No' then '' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case v.ctx_given when 'Yes' then 'CTX' when 'No' then '' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case v.multi_vitamin_given when 'Yes' then 'AZT' when 'No' then '' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t''))                                                 as medication_given,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.tb_assessment_outcome\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1660 then 'No TB Signs'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 142177 then 'Presumed TB'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1661 then 'TB Confirmed'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1662 then 'TB Rx'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1679 then 'INH'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160737 then 'Not Done'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse '' end                                                         as tb_assessment,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.review_of_systems_developmental\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1115 then 'Normal(N)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 6022 then 'Delayed(D)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 6025 then 'Regressed(R)' end                                   as milestones,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.vitaminA_given when 1065 then 'Yes' when 1066 then 'No' end    as vitaminA_given,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.disability when 1065 then 'Yes' when 1066 then 'No' end        as disability,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.deworming_drug when 79413 then 'Yes' when 70439 then 'Yes' end as dewormed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.counselled_on\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1914 then 'HIV'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1380 then 'Nutrition Services' end                             as follow_up,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.referred_from\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                            as referred_from,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.referred_to\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                            as referred_to,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.next_appointment_date                                               as appointment_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.dna_pcr_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1138 then 'Indeterminate'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'Poor sample quality' end                            as dna_pcr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.dna_pcr_sample_date                                                 as dna_pcr_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.MNPS_Supplementation                                                as mnps_supplementation\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_follow_up_visit v\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join kenyaemr_etl.etl_patient_triage t on v.visit_id = t.visit_id)v\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ton d.patient_id = v.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                "rank": 27,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "CwcVisitExtract",
                "tempTableName": "TempCwcVisitExtract",
                "id": "82651ade-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 701,
                    "loaded": 700,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 700,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempHeiExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "HeiExtract",
                "display": "Hei",
                "extractSql": "select d.patient_id                 as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\ti.siteCode                   as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                   as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'              as Project,\r\n\t\t\t\t\t\t\t\t\t\t\ti.FacilityName               as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                 as PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t\td.hei_no                     as PatientHeiId,\r\n\t\t\t\t\t\t\t\t\t\t\ta.1st_DNA_PCR_date           as DNAPCR1Date,\r\n\t\t\t\t\t\t\t\t\t\t\tb.2nd_DNA_PCR_date           as DNAPCR2Date,\r\n\t\t\t\t\t\t\t\t\t\t\tc.3rd_DNA_PCR_date           as DNAPCR3Date,\r\n\t\t\t\t\t\t\t\t\t\t\tv.confirmatory_pcr_date      as ConfirmatoryPCRDate,\r\n\t\t\t\t\t\t\t\t\t\t\tbaseline.baseline_vl_date    as BasellineVLDate,\r\n\t\t\t\t\t\t\t\t\t\t\tab.final_antibody_date       as FinalyAntibodyDate,\r\n\t\t\t\t\t\t\t\t\t\t\ta.1st_DNA_PCR_result         as DNAPCR1,\r\n\t\t\t\t\t\t\t\t\t\t\tb.2nd_DNA_PCR_result         as DNAPCR2,\r\n\t\t\t\t\t\t\t\t\t\t\tc.3rd_DNA_PCR_result         as DNAPCR3,\r\n\t\t\t\t\t\t\t\t\t\t\tv.dna_confirmatory_results   as ConfirmatoryPCR,\r\n\t\t\t\t\t\t\t\t\t\t\tbaseline.baseline_vl_results as BasellineVL,\r\n\t\t\t\t\t\t\t\t\t\t\tab.final_antibody_result     as FinalyAntibody,\r\n\t\t\t\t\t\t\t\t\t\t\tm.exit_date                  as HEIExitDate,\r\n\t\t\t\t\t\t\t\t\t\t\tm.hiv_status                 as HEIHIVStatus,\r\n\t\t\t\t\t\t\t\t\t\t\tm.exit_reason                as HEIExitCritearia,\r\n\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                                     d.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\tinner join (select m.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tm.hiv_status_at_exit as                            hiv_status,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tm.exit_date as                                     exit_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase m.exit_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1403 then 'HIV Neg age >18 months'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5240 then 'Lost'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160432 then 'Dead'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159492 then 'Transfer Out'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 138571 then 'Confirmed HIV Positive' end as exit_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_enrollment m)m on d.patient_id = m.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select t.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase t.test_result when 664 then 'Negative' when 703 then 'Positive' end as 1st_DNA_PCR_result,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.visit_date                                                             as 1st_DNA_PCR_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (select t.*, (@rn := if(@v = patient_id, @rn + 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(@v := patient_id, 1, 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) as rn\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcross join (select @v := -1, @rn := 0) params\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere t.lab_test = 1030\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\torder by t.patient_id, t.visit_date asc) t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere rn = 1)a on d.patient_id = a.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select t.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase t.test_result when 664 then 'Negative' when 703 then 'Positive' end as 2nd_DNA_PCR_result,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.visit_date                                                             as 2nd_DNA_PCR_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (select t.*, (@rn := if(@v = patient_id, @rn + 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(@v := patient_id, 1, 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) as rn\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcross join (select @v := -1, @rn := 0) params\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere t.lab_test = 1030\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\torder by t.patient_id, t.visit_date asc) t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere rn = 2)b on d.patient_id = b.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select t.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase t.test_result when 664 then 'Negative' when 703 then 'Positive' end as 3rd_DNA_PCR_result,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.visit_date                                                             as 3rd_DNA_PCR_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (select t.*, (@rn := if(@v = patient_id, @rn + 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(@v := patient_id, 1, 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) as rn\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcross join (select @v := -1, @rn := 0) params\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere t.lab_test = 1030\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\torder by t.patient_id, t.visit_date asc) t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere rn = 3)c on d.patient_id = c.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select ab.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase ab.final_antibody_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive' end as final_antibody_result,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tab.final_antibody_sample_date  as final_antibody_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_follow_up_visit ab\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by ab.patient_id)ab on d.patient_id = ab.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select v.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.dna_pcr_sample_date as          confirmatory_pcr_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.dna_pcr_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive' end as dna_confirmatory_results\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_follow_up_visit v\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere v.dna_pcr_contextual_status = 162082\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by v.patient_id)v on d.patient_id = v.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select x.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(mid(min(concat(x.visit_date, x.lab_test)), 11) = 856,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(x.visit_date, x.test_result)), 11), if(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(x.visit_date, x.lab_test)), 11) = 1305 and\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(x.visit_date, x.test_result)), 11) = 1302,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'LDL', '')) as baseline_vl_results,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin(x.visit_date)                                                   as baseline_vl_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract x\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere x.lab_test in (1305, 856)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by x.patient_id) baseline on d.patient_id = baseline.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i where d.hei_no is not null",
                "rank": 28,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "HeiExtract",
                "tempTableName": "TempHeiExtract",
                "id": "82651c00-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMatVisitExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MatVisitExtract",
                "display": "Mat Visit",
                "extractSql": "select d.patient_id                                                                      PatientPK,\r\n\t\t\t\t\t\t\t\t\ti.siteCode                                                                        SiteCode,\r\n\t\t\t\t\t\t\t\t\td.openmrs_id                                                                      PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                        Emr,\r\n\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                                   Project,\r\n\t\t\t\t\t\t\t\t\ti.facilityName                                                                    FacilityName,\r\n\t\t\t\t\t\t\t\t\t0 as FacilityId,\r\n\t\t\t\t\t\t\t\t\tl.visit_id                                                                        VisitID,\r\n\t\t\t\t\t\t\t\t\tl.visit_date                                                                      VisitDate,\r\n\t\t\t\t\t\t\t\t\tl.admission_number                                                                AdmissionNumber,\r\n\t\t\t\t\t\t\t\t\t''                                                                                ANCVisits,\r\n\t\t\t\t\t\t\t\t\tl.date_of_delivery                                                                DateOfDelivery,\r\n\t\t\t\t\t\t\t\t\tl.duration_of_labor                                                               DurationOfDelivery,\r\n\t\t\t\t\t\t\t\t\tl.duration_of_pregnancy                                                           GestationAtBirth,\r\n\t\t\t\t\t\t\t\t\tcase l.mode_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1170 then 'Normal delivery'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1171 then 'CS'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1172 then 'Breech'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 118159 then 'Assisted vaginal delivery' end                                ModeOfDelivery,\r\n\t\t\t\t\t\t\t\t\tcase l.placenta_complete\r\n\t\t\t\t\t\t\t\t\t\t\twhen 163455 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 163456 then 'No' end                                                       PlacentaComplete,\r\n\t\t\t\t\t\t\t\t\t''                                                                                UterotonicGiven,\r\n\t\t\t\t\t\t\t\t\t''                                                                                VaginalExamination,\r\n\t\t\t\t\t\t\t\t\t''                                                                                BloodLoss,\r\n\t\t\t\t\t\t\t\t\tcase l.blood_loss\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1499 then 'Moderate'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1498 then 'Mild'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'None'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1500 then 'Severe' end                                                     BloodLossVisual,\r\n\t\t\t\t\t\t\t\t\tcase l.condition_of_mother\r\n\t\t\t\t\t\t\t\t\t\t\twhen 160429 then 'Alive'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 134612 then 'Dead' end                                                     ConditonAfterDelivery,\r\n\t\t\t\t\t\t\t\t\t''                                                                                MaternalDeath,\r\n\t\t\t\t\t\t\t\t\tcoalesce(case l.coded_delivery_complications\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 118744 then 'Eclampsia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 113195 then 'Ruptured Uterus'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115036 then 'Obstructed Labor'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 228 then 'APH'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 230 then 'PPH'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 130 then 'Puerperal sepsis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Uknown' end, l.other_delivery_complications)           DeliveryComplications,\r\n\t\t\t\t\t\t\t\t\t(case l.delivery_outcome\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159913 then 1\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159914 then 2\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159915 then 3 end)                                                        NoBabiesDelivered,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as BabyBirthNumber,\r\n\t\t\t\t\t\t\t\t\tl.baby_sex                                                                     as SexBaby,\r\n\t\t\t\t\t\t\t\t\tl.birth_weight                                                                 as BirthWeight,\r\n\t\t\t\t\t\t\t\t\tcase l.baby_condition\r\n\t\t\t\t\t\t\t\t\t\t\twhen 151849 then 'Live birth'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 159916 then 'Fresh still birth'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 135436 then 'Macerated still birth' end                                 as BirthOutcome,\r\n\t\t\t\t\t\t\t\t\tcase l.birth_with_deformity\r\n\t\t\t\t\t\t\t\t\t\t\twhen 155871 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                     as BirthWithDeformity,\r\n\t\t\t\t\t\t\t\t\tcase l.teo_given\r\n\t\t\t\t\t\t\t\t\t\t\twhen 84893 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                     as TetracyclineGiven,\r\n\t\t\t\t\t\t\t\t\tcase l.bf_within_one_hour when 1065 then 'Yes' when 1066 then 'No' end         as InitiatedBF,\r\n\t\t\t\t\t\t\t\t\tl.apgar_score_1min                                                             as ApgarScore1,\r\n\t\t\t\t\t\t\t\t\tl.apgar_score_5min                                                             as ApgarScore5,\r\n\t\t\t\t\t\t\t\t\tl.apgar_score_10min                                                            as ApgarScore10,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as KangarooCare,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as ChlorhexidineApplied,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as VitaminKGiven,\r\n\t\t\t\t\t\t\t\t\tcase c.baby_status when 163016 then 'Alive' when 160432 then 'Dead' end        as StatusBabyDischarge,\r\n\t\t\t\t\t\t\t\t\tc.discharge_date                                                               as MotherDischargeDate,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as SyphilisTestResults,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as HIVStatusLastANC,\r\n\t\t\t\t\t\t\t\t\tif(l.final_test_result is not null, 'Yes', 'No')                               as HIVTestingDone,\r\n\t\t\t\t\t\t\t\t\tcase l.test_1_kit_name\r\n\t\t\t\t\t\t\t\t\t\t\twhen 164960 then 'Determine'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 164961 then 'First Response'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 165351 then 'Dual Kit' end                                              as HIVTest1,\r\n\t\t\t\t\t\t\t\t\tcase l.test_1_result\r\n\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 163611 then 'Invalid' end                                               as HIV1Results,\r\n\t\t\t\t\t\t\t\t\tcase l.test_2_kit_name\r\n\t\t\t\t\t\t\t\t\t\t\twhen 164960 then 'Determine'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 164961 then 'First Response'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 165351 then 'Dual Kit' end                                              as HIVTest2,\r\n\t\t\t\t\t\t\t\t\t\t\t''                                                                           as HIV2Results,\r\n\t\t\t\t\t\t\t\t\tcase l.final_test_result\r\n\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1138 then 'Invalid' end                                                 as HIVTestFinalResult,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as OnARTANC,\r\n\t\t\t\t\t\t\t\t\tif(l.baby_nvp_dispensed = 80586 or l.baby_azt_dispensed = 160123, 'Yes', 'No') as BabyGivenProphylaxis,\r\n\t\t\t\t\t\t\t\t\tcase l.prophylaxis_given\r\n\t\t\t\t\t\t\t\t\t\t\twhen 105281 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\telse '' end                                                                  as MotherGivenCTX,\r\n\t\t\t\t\t\t\t\t\tcase l.partner_hiv_tested when 1065 then 'Yes' when 1066 then 'No' end         as PartnerHIVTestingMAT,\r\n\t\t\t\t\t\t\t\t\tcase l.partner_hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'HIV Positive'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'HIV Negative'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end                                                 as PartnerHIVStatusMAT,\r\n\t\t\t\t\t\t\t\t\t\t\t'' as CounselledOn,\r\n\t\t\t\t\t\t\t\t#  concat_ws('|', nullif(case l.counseling_on_infant_feeding when 1065 then 'Infant feeding' end, ''), ''),\r\n\t\t\t\t\t\t\t\t\tc.referred_from                                                                as ReferredFrom,\r\n\t\t\t\t\t\t\t\t\tc.referred_to                                                                  as ReferredTo,\r\n\t\t\t\t\t\t\t\t\tl.clinical_notes                                                               as ClinicalNotes,\r\n\t\t\t\t\t\t\t\t\tl.date_created                                                                    Date_Created,\r\n\t\t\t\t\t\t\t\t\tGREATEST(COALESCE(l.date_last_modified, e.date_last_modified, c.date_last_modified),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCOALESCE(l.date_last_modified, e.date_last_modified,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.date_last_modified))                                       as Date_Last_Modified\r\n\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mchs_delivery l on d.patient_id = l.patient_id\r\n\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mchs_discharge c on d.patient_id = c.patient_id\r\n\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mch_enrollment e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\twhere l.visit_id is not null group by l.visit_id",
                "rank": 23,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MatVisitExtract",
                "tempTableName": "TempMatVisitExtract",
                "id": "826515fc-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMnchArtExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MnchArtExtract",
                "display": "Mnch Art",
                "extractSql": "select d.patient_id                                                                        as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                          as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                                                                        as PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td.hei_no                                                                            as PatientHeiID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'' as Pkv,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_patient_no                                                                 as PatientID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                          as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                                     as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ti.FacilityName                                                                      as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t0 as FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\te.date_first_enrolled_in_care                                                       as RegistrationAtCCC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleast(ifnull(mid(min(concat(e.visit_date, e.date_started_art_at_transferring_facility)), 11),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tde.date_started_art + interval rand()*1000 year), de.date_started_art) as StartARTDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.start_regimen                                                                    as StartRegimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.start_regimen_line                                                               as StartRegimenLine,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(p.patient_id is null, 'ACTIVE', p.status_at_ccc)                                 as StatusAtCCC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.last_art_date                                                                    as LastARTDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.last_regimen                                                                     as LastRegimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.last_regimen_line                                                                as LastRegimenLine,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                                            d.date_last_modified as Date_Last_Modified\r\n\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select m.patient_id, min(m.visit_date) as first_mch_enrolment_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_mch_enrollment m\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by m.patient_id)m on d.patient_id = m.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select c.patient_id, min(c.visit_date) as first_hei_enrolment_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_enrollment c\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by c.patient_id)c on d.patient_id = c.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tinner join (select e.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.visit_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.date_started_art_at_transferring_facility,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleast(min(e.visit_date), mid(min(concat(e.visit_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcoalesce(e.date_first_enrolled_in_care, date('9999-12-31')))),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t11)) as date_first_enrolled_in_care\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hiv_enrollment e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by e.patient_id)e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select de.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin(de.date_started)                                   as date_started_art,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(de.date_started, de.regimen_name)), 11) as start_regimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(de.date_started, de.regimen_line)), 11) as start_regimen_line,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(de.date_started, de.regimen_name)), 11) as last_regimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(de.date_started)                                   as last_art_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(de.date_started, de.regimen_line)), 11) as last_regimen_line\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_drug_event de\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by de.patient_id)de on d.patient_id = de.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select p.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(date(p.visit_date))                                                  as latest_disc,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(date(p.visit_date), (case p.discontinuation_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159492 then 'TransferOut'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5240 then 'LTFU'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160034 then 'Dead'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'OTHER' end))), 11) as status_at_ccc\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_program_discontinuation p\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by p.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thaving mid(max(concat(date(p.visit_date), p.program_name)), 11) = 'HIV') p\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton d.patient_id = p.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\t\twhere m.patient_id is not null\r\n\t\t\t\t\t\t\t\t\tor c.patient_id is not null\r\n\t\t\t\t\t\tgroup by d.patient_id",
                "rank": 21,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MnchArtExtract",
                "tempTableName": "TempMnchArtExtract",
                "id": "82651386-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMnchEnrolmentExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MnchEnrolmentExtract",
                "display": "Mnch Enrolment",
                "extractSql": "select d.patient_id                                                                 as PatientPK,\r\n       i.siteCode                                                                   as SiteCode,\r\n       d.openmrs_id                                                                 as PatientMnchID,\r\n    # d.hei_no                                                                     as PatientHEI_ID,\r\n       'KenyaEMR'                                                                   as Emr,\r\n       'Kenya HMIS II'                                                              as Project,\r\n       i.FacilityName                                                               as FacilityName,\r\n       0 as FacilityId,\r\n       (case m.service_type\r\n          when 1622 then 'ANC'\r\n          when 164835 then 'Delivery'\r\n          when 1623 then 'PNC'\r\n          else '' end)                                                              as ServiceType,\r\n       coalesce(c.hei_enrolment_date, m.mch_enrollment_date)                        as EnrollmentDateAtMnch,\r\n       m.anc_number                                                                 as MnchNumber,\r\n       m.first_anc_visit                                                            as FirstVisitAnc,\r\n       m.parity                                                                     as Parity,\r\n       m.gravida                                                                    as Gravidae,\r\n       m.lmp                                                                        as LMP,\r\n       coalesce(m.edd, date_add(date_add(m.lmp, interval 7 day), interval 9 month)) as EDDFromLMP,\r\n       (case m.hiv_status_before_anc\r\n          when 664 then 'Negative'\r\n          when 703 then 'Positive'\r\n          when 1067 then 'Unknown'\r\n          else '' end)                                                              as HIVStatusBeforeANC,\r\n       m.test_date                                                                  as HIVTestDate,\r\n       (case m.partner_status\r\n          when 664 then 'Negative'\r\n          when 703 then 'Positive'\r\n          when 1067 then 'Unknown'\r\n          else '' end)                                                              as PartnerHIVStatus,\r\n       m.partner_test_date                                                          as PartnerHIVTestDate,\r\n       (case m.blood_group\r\n          when 690 then 'A POSITIVE'\r\n          when 692 then 'A NEGATIVE'\r\n          when 694 then 'B POSITIVE'\r\n          when 696 then 'B NEGATIVE'\r\n          when 699 then 'O POSITIVE'\r\n          when 701 then 'O NEGATIVE'\r\n          when 1230 then 'AB POSITIVE'\r\n          when 1231 then 'AB NEGATIVE'\r\n          else '' end)                                                              as BloodGroup,\r\n       coalesce(m.status_in_mnch, c.status_in_cwc)                                  as StatusAtMnch,\r\n        d.date_created as Date_Created,\r\n        d.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n       left join (select m.patient_id,\r\n                         m.service_type          as service_type,\r\n                         m.visit_date            as mch_enrollment_date,\r\n                         m.anc_number            as anc_number,\r\n                         m.first_anc_visit_date  as first_anc_visit,\r\n                         m.parity                as parity,\r\n                         m.gravida               as gravida,\r\n                         m.lmp,\r\n                         m.edd_ultrasound        as edd,\r\n                         m.hiv_status            as hiv_status_before_anc,\r\n                         m.hiv_test_date         as test_date,\r\n                         m.partner_hiv_status    as partner_status,\r\n                         m.partner_hiv_test_date as partner_test_date,\r\n                         m.blood_group           as blood_group,\r\n                         p.status_in_prg         as status_in_mnch\r\n                  from kenyaemr_etl.etl_mch_enrollment m\r\n                         left join (select p.patient_id                                           as prg_patient,\r\n                                           p.date_enrolled                                        as date_enrolled,\r\n                                           if(p.date_completed is null, 'Active', (case d.discontinuation_reason\r\n                                                                                     when 160035 then 'Completed'\r\n                                                                                     when 159492 then 'Transferred Out'\r\n                                                                                     when 160034 then 'Died'\r\n                                                                                     when 5240 then 'Lost to Follow up'\r\n                                                                                     else '' end))as status_in_prg\r\n                                    from kenyaemr_etl.etl_patient_program p\r\n                                           left join kenyaemr_etl.etl_patient_program_discontinuation d\r\n                                             on p.patient_id = d.patient_id and p.date_completed = date(d.visit_date)\r\n                                    where p.program = 'MCH-Mother Services')p\r\n                           on m.patient_id = p.prg_patient and m.visit_date = p.date_enrolled\r\n                  group by m.visit_date)m on d.patient_id = m.patient_id\r\n       left join (select c.patient_id, c.visit_date as hei_enrolment_date, p.status_in_prg as status_in_cwc\r\n                  from kenyaemr_etl.etl_hei_enrollment c\r\n                         left join (select p.patient_id       as prg_patient,\r\n                                           p.date_enrolled    as date_enrolled,\r\n                                           d.discontinuation_reason,\r\n                                           if(p.date_completed is null or p.date_completed = '', 'Active',\r\n                                              (case d.discontinuation_reason\r\n                                                 when 1267 then 'Completed'\r\n                                                 when 159492 then 'Transferred Out'\r\n                                                 when 160034 then 'Died'\r\n                                                 when 5240 then 'Lost to Follow up'\r\n                                                 else '' end))as status_in_prg\r\n                                    from kenyaemr_etl.etl_patient_program p\r\n                                           left join kenyaemr_etl.etl_patient_program_discontinuation d\r\n                                             on p.patient_id = d.patient_id and p.date_completed = date(d.visit_date)\r\n                                    where p.program = 'MCH-Child Services')p\r\n                           on c.patient_id = p.prg_patient and c.visit_date = p.date_enrolled\r\n                  group by c.visit_date)c on d.patient_id = c.patient_id\r\n       join kenyaemr_etl.etl_default_facility_info i\r\n\t\t\twhere m.patient_id is not null\r\n   or c.patient_id is not null",
                "rank": 20,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MnchEnrolmentExtract",
                "tempTableName": "TempMnchEnrolmentExtract",
                "id": "82651214-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMnchLabExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MnchLabExtract",
                "display": "Mnch Labs",
                "extractSql": "select d.patient_id    as PatientPK,\r\n\t\t\t\t\t\t\t\t\ti.siteCode      as SiteCode,\r\n\t\t\t\t\t\t\t\t\td.openmrs_id    as PatientMNCH_ID,\r\n\t\t\t\t\t\t\t\t\t0             as FacilityID,\r\n\t\t\t\t\t\t\t\t\t'KenyaEMR'      as Emr,\r\n\t\t\t\t\t\t\t\t\t'Kenya HMIS II' as Project,\r\n\t\t\t\t\t\t\t\t\ti.FacilityName  as FacilityName,\r\n\t\t\t\t\t\t\t\t\t''              as SatelliteName,\r\n\t\t\t\t\t\t\t\t\tl.visit_id      as VisitID,\r\n\t\t\t\t\t\t\t\t\tl.sample_date   as OrderedByDate,\r\n\t\t\t\t\t\t\t\t\tl.results_date  as ReportedByDate,\r\n\t\t\t\t\t\t\t\t\tl.lab_test      as TestName,\r\n\t\t\t\t\t\t\t\t\tl.test_result   as TestResult,\r\n\t\t\t\t\t\t\t\t\tl.order_reason  as LabReason,\r\n\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                             d.date_last_modified as Date_Last_Modified\r\n\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\tinner join (select e.patient_id from kenyaemr_etl.etl_hiv_enrollment e)e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\tinner join (select m.patient_id from kenyaemr_etl.etl_mch_enrollment m)m on d.patient_id = m.patient_id\r\n\t\t\t\t\t\t\t\t\tinner join (select l.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.visit_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.date_test_requested             as sample_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.date_test_result_received       as results_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase l.lab_test\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5497 then 'CD4 Count'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 730 then 'CD4 PERCENT '\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 654 then 'ALT'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 790 then 'Serum creatinine (umol/L)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 856 then 'HIV VIRAL LOAD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1305 then 'HIV VIRAL LOAD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 21 then 'Hemoglobin (HGB)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse '' end                     as lab_test,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase l.order_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 843 then 'Regimen failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1259 then 'CHANGE REGIMEN'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1434 then 'PREGNANCY'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159882 then 'breastfeeding'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160566 then 'Immunologic failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160569 then 'Virologic failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161236 then 'Routine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162080 then 'Baseline'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162081 then 'Repeat'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163523 then 'Clinical failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse'' end                      as order_reason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 299, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1228 then 'REACTIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1229 then 'NON-REACTIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'POOR SAMPLE QUALITY' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 1030, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1138 then 'INDETERMINATE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'NEGATIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'POSITIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'POOR SAMPLE QUALITY' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 302, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1115 then 'Normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1116 then 'Abnormal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 32, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'NEGATIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'POSITIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1138 then 'INDETERMINATE' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 1305, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1306 then 'BEYOND DETECTABLE LIMIT'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1301 then 'DETECTED'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1302 then 'LDL'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'POOR SAMPLE QUALITY' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.test_result))))) as test_result\r\n                   from kenyaemr_etl.etl_laboratory_extract l)l on d.patient_id = l.patient_id join kenyaemr_etl.etl_default_facility_info i",
                "rank": 29,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MnchLabExtract",
                "tempTableName": "TempMnchLabExtract",
                "id": "82651cfa-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMotherBabyPairExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MotherBabyPairExtract",
                "display": "Mother Baby Pair",
                "extractSql": "select p.baby_patient_id   as BabyPatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.mother_patient_id as MotherPatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.mother_patient_id as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode          as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.hei_id            as BabyPatientMncHeiID,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.openmrs_id        as MotherPatientMncHeiID,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.ccc_no            as PatientIDCCC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'          as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'     as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\ti.FacilityName      as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t0 as FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                                d.date_last_modified as Date_Last_Modified\r\n\t\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\t\tinner join (select m.ccc_no,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.hei_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tm.patient_id      as mother_patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.baby_patient_id as baby_patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tm.openmrs_id      as openmrs_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (select m.patient_id, d.openmrs_id as openmrs_id, d.unique_patient_no as ccc_no\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_mch_enrollment m\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics d on m.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by m.patient_id)m\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join (select c.patient_id        as baby_patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.hei_no            as hei_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.parent_ccc_number as mother_ccc_no\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_enrollment c\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton c.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by c.patient_id)c on m.ccc_no = c.mother_ccc_no)p\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton d.unique_patient_no = p.ccc_no\r\n\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                "rank": 25,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MotherBabyPairExtract",
                "tempTableName": "TempMotherBabyPairExtract",
                "id": "82651886-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempPncVisitExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "PncVisitExtract",
                "display": "Pnc Visit",
                "extractSql": "select d.patient_id                                                                       PatientPK,\r\n\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                         SiteCode,\r\n\t\t\t\t\t\t\t\t\t\td.openmrs_id                                                                       PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                         Emr,\r\n\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                                    Project,\r\n\t\t\t\t\t\t\t\t\t\ti.facilityName                                                                     FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas FacilityId,\r\n\t\t\t\t\t\t\t\t\t\tp.visit_id                                                                         VisitID,\r\n\t\t\t\t\t\t\t\t\t\tp.visit_date                                                                       VisitDate,\r\n\t\t\t\t\t\t\t\t\t\tp.pnc_register_no                                                                  PNCRegisterNumber,\r\n\t\t\t\t\t\t\t\t\t\tp.pnc_visit_no                                                                     PNCVisitNo,\r\n\t\t\t\t\t\t\t\t\t\tp.delivery_date                                                                    DeliveryDate,\r\n\t\t\t\t\t\t\t\t\t\tcase p.mode_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1170 then 'Normal delivery'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1171 then 'CS'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1172 then 'Breech'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 118159 then 'Assisted vaginal delivery' end                                 ModeOfDelivery,\r\n\t\t\t\t\t\t\t\t\t\tcase p.place_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1589 then 'Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1536 then 'Home'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1601 then 'Born Before Arrival'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end                                                       PlaceOfDelivery,\r\n\t\t\t\t\t\t\t\t\t\tp.height                                                                           Height,\r\n\t\t\t\t\t\t\t\t\t\tp.weight                                                                           Weight,\r\n\t\t\t\t\t\t\t\t\t\tp.temperature                                                                      Temp,\r\n\t\t\t\t\t\t\t\t\t\tp.pulse_rate                                                                       PulseRate,\r\n\t\t\t\t\t\t\t\t\t\tp.respiratory_rate                                                                 RespiratoryRate,\r\n\t\t\t\t\t\t\t\t\t\tp.oxygen_saturation                                                                OxygenSaturation,\r\n\t\t\t\t\t\t\t\t\t\tp.muac                                                                             MUAC,\r\n\t\t\t\t\t\t\t\t\t\tconcat_ws('/', p.systolic_bp, p.diastolic_bp)                                      BP,\r\n\t\t\t\t\t\t\t\t\t\tif(breast is not null, 'Yes', 'No')                                                BreastExam,\r\n\t\t\t\t\t\t\t\t\t\tcase p.general_condition\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1855 then 'Good'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162133 then 'Fair'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162132 then 'Poor' end                                                   as GeneralCondition,\r\n\t\t\t\t\t\t\t\t\t\tcase p.pallor when 1065 then 'Yes' when 1066 then 'No' end                      as HasPallor,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                                 Pallor,\r\n\t\t\t\t\t\t\t\t\t\tcase p.breast\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1115 then 'Normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 143242 then 'Cracked nipple'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 127522 then 'Engorged nipple'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 115915 then 'Mastitis' end                                                  Breast,\r\n\t\t\t\t\t\t\t\t\t\tcase p.pph when 1065 then 'Present' when 1066 then 'Absent' end                 as PPH,\r\n\t\t\t\t\t\t\t\t\t\tcase p.cs_scar\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162129 then 'Wound intact and healing'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 145776 then 'Caesarean Wound Disruption'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 156794 then 'Infection of obstetric surgical wound'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162130 then 'Surgical wound healed'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'Not Applicable' end                                           as CSScar,\r\n\t\t\t\t\t\t\t\t\t\tcase p.gravid_uterus\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162111 then 'On exam, uterine fundus 12-16 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162112 then 'On exam, uterine fundus 16-20 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162113 then 'On exam, uterine fundus 20-24 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162114 then 'On exam, uterine fundus 24-28 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162115 then 'On exam, uterine fundus 28-32 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162116 then 'On exam, uterine fundus 32-34 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162117 then 'On exam, uterine fundus 34-36 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162118 then 'On exam, uterine fundus 36-38 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 123427 then 'Uterus Involuted' end                                       as UterusInvolution,\r\n\t\t\t\t\t\t\t\t\t\tcase p.episiotomy\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159842 then 'Repaired'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159843 then 'Healed'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159841 then 'Gaping'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 113919 then 'Infected'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'Not Applicable' end                                           as Episiotomy,\r\n\t\t\t\t\t\t\t\t\t\tcase p.lochia\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159721 then 'Normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159846 then 'Foul smelling'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159845 then 'Excessive' end                                              as Lochia,\r\n\t\t\t\t\t\t\t\t\t\tcase p.fistula_screening\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'None'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 49 then 'Vesicovaginal Fistula'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 127847 then 'Rectovaginal fistula'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1118 then 'Not done' end                                                 as Fistula,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                                 MaternalComplications,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                                 TBScreening,\r\n\t\t\t\t\t\t\t\t\t\tif(p.cacx_screening in (664, 703, 159393), 'Yes', 'No')                         as ClientScreenedCACx,\r\n\t\t\t\t\t\t\t\t\t\tcase p.cacx_screening_method\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 885 then 'Pap Smear'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162816 then 'VIA'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 164977 then 'VILI'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end                                                    as CACxScreenMethod,\r\n\t\t\t\t\t\t\t\t\t\tcase p.cacx_screening\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Norrmal'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159393 then 'Presumed'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Confirmed'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1118 then 'Not done'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                      as CACxScreenResults,\r\n\t\t\t\t\t\t\t\t\t\tcase e.hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end                                                  as PriorHIVStatus,\r\n\t\t\t\t\t\t\t\t\t\tif(p.final_test_result is not null or p.test_1_result is not null or p.test_2_result is not null, 'Yes',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'No')                                                                           HIVTestingDone,\r\n\t\t\t\t\t\t\t\t\t\tp.test_1_kit_lot_no                                                                HIVTest1,\r\n\t\t\t\t\t\t\t\t\t\tp.test_1_result                                                                    HIVTest1Result,\r\n\t\t\t\t\t\t\t\t\t\tp.test_2_kit_lot_no                                                                HIVTest2,\r\n\t\t\t\t\t\t\t\t\t\tp.test_2_result                                                                    HIVTest2Result,\r\n\t\t\t\t\t\t\t\t\t\tp.final_test_result                                                                HIVTestFinalResult,\r\n\t\t\t\t\t\t\t\t\t\tif(p.baby_nvp_dispensed = 80586 or p.baby_azt_dispensed = 160123, 'Yes', 'No') as InfantProphylaxisGiven,\r\n\t\t\t\t\t\t\t\t\t\tif(p.prophylaxis_given in (105281, 74250), 'Yes', 'No')                         as MotherProphylaxisGiven,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                              as CoupleCounselled,\r\n\t\t\t\t\t\t\t\t\t\tcase p.partner_hiv_tested\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\telse 'N/A' end                                                                as PartnerHIVTestingPNC,\r\n\t\t\t\t\t\t\t\t\t\tcase p.partner_hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end                                                  as PartnerHIVResultPNC,\r\n\t\t\t\t\t\t\t\t\t\tcase p.family_planning_counseling\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\telse '' end                                                                   as CounselledOnFP,\r\n\t\t\t\t\t\t\t\t\t\tcase p.family_planning_method\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 160570 then 'Emergency contraceptive pills'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 780 then 'Oral Contraceptives Pills'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5279 then 'Injectable'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1359 then 'Implant'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 136163 then 'Lactational Amenorhea Method'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5275 then 'Intrauterine Device'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5278 then 'Diaphram/Cervical Cap'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5277 then 'Fertility Awareness'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1472 then 'Tubal Ligation/Female sterilization'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 190 then 'Condoms'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1489 then 'Vasectomy(Partner)'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162332 then 'Undecided'\r\n\t\t\t\t\t\t\t\t\t\t\t\telse '' end                                                                   as ReceivedFP,\r\n\t\t\t\t\t\t\t\t\t\tcase p.iron_supplementation when 1065 then 'Yes' when 1066 then 'No' end        as HaematinicsGiven,\r\n\t\t\t\t\t\t\t\t\t\t(case p.delivery_outcome\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159913 then 'Single'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159914 then 'Twins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159915 then 'Triplets' end)                                             as DeliveryOutcome,\r\n\t\t\t\t\t\t\t\t\t\tcase p.condition_of_baby\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1855 then 'Good'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162133 then 'Poor'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162132 then 'Died' end                                                   as BabyConditon,\r\n\t\t\t\t\t\t\t\t\t\tcase p.baby_feeding_method\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5526 then 'Breastfed exclusively'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1595 then 'Replacement feeding'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 6046 then 'Mixed feeding'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159418 then 'Not at all sure' end                                        as BabyFeeding,\r\n\t\t\t\t\t\t\t\t\t\tp.umblical_cord                                                                 as UmbilicalCord,\r\n\t\t\t\t\t\t\t\t\t\tp.baby_immunization_started                                                     as Immunization,\r\n\t\t\t\t\t\t\t\t\t\tcase p.counselled_on_infant_feeding\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1066\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'No' end                                                         as InfantFeeding,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                              as PreventiveServices,\r\n\t\t\t\t\t\t\t\t\t\tcase p.referred_from\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                      as ReferredFrom,\r\n\t\t\t\t\t\t\t\t\t\tcase p.referred_to\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                      as ReferredTo,\r\n\t\t\t\t\t\t\t\t\t\tp.appointment_date                                                              as NextAppointmentPNC,\r\n\t\t\t\t\t\t\t\t\t\tp.clinical_notes                                                                as ClinicalNotes,\r\n\t\t\t\t\t\t\t\t\t\tp.date_created                                                                     Date_Created,\r\n\t\t\t\t\t\t\t\t\t\tp.date_last_modified                                                            as Date_Last_Modified\r\n\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_mch_postnatal_visit p on d.patient_id = p.patient_id\r\n\t\t\t\t\t\t\t\t\t\tinner join (select e.patient_id, mid(max(concat(e.visit_date, e.hiv_status)), 11) as hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_mch_enrollment e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by e.patient_id) e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\tgroup by p.visit_id",
                "rank": 24,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "PncVisitExtract",
                "tempTableName": "TempPncVisitExtract",
                "id": "82651750-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempPatientMnchExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "PatientMnchExtract",
                "display": "Mnch Patient",
                "extractSql": "select pkv.pkv as PKV,\r\n                         d.patient_id                                                    as PatientPK,\r\n                         d.national_unique_patient_identifier                            as NUPI,\r\n                         i.siteCode                                                      as SiteCode,\r\n                         d.openmrs_id                                                    as PatientMNCHID,\r\n                         d.hei_no                                                        as PatientHEIID,\r\n                         'KenyaEMR'                                                      as Emr,\r\n                         'Kenya HMIS II'                                                 as Project,\r\n                         i.FacilityName                                                  as FacilityName,\r\n                          0 as FacilityId,\r\n                         (case d.Gender when 'F' then 'Female' when 'M' then 'Male' end) as Gender,\r\n                         d.DOB                                                           as DOB,\r\n                         coalesce(c.hei_enrolment_date, m.mch_enrolment_date)            as FirstEnrollmentAtMnch,\r\n                         coalesce(c.hei_encounter_id, m.mch_encounter_id)                as EncounterId,\r\n                         d.occupation                                                    as Occupation,\r\n                         d.marital_status                                                as MaritalStatus,\r\n                         d.education_level                                               as EducationLevel,\r\n                         a.county                                                        as PatientResidentCounty,\r\n                         a.sub_county                                                    as PatientResidentSubCounty,\r\n                         a.ward                                                          as PatientResidentWard,\r\n                         (case e.in_school when 1 then 'Yes' when 2 then 'No' end)       as Inschool,\r\n                         d.date_created                                                  as Date_Created,\r\n                         d.date_last_modified                                            as Date_Last_Modified\r\n                  from kenyaemr_etl.etl_patient_demographics d\r\n                         left join (select m.patient_id, min(date(m.visit_date)) as mch_enrolment_date,mid(min(concat(date(m.visit_date),m.encounter_id)),11) as mch_encounter_id\r\n                                    from kenyaemr_etl.etl_mch_enrollment m group by m.patient_id)m on d.patient_id = m.patient_id\r\n                         left join (select c.patient_id, min(date(c.visit_date)) as hei_enrolment_date, mid(min(concat(date(c.visit_date),c.encounter_id)),11) as hei_encounter_id\r\n                                    from kenyaemr_etl.etl_hei_enrollment c group by c.patient_id)c on d.patient_id = c.patient_id\r\n                         left join (select a.patient_id, a.county, a.sub_county, a.ward from kenyaemr_etl.etl_person_address a)a\r\n                           on d.patient_id = a.patient_id\r\n                         left join (select e.patient_id as patient_id, e.in_school as in_school from kenyaemr_etl.etl_hiv_enrollment e)e\r\n                           on d.patient_id = e.patient_id\r\n                         inner join (select x.patient_id as patient_id,\r\n                                            x.sxFirstName,\r\n                                            x.sxLastname,\r\n                                            x.sxMiddleName,\r\n                                            x.dmFirstName,\r\n                                            x.dmLastName,\r\n                                            x.dmMiddleName,\r\n                                            x.Gender,\r\n                                            x.DOB,\r\n                                            CASE\r\n                                              WHEN locate(';', dmLastName) > 0 THEN CONCAT(\r\n                                                                                      CAST(LEFT(Gender, 1) AS CHAR CHARACTER SET utf8),\r\n                                                                                      CAST(sxFirstName AS CHAR CHARACTER SET utf8), CAST(\r\n                                                                                                                                      SUBSTRING(dmLastName, locate(';', dmLastName) + 1, LENGTH(dmLastName))\r\n                                                                                                                                      AS\r\n                                                                                                                                      CHAR CHARACTER SET utf8),\r\n                                                                                      CAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n                                                )\r\n                                              ELSE CONCAT(\r\n                                                     CAST(LEFT(Gender, 1)AS CHAR CHARACTER SET utf8),\r\n                                                     CAST(sxFirstName AS CHAR CHARACTER SET utf8),\r\n                                                     CAST(dmLastName AS CHAR CHARACTER SET utf8),\r\n                                                     CAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n                                                )\r\n                                                                                                    END      AS PKV\r\n                                                                                         from (SELECT patient_id,\r\n                                                                                                      SOUNDEX(UPPER(REPLACE(given_name, '0', 'O')))                           AS sxFirstName,\r\n                                                                                                      SOUNDEX(UPPER(REPLACE(family_name, '0', 'O')))                          AS sxLastName,\r\n                                                                                                      SOUNDEX(UPPER(REPLACE(middle_name, '0', 'O')))                          AS sxMiddleName,\r\n                                                                                                      fn_getPatientNameDoubleMetaphone(UPPER(REPLACE(given_name, '0', 'O')))  AS dmFirstName,\r\n                                                                                                      fn_getPatientNameDoubleMetaphone(UPPER(REPLACE(family_name, '0', 'O'))) AS dmLastName,\r\n                                                                                                      fn_getPatientNameDoubleMetaphone(UPPER(REPLACE(middle_name, '0', 'O'))) AS dmMiddleName,\r\n                                                                                                      Gender,\r\n                                                                                                      DOB\r\n                                                                                               FROM kenyaemr_etl.etl_patient_demographics)x)pkv on pkv.patient_id = d.patient_id\r\n                                                                             join kenyaemr_etl.etl_default_facility_info i\r\n                                                                      where m.patient_id is not null\r\n                                                                         or c.patient_id is not null\r\n                                                                      group by EncounterId",
                "rank": 19,
                "isPriority": true,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "PatientMnchExtract",
                "tempTableName": "TempPatientMnchExtract",
                "id": "82650e9a-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 164,
                    "loaded": 164,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 164,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempAncVisitExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "AncVisitExtract",
                "display": "Anc Visit",
                "extractSql": "select d.patient_id                                                                             PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                               SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                                                                             PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                               Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                                          Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\ti.facilityName                                                                           FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.visit_id                                                                               VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.visit_date                                                                             VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\te.anc_number                                                                             ANCClinicNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.anc_visit_number                                                                       ANCVisitNo,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.maturity                                                                               GestationWeeks,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.height                                                                                 Height,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.weight                                                                                 Weight,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.temperature                                                                            Temp,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.pulse_rate                                                                             PulseRate,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.respiratory_rate                                                                       RespiratoryRate,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.oxygen_saturation                                                                      OxygenSaturation,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.muac                                                                                   MUAC,\r\n\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('/', a.systolic_bp, a.diastolic_bp)                                            BP,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.breast_exam_done when 1065 then 'Yes' when 1066 then 'No' end                     BreastExam,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.anc_exercises when 1065 then 'Yes' when 1066 then 'No' end                        AntenatalExercises,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       FGM,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       FGMComplications,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.hemoglobin                                                                             Haemoglobin,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       DiabetesTest,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.tb_screening\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1660 then 'NO signs'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 142177 then 'TB presumed'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 164128 then 'No signs and started on INH'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1662 then 'TB Rx'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160737\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Not done (ND)' end                                                       TBScreening,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.cacx_screening\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159393 then 'Presumed'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Confirmed'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1118 then 'Not Done'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'N/A' end                                                                 CACxScreen,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.cacx_screening_method\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 885 then 'Pap Smear'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162816 then 'VIA'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 164977 then 'VILI'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Other' end                                                               CACxScreenMethod,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.who_stage\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1204 then 1\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1205 then 2\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1206 then 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1207\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 4 end                                                                     WHOStaging,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.vl_sample_taken when 856 then 'Yes' when 1066 then 'No' end                       VLSampleTaken,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       VLDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcoalesce(a.viral_load, a.ldl)                                                            VLResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.syphilis_treated_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'NA' end                                                                          SyphilisTreatment,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase e.hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Positive' then 'KP'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Unknown' then 'Unknown'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Negative' end                                                            HIVStatusBeforeANC,\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(a.final_test_result is not null or a.test_1_result is not null or a.test_2_result is not null, 'Yes',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'No')                                                                                 HIVTestingDone,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       HIVTestType,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.test_1_kit_lot_no                                                                      HIVTest1,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.test_1_result                                                                          HIVTest1Result,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.test_2_kit_lot_no                                                                      HIVTest2,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       HIVTest2Result,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.final_test_result                                                                      HIVTestFinalResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.syphilis_test_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1229 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1228 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1271 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1402 then 'ND'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'No' end                                                                          SyphilisTestDone,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       SyphilisTestType,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.syphilis_test_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1229 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1228 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'N/A' end                                                                         SyphilisTestResults,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.syphilis_treated_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'NA' end                                                                          SyphilisTreated,\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(a.final_test_result = 'Positive' or e.hiv_status = 'Positive', case a.prophylaxis_given\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 105281 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 74250 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'N/A' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'NA')                                                                                 MotherProphylaxisGiven,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.date_given_haart                                                                       MotherGivenHAART,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.baby_azt_dispensed\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160123 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'NA' end                                                                  AZTBabyDispense,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.baby_nvp_dispensed\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 80586 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'NA' end                                                                  NVPBabyDispense,\r\n\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case ci.chronic_illness\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 149019 then 'Alzheimers Disease and other Dementias'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 148432 then 'Arthritis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 153754 then 'Asthma'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159351 then 'Cancer'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 119270 then 'Cardiovascular diseases'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 120637 then 'Chronic Hepatitis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 145438 then 'Chronic Kidney Disease'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1295 then 'Chronic Obstructive Pulmonary Disease(COPD)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 120576 then 'Chronic Renal Failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 119692 then 'Cystic Fibrosis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 120291 then 'Deafness and Hearing impairment'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 119481 then 'Diabetes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 118631 then 'Endometriosis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117855 then 'Epilepsy'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117789 then 'Glaucoma'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 139071 then 'Heart Disease'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115728 then 'Hyperlipidaemia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117399 then 'Hypertension'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117321 then 'Hypothyroidism'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 151342 then 'Mental illness'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 133687 then 'Multiple Sclerosis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115115 then 'Obesity'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 114662 then 'Osteoporosis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117703 then 'Sickle Cell Anaemia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 118976 then 'Thyroid disease'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend SEPARATOR\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'|')                                                                        ChronicIllness,\r\n\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('|', nullif(case a.counselled_on_birth_plans when 159758 then 'Birth plans' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_danger_signs\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159857 then 'Danger signs' end, ''), nullif(case a.counselled_on_family_planning\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156277 then 'Family planning'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_hiv when 1914 then 'HIV' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_supplimental_feeding\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159854\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Supplimental feeding' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_breast_care when 159856 then 'Breast care' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.counselled_on_infant_feeding\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161651 then 'Infant feeding' end, ''), nullif(case a.counselled_on_treated_nets\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1381 then 'ITN'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t''))               CounselledOn,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.partner_hiv_tested\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'NA' end                                                                          PartnerHIVTestingANC,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.partner_hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'HIV Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'HIV Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'UNKNOWN' end                                                             PartnerHIVStatusANC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       PostParturmFP,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.deworming                                                                              Deworming,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.IPT_malaria                                                                            MalariaProphylaxis,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.TTT                                                                                    TetanusDose,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.iron_supplement                                                                        IronSupplementsGiven,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.bed_nets                                                                               ReceivedMosquitoNet,\r\n\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('|', nullif(case a.TTT when 'Yes' then 'Tetanus Toxoid' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.IPT_malaria when 'Yes' then 'Malaria  Prophylaxis' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.iron_supplement when 'Yes' then 'Folate / Iron ' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case a.deworming when 'Yes' then 'Mebendazole' end, ''), nullif(case a.bed_nets\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'Long-Lasting Insecticidal Net' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'')) as PreventiveServices,\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(a.urine_microscopy is not null or a.urinary_albumin is not null or a.glucose_measurement is not null\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tor a.urine_ph is not null or a.urine_gravity is not null or a.urine_nitrite_test is not null\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tor a.urine_dipstick_for_blood is not null or a.urine_leukocyte_esterace_test is not null or\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.urinary_ketone is not null\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tor a.urine_bile_pigment_test is not null or a.urine_bile_salt_test is not null or\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.urine_colour is not null or a.urine_turbidity is not null, 'Yes',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'No')                                                                                 UrinalysisVariables,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.referred_from\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' END                                                               ReferredFrom,\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase a.referred_to\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' END                                                            as ReferredTo,\r\n\t\t\t\t\t\t\t\t\t\t\t\t''                                                                                       ReferralReasons,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.next_appointment_date                                                                  NextAppointmentANC,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.clinical_notes                                                                         ClinicalNotes,\r\n\t\t\t\t\t\t\t\t\t\t\t\ta.date_created                                                                           Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\tGREATEST(COALESCE(a.date_last_modified, e.date_last_modified, ci.date_last_modified),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCOALESCE(a.date_last_modified, e.date_last_modified,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tci.date_last_modified))                                             as Date_Last_Modified\r\n\t\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mch_antenatal_visit a on d.patient_id = a.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\tleft join kenyaemr_etl.etl_allergy_chronic_illness ci on a.visit_id = ci.visit_id\r\n\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mch_enrollment e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\twhere a.visit_id is not null\r\n\t\t\t\t\tgroup by a.visit_id",
                "rank": 22,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "AncVisitExtract",
                "tempTableName": "TempAncVisitExtract",
                "id": "82651494-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempCwcEnrolmentExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "CwcEnrolmentExtract",
                "display": "Cwc Enrolment",
                "extractSql": "select d.patient_id              as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\td.openmrs_id              as PatientMNCH_ID,\r\n\t\t\t\t\t\t\t\t\t\t\ti.siteCode                as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\td.cwc_number              as PatientIDCWC,\r\n\t\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\td.hei_no                  as HEIID,\r\n\t\t\t\t\t\t\t\t\t\t\tpkv.PKV                   as Pkv,\r\n\t\t\t\t\t\t\t\t\t\t\te.initial_reg_at_cwc      as RegistrationAtCWC,\r\n\t\t\t\t\t\t\t\t\t\t\te.child_exposed           as MothersPkv,\r\n\t\t\t\t\t\t\t\t\t\t\te.initial_reg_at_cwc      as RegistrationAtHEI,\r\n\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'           as Project,\r\n\t\t\t\t\t\t\t\t\t\t\te.visit_id                as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\tnull      as Gestation,\r\n\t\t\t\t\t\t\t\t\t\t\te.birth_weight            as BirthWeight,\r\n\t\t\t\t\t\t\t\t\t\t\te.birth_length            as BirthLength,\r\n\t\t\t\t\t\t\t\t\t\t\te.birth_order             as BirthOrder,\r\n\t\t\t\t\t\t\t\t\t\t\te.birth_type              as BirthType,\r\n\t\t\t\t\t\t\t\t\t\t\te.place_of_delivery       as PlaceOfdelivery,\r\n\t\t\t\t\t\t\t\t\t\t\te.mode_of_delivery        as ModeOfDelivery,\r\n\t\t\t\t\t\t\t\t\t\t\te.has_special_needs       as SpecialNeeds,\r\n\t\t\t\t\t\t\t\t\t\t\te.reason_for_special_care as SpecialCare,\r\n\t\t\t\t\t\t\t\t\t\t\t'' as HEI,\r\n\t\t\t\t\t\t\t\t\t\t\te.is_mother_alive         as MotherAlive,\r\n\t\t\t\t\t\t\t\t\t\t\te.mother_ccc_no           as MothersCCCNo,\r\n\t\t\t\t\t\t\t\t\t\t\te.mother_art_regimen      as ARTRegimenMother,\r\n\t\t\t\t\t\t\t\t\t\t\t'' \t\t\t\t\t\t as ARTMother,\r\n\t\t\t\t\t\t\t\t\t\t\tnull\t\t\t\t\t\t as ARTStartDateMother,\r\n\t\t\t\t\t\t\t\t\t\t\tnull as HEIDate,\r\n\t\t\t\t\t\t\t\t\t\t\te.transfer_in             as TransferIn,\r\n\t\t\t\t\t\t\t\t\t\t\te.trf_in_date             as TransferInDate,\r\n\t\t\t\t\t\t\t\t\t\t\t'' \t\t\t\t         as TransferredFrom,\r\n\t\t\t\t\t\t\t\t\t\t\te.nvp_during_bf           as NVP,\r\n\t\t\t\t\t\t\t\t\t\t\te.breast_feeding          as BreastFeeding,\r\n\t\t\t\t\t\t\t\t\t\t\te.referred_from           as ReferredFrom,\r\n\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                            d.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\tinner join (select e.patient_id                                                             as patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.permanent_registration_serial                                          as permanent_reg_serial,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin(e.visit_date)                                                        as initial_reg_at_cwc,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.child_exposed\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 822 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end                                           as child_exposed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.visit_id                                                               as visit_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.gestation_at_birth                                                     as gestation_at_birth,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.birth_weight                                                           as birth_weight,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.birth_length                                                           as birth_length,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.birth_order                                                            as birth_order,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.birth_type\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159913 then 'Single'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159914 then 'Twins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159915 then 'Triplets'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 113450 then 'Quadruplets'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 113440 then 'Quintuplets' end                                     as birth_type,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.place_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1589 then 'Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1536 then 'Home'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end                                             as place_of_delivery,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.mode_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1170 then 'SVD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1171 then 'C-Section' end                                         as mode_of_delivery,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.need_for_special_care\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161628 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No' end                                                as has_special_needs,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.reason_for_special_care\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 116222 then 'Birth weight less than 2.5 kg'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162071 then 'Birth less than 2 years after last birth'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162072 then 'Fifth or more child'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162073 then 'Teenage mother'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162074 then 'Brother or sisters undernourished'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162075 then 'Multiple births(Twins,triplets)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162076 then 'Child in family dead'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1174 then 'Orphan'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161599 then 'Child has disability'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1859 then 'Parent HIV positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 123174\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'History/signs of child abuse/neglect' end                as reason_for_special_care,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.mother_alive when 1 then 'Yes' when 0 then 'No' else '' end       as is_mother_alive,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.parent_ccc_number                                                      as mother_ccc_no,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.mother_drug_regimen                                                    as mother_art_regimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.transfer_in when 1065 then 'Yes' when 1066 then 'No' end          as transfer_in,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.transfer_in_date                                                       as trf_in_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.facility_transferred_from                                              as facility_trf_from,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.mother_on_NVP_during_breastfeeding                                     as nvp_during_bf,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.mother_breastfeeding when 1065 then 'Yes' when 1066 then 'No' end as breast_feeding,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase e.referral_source\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160537 then 'Paediatric'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160542 then 'OPD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160456 then 'Maternity'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162050 then 'CCC'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160538 then 'MCH/PMTCT'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end                                             as referred_from,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmd.parent_pid as parent_pid\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_enrollment e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select d.patient_id as parent_pid, d.unique_patient_no as parent_ccc\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d)md\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton e.parent_ccc_number = md.parent_ccc\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by e.patient_id) e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select x.patient_id as patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.sxFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.sxLastname,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.sxMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.dmFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.dmLastName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.dmMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.Gender,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.DOB,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCASE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN locate(';', dmLastName) > 0 THEN CONCAT(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(LEFT(Gender, 1) AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(sxFirstName AS CHAR CHARACTER SET utf8), CAST(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSUBSTRING(dmLastName, locate(';', dmLastName) + 1, LENGTH(dmLastName))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE CONCAT(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(LEFT(Gender, 1)AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(sxFirstName AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(dmLastName AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEND      AS PKV\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (SELECT patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(given_name, '0', 'O')))                           AS sxFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(family_name, '0', 'O')))                          AS sxLastName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(middle_name, '0', 'O')))                          AS sxMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(given_name, '0', 'O')))  AS dmFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(family_name, '0', 'O'))) AS dmLastName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(middle_name, '0', 'O'))) AS dmMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tGender,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tDOB\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tFROM kenyaemr_etl.etl_patient_demographics)x)pkv on pkv.patient_id = e.parent_pid\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                "rank": 26,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "CwcEnrolmentExtract",
                "tempTableName": "TempCwcEnrolmentExtract",
                "id": "826519c6-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempCwcVisitExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "CwcVisitExtract",
                "display": "Cwc Visit",
                "extractSql": "select d.patient_id           as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\ti.siteCode             as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'             as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'        as Project,\r\n\t\t\t\t\t\t\t\t\t\t\ti.FacilityName         as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\td.openmrs_id           as PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t\tv.visit_date           as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\tv.visit_id             as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\tv.height               as Height,\r\n\t\t\t\t\t\t\t\t\t\t\tv.weight               as Weight,\r\n\t\t\t\t\t\t\t\t\t\t\tv.temperature          as Temp,\r\n\t\t\t\t\t\t\t\t\t\t\tv.pulse_rate           as PulseRate,\r\n\t\t\t\t\t\t\t\t\t\t\tv.respiratory_rate     as RespiratoryRate,\r\n\t\t\t\t\t\t\t\t\t\t\tv.oxygen_saturation    as OxygenSaturation,\r\n\t\t\t\t\t\t\t\t\t\t\tv.muac                 as MUAC,\r\n\t\t\t\t\t\t\t\t\t\t\tv.weight_category      as WeightCategory,\r\n\t\t\t\t\t\t\t\t\t\t\tv.stunted              as Stunted,\r\n\t\t\t\t\t\t\t\t\t\t\tv.infant_feeding       as InfantFeeding,\r\n\t\t\t\t\t\t\t\t\t\t\tv.medication_given     as MedicationGiven,\r\n\t\t\t\t\t\t\t\t\t\t\tv.tb_assessment        as TBAssessment,\r\n\t\t\t\t\t\t\t\t\t\t\tv.mnps_supplementation as MNPsSupplementation,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as Immunization,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as ImmunizationGiven,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as DangerSigns,\r\n\t\t\t\t\t\t\t\t\t\t\tv.milestones           as Milestones,\r\n\t\t\t\t\t\t\t\t\t\t\tv.vitaminA_given       as VitaminA,\r\n\t\t\t\t\t\t\t\t\t\t\tv.disability           as Disability,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as ReceivedMosquitoNet,\r\n\t\t\t\t\t\t\t\t\t\t\tv.dewormed             as Dewormed,\r\n\t\t\t\t\t\t\t\t\t\t\tv.referred_from        as ReferredFrom,\r\n\t\t\t\t\t\t\t\t\t\t\tv.referred_to          as ReferredTo,\r\n\t\t\t\t\t\t\t\t\t\t\t''                     as ReferralReasons,\r\n\t\t\t\t\t\t\t\t\t\t\tv.follow_up            as FollowUP,\r\n\t\t\t\t\t\t\t\t\t\t\tv.appointment_date     as NextAppointment,\r\n\t\t\t\t\t\t\t\t\t\t\tv.dna_pcr              as dnapcr,\r\n\t\t\t\t\t\t\t\t\t\t\tv.dna_pcr_date         as dnapcrdate,\r\n\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                                     d.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\tinner join (select v.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.visit_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.visit_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.height,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.weight,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.temperature,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.pulse_rate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.respiratory_rate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.oxygen_saturation,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case v.muac\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160909 then 'Green'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160910 then 'Yellow'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 127778 then 'Red'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse '' end)                                                       as muac,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.weight_category\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 123814 then 'Underweight(UW)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 126598 then 'Severely Underweight(SUW)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 114413 then 'Overweight(OW)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115115 then 'Obese(O)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1115 then 'Normal(N)' end                                      as weight_category,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.stunted when 164085 then 'Yes' when 1115 then 'No' end         as stunted,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.infant_feeding\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5526 then 'Exclusive Breastfeeding(EBF)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1595 then 'Exclusive Replacement(ERF)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 6046 then 'Mixed Feeding(MF)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse 'Not Breastfeeding' end                                        as infant_feeding,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('|', nullif(case v.azt_given when 'Yes' then 'AZT' when 'No' then '' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case v.nvp_given when 'Yes' then 'NVP' when 'No' then '' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case v.ctx_given when 'Yes' then 'CTX' when 'No' then '' end, ''),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullif(case v.multi_vitamin_given when 'Yes' then 'AZT' when 'No' then '' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t''))                                                 as medication_given,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.tb_assessment_outcome\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1660 then 'No TB Signs'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 142177 then 'Presumed TB'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1661 then 'TB Confirmed'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1662 then 'TB Rx'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1679 then 'INH'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160737 then 'Not Done'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse '' end                                                         as tb_assessment,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.review_of_systems_developmental\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1115 then 'Normal(N)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 6022 then 'Delayed(D)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 6025 then 'Regressed(R)' end                                   as milestones,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.vitaminA_given when 1065 then 'Yes' when 1066 then 'No' end    as vitaminA_given,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.disability when 1065 then 'Yes' when 1066 then 'No' end        as disability,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.deworming_drug when 79413 then 'Yes' when 70439 then 'Yes' end as dewormed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.counselled_on\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1914 then 'HIV'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1380 then 'Nutrition Services' end                             as follow_up,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.referred_from\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                            as referred_from,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.referred_to\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                            as referred_to,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.next_appointment_date                                               as appointment_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.dna_pcr_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1138 then 'Indeterminate'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'Poor sample quality' end                            as dna_pcr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.dna_pcr_sample_date                                                 as dna_pcr_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.MNPS_Supplementation                                                as mnps_supplementation\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_follow_up_visit v\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join kenyaemr_etl.etl_patient_triage t on v.visit_id = t.visit_id)v\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ton d.patient_id = v.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                "rank": 27,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "CwcVisitExtract",
                "tempTableName": "TempCwcVisitExtract",
                "id": "82651ade-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 701,
                    "loaded": 700,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 700,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempHeiExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "HeiExtract",
                "display": "Hei",
                "extractSql": "select d.patient_id                 as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\ti.siteCode                   as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                   as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'              as Project,\r\n\t\t\t\t\t\t\t\t\t\t\ti.FacilityName               as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                 as PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t\td.hei_no                     as PatientHeiId,\r\n\t\t\t\t\t\t\t\t\t\t\ta.1st_DNA_PCR_date           as DNAPCR1Date,\r\n\t\t\t\t\t\t\t\t\t\t\tb.2nd_DNA_PCR_date           as DNAPCR2Date,\r\n\t\t\t\t\t\t\t\t\t\t\tc.3rd_DNA_PCR_date           as DNAPCR3Date,\r\n\t\t\t\t\t\t\t\t\t\t\tv.confirmatory_pcr_date      as ConfirmatoryPCRDate,\r\n\t\t\t\t\t\t\t\t\t\t\tbaseline.baseline_vl_date    as BasellineVLDate,\r\n\t\t\t\t\t\t\t\t\t\t\tab.final_antibody_date       as FinalyAntibodyDate,\r\n\t\t\t\t\t\t\t\t\t\t\ta.1st_DNA_PCR_result         as DNAPCR1,\r\n\t\t\t\t\t\t\t\t\t\t\tb.2nd_DNA_PCR_result         as DNAPCR2,\r\n\t\t\t\t\t\t\t\t\t\t\tc.3rd_DNA_PCR_result         as DNAPCR3,\r\n\t\t\t\t\t\t\t\t\t\t\tv.dna_confirmatory_results   as ConfirmatoryPCR,\r\n\t\t\t\t\t\t\t\t\t\t\tbaseline.baseline_vl_results as BasellineVL,\r\n\t\t\t\t\t\t\t\t\t\t\tab.final_antibody_result     as FinalyAntibody,\r\n\t\t\t\t\t\t\t\t\t\t\tm.exit_date                  as HEIExitDate,\r\n\t\t\t\t\t\t\t\t\t\t\tm.hiv_status                 as HEIHIVStatus,\r\n\t\t\t\t\t\t\t\t\t\t\tm.exit_reason                as HEIExitCritearia,\r\n\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                                     d.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\tinner join (select m.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tm.hiv_status_at_exit as                            hiv_status,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tm.exit_date as                                     exit_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase m.exit_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1403 then 'HIV Neg age >18 months'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5240 then 'Lost'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160432 then 'Dead'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159492 then 'Transfer Out'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 138571 then 'Confirmed HIV Positive' end as exit_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_enrollment m)m on d.patient_id = m.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select t.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase t.test_result when 664 then 'Negative' when 703 then 'Positive' end as 1st_DNA_PCR_result,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.visit_date                                                             as 1st_DNA_PCR_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (select t.*, (@rn := if(@v = patient_id, @rn + 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(@v := patient_id, 1, 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) as rn\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcross join (select @v := -1, @rn := 0) params\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere t.lab_test = 1030\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\torder by t.patient_id, t.visit_date asc) t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere rn = 1)a on d.patient_id = a.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select t.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase t.test_result when 664 then 'Negative' when 703 then 'Positive' end as 2nd_DNA_PCR_result,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.visit_date                                                             as 2nd_DNA_PCR_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (select t.*, (@rn := if(@v = patient_id, @rn + 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(@v := patient_id, 1, 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) as rn\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcross join (select @v := -1, @rn := 0) params\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere t.lab_test = 1030\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\torder by t.patient_id, t.visit_date asc) t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere rn = 2)b on d.patient_id = b.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select t.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase t.test_result when 664 then 'Negative' when 703 then 'Positive' end as 3rd_DNA_PCR_result,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.visit_date                                                             as 3rd_DNA_PCR_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (select t.*, (@rn := if(@v = patient_id, @rn + 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(@v := patient_id, 1, 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) as rn\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcross join (select @v := -1, @rn := 0) params\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere t.lab_test = 1030\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\torder by t.patient_id, t.visit_date asc) t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere rn = 3)c on d.patient_id = c.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select ab.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase ab.final_antibody_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive' end as final_antibody_result,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tab.final_antibody_sample_date  as final_antibody_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_follow_up_visit ab\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by ab.patient_id)ab on d.patient_id = ab.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select v.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.dna_pcr_sample_date as          confirmatory_pcr_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase v.dna_pcr_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive' end as dna_confirmatory_results\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_follow_up_visit v\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere v.dna_pcr_contextual_status = 162082\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by v.patient_id)v on d.patient_id = v.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select x.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(mid(min(concat(x.visit_date, x.lab_test)), 11) = 856,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(x.visit_date, x.test_result)), 11), if(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(x.visit_date, x.lab_test)), 11) = 1305 and\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(x.visit_date, x.test_result)), 11) = 1302,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'LDL', '')) as baseline_vl_results,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin(x.visit_date)                                                   as baseline_vl_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract x\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere x.lab_test in (1305, 856)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by x.patient_id) baseline on d.patient_id = baseline.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i where d.hei_no is not null",
                "rank": 28,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "HeiExtract",
                "tempTableName": "TempHeiExtract",
                "id": "82651c00-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMatVisitExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MatVisitExtract",
                "display": "Mat Visit",
                "extractSql": "select d.patient_id                                                                      PatientPK,\r\n\t\t\t\t\t\t\t\t\ti.siteCode                                                                        SiteCode,\r\n\t\t\t\t\t\t\t\t\td.openmrs_id                                                                      PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                        Emr,\r\n\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                                   Project,\r\n\t\t\t\t\t\t\t\t\ti.facilityName                                                                    FacilityName,\r\n\t\t\t\t\t\t\t\t\t0 as FacilityId,\r\n\t\t\t\t\t\t\t\t\tl.visit_id                                                                        VisitID,\r\n\t\t\t\t\t\t\t\t\tl.visit_date                                                                      VisitDate,\r\n\t\t\t\t\t\t\t\t\tl.admission_number                                                                AdmissionNumber,\r\n\t\t\t\t\t\t\t\t\t''                                                                                ANCVisits,\r\n\t\t\t\t\t\t\t\t\tl.date_of_delivery                                                                DateOfDelivery,\r\n\t\t\t\t\t\t\t\t\tl.duration_of_labor                                                               DurationOfDelivery,\r\n\t\t\t\t\t\t\t\t\tl.duration_of_pregnancy                                                           GestationAtBirth,\r\n\t\t\t\t\t\t\t\t\tcase l.mode_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1170 then 'Normal delivery'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1171 then 'CS'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1172 then 'Breech'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 118159 then 'Assisted vaginal delivery' end                                ModeOfDelivery,\r\n\t\t\t\t\t\t\t\t\tcase l.placenta_complete\r\n\t\t\t\t\t\t\t\t\t\t\twhen 163455 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 163456 then 'No' end                                                       PlacentaComplete,\r\n\t\t\t\t\t\t\t\t\t''                                                                                UterotonicGiven,\r\n\t\t\t\t\t\t\t\t\t''                                                                                VaginalExamination,\r\n\t\t\t\t\t\t\t\t\t''                                                                                BloodLoss,\r\n\t\t\t\t\t\t\t\t\tcase l.blood_loss\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1499 then 'Moderate'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1498 then 'Mild'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'None'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1500 then 'Severe' end                                                     BloodLossVisual,\r\n\t\t\t\t\t\t\t\t\tcase l.condition_of_mother\r\n\t\t\t\t\t\t\t\t\t\t\twhen 160429 then 'Alive'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 134612 then 'Dead' end                                                     ConditonAfterDelivery,\r\n\t\t\t\t\t\t\t\t\t''                                                                                MaternalDeath,\r\n\t\t\t\t\t\t\t\t\tcoalesce(case l.coded_delivery_complications\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 118744 then 'Eclampsia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 113195 then 'Ruptured Uterus'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115036 then 'Obstructed Labor'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 228 then 'APH'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 230 then 'PPH'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 130 then 'Puerperal sepsis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Uknown' end, l.other_delivery_complications)           DeliveryComplications,\r\n\t\t\t\t\t\t\t\t\t(case l.delivery_outcome\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159913 then 1\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159914 then 2\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159915 then 3 end)                                                        NoBabiesDelivered,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as BabyBirthNumber,\r\n\t\t\t\t\t\t\t\t\tl.baby_sex                                                                     as SexBaby,\r\n\t\t\t\t\t\t\t\t\tl.birth_weight                                                                 as BirthWeight,\r\n\t\t\t\t\t\t\t\t\tcase l.baby_condition\r\n\t\t\t\t\t\t\t\t\t\t\twhen 151849 then 'Live birth'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 159916 then 'Fresh still birth'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 135436 then 'Macerated still birth' end                                 as BirthOutcome,\r\n\t\t\t\t\t\t\t\t\tcase l.birth_with_deformity\r\n\t\t\t\t\t\t\t\t\t\t\twhen 155871 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                     as BirthWithDeformity,\r\n\t\t\t\t\t\t\t\t\tcase l.teo_given\r\n\t\t\t\t\t\t\t\t\t\t\twhen 84893 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                     as TetracyclineGiven,\r\n\t\t\t\t\t\t\t\t\tcase l.bf_within_one_hour when 1065 then 'Yes' when 1066 then 'No' end         as InitiatedBF,\r\n\t\t\t\t\t\t\t\t\tl.apgar_score_1min                                                             as ApgarScore1,\r\n\t\t\t\t\t\t\t\t\tl.apgar_score_5min                                                             as ApgarScore5,\r\n\t\t\t\t\t\t\t\t\tl.apgar_score_10min                                                            as ApgarScore10,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as KangarooCare,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as ChlorhexidineApplied,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as VitaminKGiven,\r\n\t\t\t\t\t\t\t\t\tcase c.baby_status when 163016 then 'Alive' when 160432 then 'Dead' end        as StatusBabyDischarge,\r\n\t\t\t\t\t\t\t\t\tc.discharge_date                                                               as MotherDischargeDate,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as SyphilisTestResults,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as HIVStatusLastANC,\r\n\t\t\t\t\t\t\t\t\tif(l.final_test_result is not null, 'Yes', 'No')                               as HIVTestingDone,\r\n\t\t\t\t\t\t\t\t\tcase l.test_1_kit_name\r\n\t\t\t\t\t\t\t\t\t\t\twhen 164960 then 'Determine'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 164961 then 'First Response'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 165351 then 'Dual Kit' end                                              as HIVTest1,\r\n\t\t\t\t\t\t\t\t\tcase l.test_1_result\r\n\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 163611 then 'Invalid' end                                               as HIV1Results,\r\n\t\t\t\t\t\t\t\t\tcase l.test_2_kit_name\r\n\t\t\t\t\t\t\t\t\t\t\twhen 164960 then 'Determine'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 164961 then 'First Response'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 165351 then 'Dual Kit' end                                              as HIVTest2,\r\n\t\t\t\t\t\t\t\t\t\t\t''                                                                           as HIV2Results,\r\n\t\t\t\t\t\t\t\t\tcase l.final_test_result\r\n\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1138 then 'Invalid' end                                                 as HIVTestFinalResult,\r\n\t\t\t\t\t\t\t\t\t''                                                                             as OnARTANC,\r\n\t\t\t\t\t\t\t\t\tif(l.baby_nvp_dispensed = 80586 or l.baby_azt_dispensed = 160123, 'Yes', 'No') as BabyGivenProphylaxis,\r\n\t\t\t\t\t\t\t\t\tcase l.prophylaxis_given\r\n\t\t\t\t\t\t\t\t\t\t\twhen 105281 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\telse '' end                                                                  as MotherGivenCTX,\r\n\t\t\t\t\t\t\t\t\tcase l.partner_hiv_tested when 1065 then 'Yes' when 1066 then 'No' end         as PartnerHIVTestingMAT,\r\n\t\t\t\t\t\t\t\t\tcase l.partner_hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'HIV Positive'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'HIV Negative'\r\n\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end                                                 as PartnerHIVStatusMAT,\r\n\t\t\t\t\t\t\t\t\t\t\t'' as CounselledOn,\r\n\t\t\t\t\t\t\t\t#  concat_ws('|', nullif(case l.counseling_on_infant_feeding when 1065 then 'Infant feeding' end, ''), ''),\r\n\t\t\t\t\t\t\t\t\tc.referred_from                                                                as ReferredFrom,\r\n\t\t\t\t\t\t\t\t\tc.referred_to                                                                  as ReferredTo,\r\n\t\t\t\t\t\t\t\t\tl.clinical_notes                                                               as ClinicalNotes,\r\n\t\t\t\t\t\t\t\t\tl.date_created                                                                    Date_Created,\r\n\t\t\t\t\t\t\t\t\tGREATEST(COALESCE(l.date_last_modified, e.date_last_modified, c.date_last_modified),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCOALESCE(l.date_last_modified, e.date_last_modified,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.date_last_modified))                                       as Date_Last_Modified\r\n\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mchs_delivery l on d.patient_id = l.patient_id\r\n\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mchs_discharge c on d.patient_id = c.patient_id\r\n\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_mch_enrollment e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\twhere l.visit_id is not null group by l.visit_id",
                "rank": 23,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MatVisitExtract",
                "tempTableName": "TempMatVisitExtract",
                "id": "826515fc-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMnchArtExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MnchArtExtract",
                "display": "Mnch Art",
                "extractSql": "select d.patient_id                                                                        as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                          as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                                                                        as PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td.hei_no                                                                            as PatientHeiID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'' as Pkv,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_patient_no                                                                 as PatientID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                          as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                                     as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ti.FacilityName                                                                      as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t0 as FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\te.date_first_enrolled_in_care                                                       as RegistrationAtCCC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleast(ifnull(mid(min(concat(e.visit_date, e.date_started_art_at_transferring_facility)), 11),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tde.date_started_art + interval rand()*1000 year), de.date_started_art) as StartARTDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.start_regimen                                                                    as StartRegimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.start_regimen_line                                                               as StartRegimenLine,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif(p.patient_id is null, 'ACTIVE', p.status_at_ccc)                                 as StatusAtCCC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.last_art_date                                                                    as LastARTDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.last_regimen                                                                     as LastRegimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tde.last_regimen_line                                                                as LastRegimenLine,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                                            d.date_last_modified as Date_Last_Modified\r\n\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select m.patient_id, min(m.visit_date) as first_mch_enrolment_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_mch_enrollment m\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by m.patient_id)m on d.patient_id = m.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select c.patient_id, min(c.visit_date) as first_hei_enrolment_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_enrollment c\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by c.patient_id)c on d.patient_id = c.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tinner join (select e.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.visit_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.date_started_art_at_transferring_facility,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleast(min(e.visit_date), mid(min(concat(e.visit_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcoalesce(e.date_first_enrolled_in_care, date('9999-12-31')))),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t11)) as date_first_enrolled_in_care\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hiv_enrollment e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by e.patient_id)e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select de.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin(de.date_started)                                   as date_started_art,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(de.date_started, de.regimen_name)), 11) as start_regimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(min(concat(de.date_started, de.regimen_line)), 11) as start_regimen_line,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(de.date_started, de.regimen_name)), 11) as last_regimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(de.date_started)                                   as last_art_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(de.date_started, de.regimen_line)), 11) as last_regimen_line\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_drug_event de\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by de.patient_id)de on d.patient_id = de.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select p.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(date(p.visit_date))                                                  as latest_disc,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(date(p.visit_date), (case p.discontinuation_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159492 then 'TransferOut'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5240 then 'LTFU'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160034 then 'Dead'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'OTHER' end))), 11) as status_at_ccc\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_program_discontinuation p\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by p.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thaving mid(max(concat(date(p.visit_date), p.program_name)), 11) = 'HIV') p\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton d.patient_id = p.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\t\twhere m.patient_id is not null\r\n\t\t\t\t\t\t\t\t\tor c.patient_id is not null\r\n\t\t\t\t\t\tgroup by d.patient_id",
                "rank": 21,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MnchArtExtract",
                "tempTableName": "TempMnchArtExtract",
                "id": "82651386-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMnchEnrolmentExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MnchEnrolmentExtract",
                "display": "Mnch Enrolment",
                "extractSql": "select d.patient_id                                                                 as PatientPK,\r\n       i.siteCode                                                                   as SiteCode,\r\n       d.openmrs_id                                                                 as PatientMnchID,\r\n    # d.hei_no                                                                     as PatientHEI_ID,\r\n       'KenyaEMR'                                                                   as Emr,\r\n       'Kenya HMIS II'                                                              as Project,\r\n       i.FacilityName                                                               as FacilityName,\r\n       0 as FacilityId,\r\n       (case m.service_type\r\n          when 1622 then 'ANC'\r\n          when 164835 then 'Delivery'\r\n          when 1623 then 'PNC'\r\n          else '' end)                                                              as ServiceType,\r\n       coalesce(c.hei_enrolment_date, m.mch_enrollment_date)                        as EnrollmentDateAtMnch,\r\n       m.anc_number                                                                 as MnchNumber,\r\n       m.first_anc_visit                                                            as FirstVisitAnc,\r\n       m.parity                                                                     as Parity,\r\n       m.gravida                                                                    as Gravidae,\r\n       m.lmp                                                                        as LMP,\r\n       coalesce(m.edd, date_add(date_add(m.lmp, interval 7 day), interval 9 month)) as EDDFromLMP,\r\n       (case m.hiv_status_before_anc\r\n          when 664 then 'Negative'\r\n          when 703 then 'Positive'\r\n          when 1067 then 'Unknown'\r\n          else '' end)                                                              as HIVStatusBeforeANC,\r\n       m.test_date                                                                  as HIVTestDate,\r\n       (case m.partner_status\r\n          when 664 then 'Negative'\r\n          when 703 then 'Positive'\r\n          when 1067 then 'Unknown'\r\n          else '' end)                                                              as PartnerHIVStatus,\r\n       m.partner_test_date                                                          as PartnerHIVTestDate,\r\n       (case m.blood_group\r\n          when 690 then 'A POSITIVE'\r\n          when 692 then 'A NEGATIVE'\r\n          when 694 then 'B POSITIVE'\r\n          when 696 then 'B NEGATIVE'\r\n          when 699 then 'O POSITIVE'\r\n          when 701 then 'O NEGATIVE'\r\n          when 1230 then 'AB POSITIVE'\r\n          when 1231 then 'AB NEGATIVE'\r\n          else '' end)                                                              as BloodGroup,\r\n       coalesce(m.status_in_mnch, c.status_in_cwc)                                  as StatusAtMnch,\r\n        d.date_created as Date_Created,\r\n        d.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n       left join (select m.patient_id,\r\n                         m.service_type          as service_type,\r\n                         m.visit_date            as mch_enrollment_date,\r\n                         m.anc_number            as anc_number,\r\n                         m.first_anc_visit_date  as first_anc_visit,\r\n                         m.parity                as parity,\r\n                         m.gravida               as gravida,\r\n                         m.lmp,\r\n                         m.edd_ultrasound        as edd,\r\n                         m.hiv_status            as hiv_status_before_anc,\r\n                         m.hiv_test_date         as test_date,\r\n                         m.partner_hiv_status    as partner_status,\r\n                         m.partner_hiv_test_date as partner_test_date,\r\n                         m.blood_group           as blood_group,\r\n                         p.status_in_prg         as status_in_mnch\r\n                  from kenyaemr_etl.etl_mch_enrollment m\r\n                         left join (select p.patient_id                                           as prg_patient,\r\n                                           p.date_enrolled                                        as date_enrolled,\r\n                                           if(p.date_completed is null, 'Active', (case d.discontinuation_reason\r\n                                                                                     when 160035 then 'Completed'\r\n                                                                                     when 159492 then 'Transferred Out'\r\n                                                                                     when 160034 then 'Died'\r\n                                                                                     when 5240 then 'Lost to Follow up'\r\n                                                                                     else '' end))as status_in_prg\r\n                                    from kenyaemr_etl.etl_patient_program p\r\n                                           left join kenyaemr_etl.etl_patient_program_discontinuation d\r\n                                             on p.patient_id = d.patient_id and p.date_completed = date(d.visit_date)\r\n                                    where p.program = 'MCH-Mother Services')p\r\n                           on m.patient_id = p.prg_patient and m.visit_date = p.date_enrolled\r\n                  group by m.visit_date)m on d.patient_id = m.patient_id\r\n       left join (select c.patient_id, c.visit_date as hei_enrolment_date, p.status_in_prg as status_in_cwc\r\n                  from kenyaemr_etl.etl_hei_enrollment c\r\n                         left join (select p.patient_id       as prg_patient,\r\n                                           p.date_enrolled    as date_enrolled,\r\n                                           d.discontinuation_reason,\r\n                                           if(p.date_completed is null or p.date_completed = '', 'Active',\r\n                                              (case d.discontinuation_reason\r\n                                                 when 1267 then 'Completed'\r\n                                                 when 159492 then 'Transferred Out'\r\n                                                 when 160034 then 'Died'\r\n                                                 when 5240 then 'Lost to Follow up'\r\n                                                 else '' end))as status_in_prg\r\n                                    from kenyaemr_etl.etl_patient_program p\r\n                                           left join kenyaemr_etl.etl_patient_program_discontinuation d\r\n                                             on p.patient_id = d.patient_id and p.date_completed = date(d.visit_date)\r\n                                    where p.program = 'MCH-Child Services')p\r\n                           on c.patient_id = p.prg_patient and c.visit_date = p.date_enrolled\r\n                  group by c.visit_date)c on d.patient_id = c.patient_id\r\n       join kenyaemr_etl.etl_default_facility_info i\r\n\t\t\twhere m.patient_id is not null\r\n   or c.patient_id is not null",
                "rank": 20,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MnchEnrolmentExtract",
                "tempTableName": "TempMnchEnrolmentExtract",
                "id": "82651214-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMnchLabExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MnchLabExtract",
                "display": "Mnch Labs",
                "extractSql": "select d.patient_id    as PatientPK,\r\n\t\t\t\t\t\t\t\t\ti.siteCode      as SiteCode,\r\n\t\t\t\t\t\t\t\t\td.openmrs_id    as PatientMNCH_ID,\r\n\t\t\t\t\t\t\t\t\t0             as FacilityID,\r\n\t\t\t\t\t\t\t\t\t'KenyaEMR'      as Emr,\r\n\t\t\t\t\t\t\t\t\t'Kenya HMIS II' as Project,\r\n\t\t\t\t\t\t\t\t\ti.FacilityName  as FacilityName,\r\n\t\t\t\t\t\t\t\t\t''              as SatelliteName,\r\n\t\t\t\t\t\t\t\t\tl.visit_id      as VisitID,\r\n\t\t\t\t\t\t\t\t\tl.sample_date   as OrderedByDate,\r\n\t\t\t\t\t\t\t\t\tl.results_date  as ReportedByDate,\r\n\t\t\t\t\t\t\t\t\tl.lab_test      as TestName,\r\n\t\t\t\t\t\t\t\t\tl.test_result   as TestResult,\r\n\t\t\t\t\t\t\t\t\tl.order_reason  as LabReason,\r\n\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                             d.date_last_modified as Date_Last_Modified\r\n\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\tinner join (select e.patient_id from kenyaemr_etl.etl_hiv_enrollment e)e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\tinner join (select m.patient_id from kenyaemr_etl.etl_mch_enrollment m)m on d.patient_id = m.patient_id\r\n\t\t\t\t\t\t\t\t\tinner join (select l.patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.visit_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.date_test_requested             as sample_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.date_test_result_received       as results_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase l.lab_test\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5497 then 'CD4 Count'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 730 then 'CD4 PERCENT '\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 654 then 'ALT'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 790 then 'Serum creatinine (umol/L)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 856 then 'HIV VIRAL LOAD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1305 then 'HIV VIRAL LOAD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 21 then 'Hemoglobin (HGB)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse '' end                     as lab_test,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase l.order_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 843 then 'Regimen failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1259 then 'CHANGE REGIMEN'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1434 then 'PREGNANCY'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159882 then 'breastfeeding'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160566 then 'Immunologic failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160569 then 'Virologic failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161236 then 'Routine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162080 then 'Baseline'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162081 then 'Repeat'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163523 then 'Clinical failure'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse'' end                      as order_reason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 299, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1228 then 'REACTIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1229 then 'NON-REACTIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'POOR SAMPLE QUALITY' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 1030, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1138 then 'INDETERMINATE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'NEGATIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'POSITIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'POOR SAMPLE QUALITY' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 302, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1115 then 'Normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1116 then 'Abnormal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 32, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'NEGATIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'POSITIVE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1138 then 'INDETERMINATE' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(l.lab_test = 1305, (case l.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1306 then 'BEYOND DETECTABLE LIMIT'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1301 then 'DETECTED'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1302 then 'LDL'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1304 then 'POOR SAMPLE QUALITY' end),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.test_result))))) as test_result\r\n                   from kenyaemr_etl.etl_laboratory_extract l)l on d.patient_id = l.patient_id join kenyaemr_etl.etl_default_facility_info i",
                "rank": 29,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MnchLabExtract",
                "tempTableName": "TempMnchLabExtract",
                "id": "82651cfa-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempMotherBabyPairExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "MotherBabyPairExtract",
                "display": "Mother Baby Pair",
                "extractSql": "select p.baby_patient_id   as BabyPatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.mother_patient_id as MotherPatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.mother_patient_id as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode          as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.hei_id            as BabyPatientMncHeiID,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.openmrs_id        as MotherPatientMncHeiID,\r\n\t\t\t\t\t\t\t\t\t\t\t\tp.ccc_no            as PatientIDCCC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'          as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'     as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\ti.FacilityName      as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t0 as FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\td.date_created as Date_Created,\r\n                                                d.date_last_modified as Date_Last_Modified\r\n\t\t\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\t\tinner join (select m.ccc_no,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.hei_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tm.patient_id      as mother_patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.baby_patient_id as baby_patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tm.openmrs_id      as openmrs_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom (select m.patient_id, d.openmrs_id as openmrs_id, d.unique_patient_no as ccc_no\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_mch_enrollment m\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics d on m.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by m.patient_id)m\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join (select c.patient_id        as baby_patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.hei_no            as hei_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tc.parent_ccc_number as mother_ccc_no\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hei_enrollment c\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ton c.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by c.patient_id)c on m.ccc_no = c.mother_ccc_no)p\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton d.unique_patient_no = p.ccc_no\r\n\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                "rank": 25,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "MotherBabyPairExtract",
                "tempTableName": "TempMotherBabyPairExtract",
                "id": "82651886-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        },
        {
            "databaseProtocol": {
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "extracts": [],
                "databaseType": 2,
                "host": "localhost",
                "port": 3309,
                "username": "dwapi",
                "password": "dwapi",
                "databaseName": "openmrs",
                "advancedProperties": "Allow User Variables=True",
                "databaseTypeName": "MySQL",
                "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                "diffSupport": true,
                "supportsDifferential": true,
                "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
            },
            "extract": {
                "destination": "TempPncVisitExtract",
                "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                "docketId": "MNCH",
                "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                "name": "PncVisitExtract",
                "display": "Pnc Visit",
                "extractSql": "select d.patient_id                                                                       PatientPK,\r\n\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                         SiteCode,\r\n\t\t\t\t\t\t\t\t\t\td.openmrs_id                                                                       PatientMnchID,\r\n\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                         Emr,\r\n\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                                    Project,\r\n\t\t\t\t\t\t\t\t\t\ti.facilityName                                                                     FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t0 \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas FacilityId,\r\n\t\t\t\t\t\t\t\t\t\tp.visit_id                                                                         VisitID,\r\n\t\t\t\t\t\t\t\t\t\tp.visit_date                                                                       VisitDate,\r\n\t\t\t\t\t\t\t\t\t\tp.pnc_register_no                                                                  PNCRegisterNumber,\r\n\t\t\t\t\t\t\t\t\t\tp.pnc_visit_no                                                                     PNCVisitNo,\r\n\t\t\t\t\t\t\t\t\t\tp.delivery_date                                                                    DeliveryDate,\r\n\t\t\t\t\t\t\t\t\t\tcase p.mode_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1170 then 'Normal delivery'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1171 then 'CS'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1172 then 'Breech'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 118159 then 'Assisted vaginal delivery' end                                 ModeOfDelivery,\r\n\t\t\t\t\t\t\t\t\t\tcase p.place_of_delivery\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1589 then 'Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1536 then 'Home'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1601 then 'Born Before Arrival'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end                                                       PlaceOfDelivery,\r\n\t\t\t\t\t\t\t\t\t\tp.height                                                                           Height,\r\n\t\t\t\t\t\t\t\t\t\tp.weight                                                                           Weight,\r\n\t\t\t\t\t\t\t\t\t\tp.temperature                                                                      Temp,\r\n\t\t\t\t\t\t\t\t\t\tp.pulse_rate                                                                       PulseRate,\r\n\t\t\t\t\t\t\t\t\t\tp.respiratory_rate                                                                 RespiratoryRate,\r\n\t\t\t\t\t\t\t\t\t\tp.oxygen_saturation                                                                OxygenSaturation,\r\n\t\t\t\t\t\t\t\t\t\tp.muac                                                                             MUAC,\r\n\t\t\t\t\t\t\t\t\t\tconcat_ws('/', p.systolic_bp, p.diastolic_bp)                                      BP,\r\n\t\t\t\t\t\t\t\t\t\tif(breast is not null, 'Yes', 'No')                                                BreastExam,\r\n\t\t\t\t\t\t\t\t\t\tcase p.general_condition\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1855 then 'Good'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162133 then 'Fair'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162132 then 'Poor' end                                                   as GeneralCondition,\r\n\t\t\t\t\t\t\t\t\t\tcase p.pallor when 1065 then 'Yes' when 1066 then 'No' end                      as HasPallor,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                                 Pallor,\r\n\t\t\t\t\t\t\t\t\t\tcase p.breast\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1115 then 'Normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 143242 then 'Cracked nipple'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 127522 then 'Engorged nipple'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 115915 then 'Mastitis' end                                                  Breast,\r\n\t\t\t\t\t\t\t\t\t\tcase p.pph when 1065 then 'Present' when 1066 then 'Absent' end                 as PPH,\r\n\t\t\t\t\t\t\t\t\t\tcase p.cs_scar\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162129 then 'Wound intact and healing'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 145776 then 'Caesarean Wound Disruption'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 156794 then 'Infection of obstetric surgical wound'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162130 then 'Surgical wound healed'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'Not Applicable' end                                           as CSScar,\r\n\t\t\t\t\t\t\t\t\t\tcase p.gravid_uterus\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162111 then 'On exam, uterine fundus 12-16 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162112 then 'On exam, uterine fundus 16-20 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162113 then 'On exam, uterine fundus 20-24 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162114 then 'On exam, uterine fundus 24-28 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162115 then 'On exam, uterine fundus 28-32 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162116 then 'On exam, uterine fundus 32-34 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162117 then 'On exam, uterine fundus 34-36 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162118 then 'On exam, uterine fundus 36-38 week size'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 123427 then 'Uterus Involuted' end                                       as UterusInvolution,\r\n\t\t\t\t\t\t\t\t\t\tcase p.episiotomy\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159842 then 'Repaired'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159843 then 'Healed'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159841 then 'Gaping'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 113919 then 'Infected'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'Not Applicable' end                                           as Episiotomy,\r\n\t\t\t\t\t\t\t\t\t\tcase p.lochia\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159721 then 'Normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159846 then 'Foul smelling'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159845 then 'Excessive' end                                              as Lochia,\r\n\t\t\t\t\t\t\t\t\t\tcase p.fistula_screening\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'None'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 49 then 'Vesicovaginal Fistula'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 127847 then 'Rectovaginal fistula'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1118 then 'Not done' end                                                 as Fistula,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                                 MaternalComplications,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                                 TBScreening,\r\n\t\t\t\t\t\t\t\t\t\tif(p.cacx_screening in (664, 703, 159393), 'Yes', 'No')                         as ClientScreenedCACx,\r\n\t\t\t\t\t\t\t\t\t\tcase p.cacx_screening_method\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 885 then 'Pap Smear'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162816 then 'VIA'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 164977 then 'VILI'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end                                                    as CACxScreenMethod,\r\n\t\t\t\t\t\t\t\t\t\tcase p.cacx_screening\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Norrmal'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159393 then 'Presumed'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Confirmed'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1118 then 'Not done'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                      as CACxScreenResults,\r\n\t\t\t\t\t\t\t\t\t\tcase e.hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end                                                  as PriorHIVStatus,\r\n\t\t\t\t\t\t\t\t\t\tif(p.final_test_result is not null or p.test_1_result is not null or p.test_2_result is not null, 'Yes',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t'No')                                                                           HIVTestingDone,\r\n\t\t\t\t\t\t\t\t\t\tp.test_1_kit_lot_no                                                                HIVTest1,\r\n\t\t\t\t\t\t\t\t\t\tp.test_1_result                                                                    HIVTest1Result,\r\n\t\t\t\t\t\t\t\t\t\tp.test_2_kit_lot_no                                                                HIVTest2,\r\n\t\t\t\t\t\t\t\t\t\tp.test_2_result                                                                    HIVTest2Result,\r\n\t\t\t\t\t\t\t\t\t\tp.final_test_result                                                                HIVTestFinalResult,\r\n\t\t\t\t\t\t\t\t\t\tif(p.baby_nvp_dispensed = 80586 or p.baby_azt_dispensed = 160123, 'Yes', 'No') as InfantProphylaxisGiven,\r\n\t\t\t\t\t\t\t\t\t\tif(p.prophylaxis_given in (105281, 74250), 'Yes', 'No')                         as MotherProphylaxisGiven,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                              as CoupleCounselled,\r\n\t\t\t\t\t\t\t\t\t\tcase p.partner_hiv_tested\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\telse 'N/A' end                                                                as PartnerHIVTestingPNC,\r\n\t\t\t\t\t\t\t\t\t\tcase p.partner_hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 703 then 'Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 664 then 'Negative'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end                                                  as PartnerHIVResultPNC,\r\n\t\t\t\t\t\t\t\t\t\tcase p.family_planning_counseling\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No'\r\n\t\t\t\t\t\t\t\t\t\t\t\telse '' end                                                                   as CounselledOnFP,\r\n\t\t\t\t\t\t\t\t\t\tcase p.family_planning_method\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 160570 then 'Emergency contraceptive pills'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 780 then 'Oral Contraceptives Pills'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5279 then 'Injectable'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1359 then 'Implant'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 136163 then 'Lactational Amenorhea Method'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5275 then 'Intrauterine Device'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5278 then 'Diaphram/Cervical Cap'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5277 then 'Fertility Awareness'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1472 then 'Tubal Ligation/Female sterilization'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 190 then 'Condoms'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1489 then 'Vasectomy(Partner)'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162332 then 'Undecided'\r\n\t\t\t\t\t\t\t\t\t\t\t\telse '' end                                                                   as ReceivedFP,\r\n\t\t\t\t\t\t\t\t\t\tcase p.iron_supplementation when 1065 then 'Yes' when 1066 then 'No' end        as HaematinicsGiven,\r\n\t\t\t\t\t\t\t\t\t\t(case p.delivery_outcome\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159913 then 'Single'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159914 then 'Twins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159915 then 'Triplets' end)                                             as DeliveryOutcome,\r\n\t\t\t\t\t\t\t\t\t\tcase p.condition_of_baby\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1855 then 'Good'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162133 then 'Poor'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 162132 then 'Died' end                                                   as BabyConditon,\r\n\t\t\t\t\t\t\t\t\t\tcase p.baby_feeding_method\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 5526 then 'Breastfed exclusively'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1595 then 'Replacement feeding'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 6046 then 'Mixed feeding'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 159418 then 'Not at all sure' end                                        as BabyFeeding,\r\n\t\t\t\t\t\t\t\t\t\tp.umblical_cord                                                                 as UmbilicalCord,\r\n\t\t\t\t\t\t\t\t\t\tp.baby_immunization_started                                                     as Immunization,\r\n\t\t\t\t\t\t\t\t\t\tcase p.counselled_on_infant_feeding\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1066\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'No' end                                                         as InfantFeeding,\r\n\t\t\t\t\t\t\t\t\t\t''                                                                              as PreventiveServices,\r\n\t\t\t\t\t\t\t\t\t\tcase p.referred_from\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                      as ReferredFrom,\r\n\t\t\t\t\t\t\t\t\t\tcase p.referred_to\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1537 then 'Another Health Facility'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 163488 then 'Community Unit'\r\n\t\t\t\t\t\t\t\t\t\t\t\twhen 1175 then 'N/A' end                                                      as ReferredTo,\r\n\t\t\t\t\t\t\t\t\t\tp.appointment_date                                                              as NextAppointmentPNC,\r\n\t\t\t\t\t\t\t\t\t\tp.clinical_notes                                                                as ClinicalNotes,\r\n\t\t\t\t\t\t\t\t\t\tp.date_created                                                                     Date_Created,\r\n\t\t\t\t\t\t\t\t\t\tp.date_last_modified                                                            as Date_Last_Modified\r\n\t\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_mch_postnatal_visit p on d.patient_id = p.patient_id\r\n\t\t\t\t\t\t\t\t\t\tinner join (select e.patient_id, mid(max(concat(e.visit_date, e.hiv_status)), 11) as hiv_status\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_mch_enrollment e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by e.patient_id) e on d.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\tgroup by p.visit_id",
                "rank": 24,
                "isPriority": false,
                "emr": null,
                "mainName": "TempPatientExtracts",
                "tableName": "PncVisitExtract",
                "tempTableName": "TempPncVisitExtract",
                "id": "82651750-9db2-11eb-a8b3-0242ac130003",
                "extractEvent": {
                    "lastStatus": "Loaded",
                    "found": 0,
                    "loaded": 0,
                    "rejected": 0,
                    "excluded": 0,
                    "queued": 0,
                    "sent": 0
                }
            }
        }
    ]
}
