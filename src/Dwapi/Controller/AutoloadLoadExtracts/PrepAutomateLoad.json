{
    "loadPrepFromEmrCommand": {
        "extracts": [
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPatientPrepExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientPrepExtract",
                    "display": "Patient Prep",
                    "extractSql": "select d.patient_id                                                  as PatientPK,\r\n                    i.siteCode                                                    as SiteCode,\r\n                    i.facilityName                                                as FacilityName,\r\n                    d.unique_prep_number                                          as PrepNumber,\r\n                    d.national_unique_patient_identifier                          as NUPI,\r\n                    \r\n                    d.openmrs_id                                                  as HtsNumber,\r\n                    'KenyaEMR'                                                    as Emr,\r\n                    'HMIS'                                                        as Project,\r\n                    min(date(e.visit_date))                                       as PrepEnrollmentDate,\r\n                    case d.gender when 'M' then 'Male' when 'F' then 'Female' end as Sex,\r\n                    d.dob                                                         as DateOfBirth,\r\n                    d.birth_place                                                 as CountyOfBirth,\r\n                    pa.county                                                     as County,\r\n                    pa.sub_county                                                 as SubCounty,\r\n                    pa.location                                                   as Location,\r\n                    pa.land_mark                                                  as LandMark,\r\n                    pa.ward                                                       as Ward,\r\n                    e.patient_type                                                as ClientType,\r\n                    e.transfer_in_entry_point                                     as ReferralPoint,\r\n                    d.marital_status                                              as MaritalStatus,\r\n                    case e.in_school when 1 then 'Yes' when 2 then 'No' else null end as Inschool,\r\n                    (case e.population_type\r\n                    when 164928 then 'General Population'\r\n                    when 6096 then 'Discordant Couple'\r\n                    when 164929 then 'Key Population'\r\n                    else NULL end)                                           as PopulationType,\r\n                    case e.kp_type when 162277 then 'People in prison and other closed settings' when 165100 then 'Transgender' \r\n                    when 105 then 'PWID' when 160578 then 'MSM' when 165084 then 'MSW' when 160579 then 'FSW' end as KeyPopulationType,\r\n                    e.referred_from                                               as Refferedfrom,\r\n                    if(e.transfer_in_date is not null, 'Yes', 'No')               as TransferIn,\r\n                    date(e.transfer_in_date)                                      as TransferInDate,\r\n                    e.transfer_from                                               as TransferFromFacility,\r\n                    e.date_started_prep_trf_facility                              as DatefirstinitiatedinPrepCare,\r\n                    e.date_started_prep_trf_facility                              as DateStartedPrEPattransferringfacility,\r\n                    e.previously_on_prep                                          as ClientPreviouslyonPrep,\r\n                    e.regimen                                                     as PrevPrepReg,\r\n                    e.prep_last_date                                              as DateLastUsedPrev,\r\n                    e.date_created \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Created,\r\n                    e.date_last_modified \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Last_Modified\r\n                    from kenyaemr_etl.etl_prep_enrolment e\r\n                    left join kenyaemr_etl.etl_person_address pa on e.patient_id = pa.patient_id\r\n                    inner join kenyaemr_etl.etl_patient_demographics d on e.patient_id = d.patient_id\r\n                    inner join kenyaemr_etl.etl_prep_behaviour_risk_assessment r on e.patient_id = r.patient_id\r\n                    join kenyaemr_etl.etl_default_facility_info i\r\ngroup by e.patient_id",
                    "rank": 30,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientPrepExtract",
                    "tempTableName": "TempPatientPrepExtract",
                    "id": "82651dea-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 34,
                        "loaded": 34,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 34,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepAdverseEventExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepAdverseEventExtract",
                    "display": "Prep Adverse Events",
                    "extractSql": "select a.patient_id                                                 as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ts.siteCode                                                   as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tde.unique_prep_number                                         as PrepNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t0                                                            AS FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                   as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                              as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ts.FacilityName                                               as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.visit_date                                                 as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case a.cause\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 70056 then 'Abicavir'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162298 then 'ACE inhibitors'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 70878 then 'Allopurinol'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 155060 then 'Aminoglycosides'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162299 then 'ARBs (angiotensin II receptor blockers)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 103727 then 'Aspirin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 71647 then 'Atazanavir'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 72822 then 'Carbamazepine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162301 then 'Cephalosporins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 73300 then 'Chloroquine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 73667 then 'Codeine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 74807 then 'Didanosine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 75523 then 'Efavirenz'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162302 then 'Erythromycins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t75948 then 'Ethambutol'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 77164 then 'Griseofulvin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162305 then 'Heparins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 77675 then 'Hydralazine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 78280 then 'Isoniazid'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 794 then 'Lopinavir/ritonavir'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 80106 then 'Morphine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 80586 then 'Nevirapine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 80696 then 'Nitrofurans'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162306 then 'Non-steroidal anti-inflammatory drugs'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 81723 then 'Penicillamine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 81724 then 'Penicillin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 81959 then 'Phenolphthaleins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 82023 then 'Phenytoin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t82559 then 'Procainamide'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 82900 then 'Pyrazinamide'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 83018 then 'Quinidine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 767 then 'Rifampin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162307 then 'Statins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 84309 then 'Stavudine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162170 then 'Sulfonamides'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 84795 then 'Tenofovir'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 84893 then 'Tetracycline'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 86663 then 'Zidovudine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end SEPARATOR '|')   as AdverseEventCause,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case a.adverse_event\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 121629 then 'Anaemia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 148888 then 'Anaphylaxis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 148787 then 'Angioedema'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 120148 then 'Arrhythmia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 108 then 'Bronchospasm'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 143264 then 'Cough'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 142412 then 'Diarrhea'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 118773 then 'Dystonia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 140238 then 'Fever'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 140039 then 'Flushing'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 139581 then 'GI upset'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 139084 then 'Headache'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159098 then 'Hepatotoxicity'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 111061 then 'Hives'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117399 then 'Hypertension'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 879 then 'Itching'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 121677 then 'Mental status change'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159347 then 'Musculoskeletal pain'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 121 then 'Myalgia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 512 then 'Rash'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end SEPARATOR '|')   as AdverseEvent,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case a.severity\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1498 then 'Mild'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1499 then 'Moderate'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1500 then 'Severe'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162819 then 'Fatal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end SEPARATOR '|') as Severity,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(a.start_date SEPARATOR '|')                     as AdverseEventStartDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                           as AdverseEventEndDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case a.action_taken\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1257 then 'CONTINUE REGIMEN'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1259 then 'SWITCHED REGIMEN'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 981 then 'CHANGED DOSE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1258 then 'SUBSTITUTED DRUG'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'NONE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1260 then 'STOP'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end SEPARATOR '|')   as AdverseEventActionTaken,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                           as AdverseEventClinicalOutcome,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                           as AdverseEventIsPregnant,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                           as AdverseEventRegimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.date_created                                               as Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.date_last_modified                                         as Date_Last_Modified\r\n\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_adverse_events a\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select pe.patient_id, max(pe.visit_date) as prep_latest_enrolment_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_enrolment pe\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by pe.patient_id) pe on a.patient_id = pe.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join kenyaemr_etl.etl_prep_followup p on a.encounter_id = p.encounter_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select d.patient_id as         PrEP_disc_patient,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(date(d.visit_date)) PrEP_Outcome_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_discontinuation d\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by d.patient_id) pd on pd.PrEP_disc_patient = a.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics de on a.patient_id = de.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info s\r\n\t\t\t\t\t\t\twhere a.form in ('prep-initial','prep-consultation')\r\n\t\t\t\t\t\t\t\t\tand (pd.PrEP_disc_patient is null or pd.PrEP_Outcome_date < pe.prep_latest_enrolment_date)\r\n\t\t\t\t\t\t\tgroup by a.patient_id,a.visit_date",
                    "rank": 35,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepAdverseEventExtract",
                    "tempTableName": "TempPrepAdverseEventExtract",
                    "id": "82652358-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepBehaviourRiskExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepBehaviourRiskExtract",
                    "display": "Prep Behaviour Risk",
                    "extractSql": "select d.patient_id                                                                 as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                   as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_prep_number                                                         as PrepNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                                                                 as HtsNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                   as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'HMIS'                                                                       as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.visit_date                                                                 as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.visit_id                                                                   as VisitId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.sexual_partner_hiv_status                                                  as SexPartnerHIVStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.sexual_partner_on_art                                                      as IsHIVPositivePartnerCurrentonART,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case h.high_risk_partner when 'High risk partner' then 'Yes' else 'No' end) as IsPartnerHighRisk,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.risk                                                                       as PartnerARTRisk,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws(',', case sex_with_multiple_partners when 'Yes' then 'Has Sex with more than one partner' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase ipv_gbv when 'Yes' then 'Ongoing IPVor/and GBV' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase transactional_sex when 'Yes' then 'Transactional sex' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase recent_sti_infected when 'Yes' then 'Recent STI in the last 6 months' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase recurrent_pep_use when 'Yes' then 'Recurrent use of PEP' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase recurrent_sex_under_influence\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Yes' then 'Recurrent sex under influence of alcohol/recreational drugs'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase inconsistent_no_condom_use when 'Yes' then 'Inconsistent or no condom use' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase sharing_drug_needles\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Yes' then 'IDU with shared needles and/or syringes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend, other_reason_specify)                                     as ClientAssessments,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.assessment_outcome                                                         as ClientRisk,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.willing_to_take_prep                                                       as ClientWillingToTakePrEP,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.reason_not_willing                                                         as PrEPDeclineReason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.risk_edu_offered                                                           as RiskReductionEducationOffered,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.referral_for_prevention_services                                           as ReferralToOtherPrevServices,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdate(h.time_partner_hiv_positive_known)                                      as FirstEstablishPartnerStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.partner_enrolled_ccc                                                       as PartnerEnrolledToCCC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.partner_ccc_number                                                         as HIVPartnerCCCNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.partner_art_start_date                                                     as HIVPartnerARTStartDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.HIV_serodiscordant_duration_months                                         as MonthsKnownHIVSeroDiscordant,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.recent_unprotected_sex_with_positive_partner                               as SexWithoutCondom,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.children_with_hiv_positive_partner                                         as NumberofchildrenWithPartner,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.date_created \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.date_last_modified \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Last_Modified\r\n\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_behaviour_risk_assessment h\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_prep_enrolment e on h.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics d on e.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                    "rank": 31,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepBehaviourRiskExtract",
                    "tempTableName": "TempPrepBehaviourRiskExtract",
                    "id": "82651f02-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepCareTerminationExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepCareTerminationExtract",
                    "display": "Prep Care Termination",
                    "extractSql": "select d.patient_id as PatientPK,\r\n\t\t\t\t\t\t\t\ti.siteCode as SiteCode,\r\n\t\t\t\t\t\t\t\td.unique_prep_number as PrepNumber,\r\n\t\t\t\t\t\t\t\td.openmrs_id as HtsNumber,\r\n\t\t\t\t\t\t\t\t'KenyaEMR' as Emr, 'HMIS' as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_date as ExitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.discontinue_reason as ExitReason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(f.last_prep_dose_date AS DATE) as DateOfLastPrepDose,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_created as DateCreated,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_last_modified as DateModified\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_discontinuation f\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_patient_demographics d on d.patient_id = f.patient_id\r\n\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                    "rank": 35,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepCareTerminationExtract",
                    "tempTableName": "TempPrepCareTerminationExtract",
                    "id": "82652470-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepLabExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepLabExtract",
                    "display": "Prep Labs",
                    "extractSql": "select distinct '' AS SatelliteName, 0 AS FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_prep_number as PrepNumber, d.patient_id as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t d.openmrs_id as HtsNumber,l.encounter_id as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(l.visit_date AS DATE) as OrderedByDate,CAST(l.visit_date AS DATE) as TestResultDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.facilityName as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcn.name as TestName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.date_test_requested as SampleDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case l.order_reason when 843 then 'Confirmation of treatment failure (repeat VL)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1434 then 'Pregnancy' when 162080 then 'Baseline VL (for infants diagnosed through EID)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1259 then 'Single Drug Substitution' when 159882 then 'Breastfeeding'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163523 then 'Clinical failure' when 161236 then 'Routine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160032 then 'Confirmation of persistent low level Viremia (PLLV)' end) as Reason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen c.datatype_id=2 then cn2.name\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend as TestResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tNULL as EnrollmentTest,'' as SampleType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR' as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II' as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.date_created as Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tGREATEST(COALESCE(l.date_last_modified, d.date_last_modified), COALESCE(d.date_last_modified, l.date_last_modified)) as Date_Last_Modified\r\n\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract l\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_patient_demographics d on d.patient_id=l.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tjoin concept_name cn on cn.concept_id=l.lab_test and cn.concept_name_type='FULLY_SPECIFIED'and cn.locale='en'\r\n\t\t\t\t\t\t\t\t\t\t\tjoin concept c on c.concept_id = l.lab_test\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\t\t\t\t\t\t\tjoin (select p.patient_id from kenyaemr_etl.etl_prep_enrolment p)p on l.patient_id = p.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft outer join concept_name cn2 on cn2.concept_id=l.test_result and cn2.concept_name_type='FULLY_SPECIFIED'\r\n                                      and cn2.locale='en' where p.patient_id is not null",
                    "rank": 33,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepLabExtract",
                    "tempTableName": "TempPrepLabExtract",
                    "id": "8265213c-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepPharmacyExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepPharmacyExtract",
                    "display": "Prep Pharmacy",
                    "extractSql": "select d.patient_id                as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                  as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_prep_number        as PrepNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                as HtsNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0                           as FacilityID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                  as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'HMIS'                      as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_id                  as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.regimen_prescribed        as RegimenPrescribed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_date                as DispenseDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.months_prescribed_regimen as Duration,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_created              as Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_last_modified        as Date_Last_Modified\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_followup f\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_patient_demographics d on d.patient_id = f.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere f.prescribed_PrEP = 'Yes'",
                    "rank": 34,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepPharmacyExtract",
                    "tempTableName": "TempPrepPharmacyExtract",
                    "id": "82652272-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepVisitExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepVisitExtract",
                    "display": "Prep Visit",
                    "extractSql": "select d.patient_id                                              as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_prep_number                                      as PrepNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                                              as HtsNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.encounter_id                                            as EncounterId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'HMIS'                                                    as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_date                                              as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_id                                                as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('/', t.systolic_pressure, t.diastolic_pressure) as BloodPressure,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.temperature                                             as Temperature,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.weight                                                  as Weight,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.height                                                  as Height,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.sti_screened                                            as STIScreening,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws(',', f.genital_ulcer_disease,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.vaginal_discharge,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.cervical_discharge,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.pid,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.urethral_discharge,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.anal_discharge,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.other_sti_symptoms)                           as STISymptoms,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.sti_treated                                             as STITreated,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.vmmc_status                                             as Circumcised,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.vmmc_referred                                           as VMMCReferral,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.lmp                                                     as LMP,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.menopausal_status                                       as MenopausalStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.pregnant                                                as PregnantAtThisVisit,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.edd                                                     as EDD,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.wanted_pregnancy                                        as PlanningToGetPregnant,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.planned_pregnancy                                       as PregnancyPlanned,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.ended_pregnancy                                         as PregnancyEnded,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.outcome_date                                            as PregnancyEndDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.pregnancy_outcome                                       as PregnancyOutcome,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.defects                                                 as BirthDefects,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.breastfeeding                                           as BreastFeeding,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.fp_status                                               as FamilyPlanningStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.fp_method                                               as FPMethods,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.adherence_counselled                                    as AdherenceDone,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.adherence_outcome                                       as AdherenceOutcome,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.prep_contraindications                                  as ContraindicationsPrep,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.treatment_plan                                          as PrepTreatmentPlan,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.prescribed_PrEP                                         as PrepPrescribed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.regimen_prescribed                                      as RegimenPrescribed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.months_prescribed_regimen                               as MonthsPrescribed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.condoms_issued                                          as CondomsIssued,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.appointment_given                                       as Tobegivennextappointment,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.reason_no_appointment                                   as Reasonfornotgivingnextappointment,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.appointment_date                                        as NextAppointment,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.clinical_notes                                          as ClinicalNotes,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as AdherenceReasons,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as BMI,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as HepatitisBPositiveResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as HepatitisCPositiveResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as SymptomsAcuteHIV,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase f.hepatitisB_vaccinated when 1065 then 'Yes' when 1066 then 'No' end as VaccinationForHepBStarted,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase f.hepatitisB_treated when 1065 then 'Yes' when 1066 then 'No' when 1788 then 'Referred' end as TreatedForHepB,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase f.hepatitisC_vaccinated when 1065 then 'Yes' when 1066 then 'No'  end as VaccinationForHepCStarted,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase f.hepatitisC_treated when 1065 then 'Yes' when 1066 then 'No' when 1788 then 'Referred' end as TreatedForHepC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_created \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_last_modified \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Last_Modified\r\n\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_followup f\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join kenyaemr_etl.etl_patient_triage t on f.patient_id = t.patient_id and f.visit_date = t.visit_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_prep_enrolment e on f.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics d on e.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                    "rank": 32,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepVisitExtract",
                    "tempTableName": "TempPrepVisitExtract",
                    "id": "8265201a-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPatientPrepExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientPrepExtract",
                    "display": "Patient Prep",
                    "extractSql": "select d.patient_id                                                  as PatientPK,\r\n                    i.siteCode                                                    as SiteCode,\r\n                    i.facilityName                                                as FacilityName,\r\n                    d.unique_prep_number                                          as PrepNumber,\r\n                    d.national_unique_patient_identifier                          as NUPI,\r\n                    \r\n                    d.openmrs_id                                                  as HtsNumber,\r\n                    'KenyaEMR'                                                    as Emr,\r\n                    'HMIS'                                                        as Project,\r\n                    min(date(e.visit_date))                                       as PrepEnrollmentDate,\r\n                    case d.gender when 'M' then 'Male' when 'F' then 'Female' end as Sex,\r\n                    d.dob                                                         as DateOfBirth,\r\n                    d.birth_place                                                 as CountyOfBirth,\r\n                    pa.county                                                     as County,\r\n                    pa.sub_county                                                 as SubCounty,\r\n                    pa.location                                                   as Location,\r\n                    pa.land_mark                                                  as LandMark,\r\n                    pa.ward                                                       as Ward,\r\n                    e.patient_type                                                as ClientType,\r\n                    e.transfer_in_entry_point                                     as ReferralPoint,\r\n                    d.marital_status                                              as MaritalStatus,\r\n                    case e.in_school when 1 then 'Yes' when 2 then 'No' else null end as Inschool,\r\n                    (case e.population_type\r\n                    when 164928 then 'General Population'\r\n                    when 6096 then 'Discordant Couple'\r\n                    when 164929 then 'Key Population'\r\n                    else NULL end)                                           as PopulationType,\r\n                    case e.kp_type when 162277 then 'People in prison and other closed settings' when 165100 then 'Transgender' \r\n                    when 105 then 'PWID' when 160578 then 'MSM' when 165084 then 'MSW' when 160579 then 'FSW' end as KeyPopulationType,\r\n                    e.referred_from                                               as Refferedfrom,\r\n                    if(e.transfer_in_date is not null, 'Yes', 'No')               as TransferIn,\r\n                    date(e.transfer_in_date)                                      as TransferInDate,\r\n                    e.transfer_from                                               as TransferFromFacility,\r\n                    e.date_started_prep_trf_facility                              as DatefirstinitiatedinPrepCare,\r\n                    e.date_started_prep_trf_facility                              as DateStartedPrEPattransferringfacility,\r\n                    e.previously_on_prep                                          as ClientPreviouslyonPrep,\r\n                    e.regimen                                                     as PrevPrepReg,\r\n                    e.prep_last_date                                              as DateLastUsedPrev,\r\n                    e.date_created \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Created,\r\n                    e.date_last_modified \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Last_Modified\r\n                    from kenyaemr_etl.etl_prep_enrolment e\r\n                    left join kenyaemr_etl.etl_person_address pa on e.patient_id = pa.patient_id\r\n                    inner join kenyaemr_etl.etl_patient_demographics d on e.patient_id = d.patient_id\r\n                    inner join kenyaemr_etl.etl_prep_behaviour_risk_assessment r on e.patient_id = r.patient_id\r\n                    join kenyaemr_etl.etl_default_facility_info i\r\ngroup by e.patient_id",
                    "rank": 30,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientPrepExtract",
                    "tempTableName": "TempPatientPrepExtract",
                    "id": "82651dea-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 34,
                        "loaded": 34,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 34,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepAdverseEventExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepAdverseEventExtract",
                    "display": "Prep Adverse Events",
                    "extractSql": "select a.patient_id                                                 as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ts.siteCode                                                   as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tde.unique_prep_number                                         as PrepNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t0                                                            AS FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                   as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                              as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ts.FacilityName                                               as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.visit_date                                                 as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case a.cause\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 70056 then 'Abicavir'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162298 then 'ACE inhibitors'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 70878 then 'Allopurinol'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 155060 then 'Aminoglycosides'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162299 then 'ARBs (angiotensin II receptor blockers)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 103727 then 'Aspirin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 71647 then 'Atazanavir'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 72822 then 'Carbamazepine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162301 then 'Cephalosporins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 73300 then 'Chloroquine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 73667 then 'Codeine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 74807 then 'Didanosine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 75523 then 'Efavirenz'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162302 then 'Erythromycins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t75948 then 'Ethambutol'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 77164 then 'Griseofulvin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162305 then 'Heparins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 77675 then 'Hydralazine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 78280 then 'Isoniazid'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 794 then 'Lopinavir/ritonavir'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 80106 then 'Morphine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 80586 then 'Nevirapine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 80696 then 'Nitrofurans'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162306 then 'Non-steroidal anti-inflammatory drugs'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 81723 then 'Penicillamine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 81724 then 'Penicillin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 81959 then 'Phenolphthaleins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 82023 then 'Phenytoin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t82559 then 'Procainamide'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 82900 then 'Pyrazinamide'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 83018 then 'Quinidine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 767 then 'Rifampin'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162307 then 'Statins'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 84309 then 'Stavudine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162170 then 'Sulfonamides'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 84795 then 'Tenofovir'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 84893 then 'Tetracycline'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 86663 then 'Zidovudine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end SEPARATOR '|')   as AdverseEventCause,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case a.adverse_event\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 121629 then 'Anaemia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 148888 then 'Anaphylaxis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 148787 then 'Angioedema'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 120148 then 'Arrhythmia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 108 then 'Bronchospasm'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 143264 then 'Cough'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 142412 then 'Diarrhea'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 118773 then 'Dystonia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 140238 then 'Fever'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 140039 then 'Flushing'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 139581 then 'GI upset'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 139084 then 'Headache'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159098 then 'Hepatotoxicity'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 111061 then 'Hives'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 117399 then 'Hypertension'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 879 then 'Itching'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 121677 then 'Mental status change'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159347 then 'Musculoskeletal pain'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 121 then 'Myalgia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 512 then 'Rash'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end SEPARATOR '|')   as AdverseEvent,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case a.severity\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1498 then 'Mild'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1499 then 'Moderate'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1500 then 'Severe'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162819 then 'Fatal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1067 then 'Unknown' end SEPARATOR '|') as Severity,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(a.start_date SEPARATOR '|')                     as AdverseEventStartDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                           as AdverseEventEndDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup_concat(case a.action_taken\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1257 then 'CONTINUE REGIMEN'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1259 then 'SWITCHED REGIMEN'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 981 then 'CHANGED DOSE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1258 then 'SUBSTITUTED DRUG'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1107 then 'NONE'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1260 then 'STOP'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Other' end SEPARATOR '|')   as AdverseEventActionTaken,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                           as AdverseEventClinicalOutcome,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                           as AdverseEventIsPregnant,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                           as AdverseEventRegimen,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.date_created                                               as Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ta.date_last_modified                                         as Date_Last_Modified\r\n\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_adverse_events a\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select pe.patient_id, max(pe.visit_date) as prep_latest_enrolment_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_enrolment pe\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by pe.patient_id) pe on a.patient_id = pe.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join kenyaemr_etl.etl_prep_followup p on a.encounter_id = p.encounter_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select d.patient_id as         PrEP_disc_patient,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(date(d.visit_date)) PrEP_Outcome_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_discontinuation d\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by d.patient_id) pd on pd.PrEP_disc_patient = a.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics de on a.patient_id = de.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info s\r\n\t\t\t\t\t\t\twhere a.form in ('prep-initial','prep-consultation')\r\n\t\t\t\t\t\t\t\t\tand (pd.PrEP_disc_patient is null or pd.PrEP_Outcome_date < pe.prep_latest_enrolment_date)\r\n\t\t\t\t\t\t\tgroup by a.patient_id,a.visit_date",
                    "rank": 35,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepAdverseEventExtract",
                    "tempTableName": "TempPrepAdverseEventExtract",
                    "id": "82652358-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepBehaviourRiskExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepBehaviourRiskExtract",
                    "display": "Prep Behaviour Risk",
                    "extractSql": "select d.patient_id                                                                 as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                   as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_prep_number                                                         as PrepNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                                                                 as HtsNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                   as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'HMIS'                                                                       as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.visit_date                                                                 as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.visit_id                                                                   as VisitId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.sexual_partner_hiv_status                                                  as SexPartnerHIVStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.sexual_partner_on_art                                                      as IsHIVPositivePartnerCurrentonART,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case h.high_risk_partner when 'High risk partner' then 'Yes' else 'No' end) as IsPartnerHighRisk,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.risk                                                                       as PartnerARTRisk,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws(',', case sex_with_multiple_partners when 'Yes' then 'Has Sex with more than one partner' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase ipv_gbv when 'Yes' then 'Ongoing IPVor/and GBV' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase transactional_sex when 'Yes' then 'Transactional sex' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase recent_sti_infected when 'Yes' then 'Recent STI in the last 6 months' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase recurrent_pep_use when 'Yes' then 'Recurrent use of PEP' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase recurrent_sex_under_influence\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Yes' then 'Recurrent sex under influence of alcohol/recreational drugs'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase inconsistent_no_condom_use when 'Yes' then 'Inconsistent or no condom use' end,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase sharing_drug_needles\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 'Yes' then 'IDU with shared needles and/or syringes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend, other_reason_specify)                                     as ClientAssessments,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.assessment_outcome                                                         as ClientRisk,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.willing_to_take_prep                                                       as ClientWillingToTakePrEP,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.reason_not_willing                                                         as PrEPDeclineReason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.risk_edu_offered                                                           as RiskReductionEducationOffered,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.referral_for_prevention_services                                           as ReferralToOtherPrevServices,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdate(h.time_partner_hiv_positive_known)                                      as FirstEstablishPartnerStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.partner_enrolled_ccc                                                       as PartnerEnrolledToCCC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.partner_ccc_number                                                         as HIVPartnerCCCNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.partner_art_start_date                                                     as HIVPartnerARTStartDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.HIV_serodiscordant_duration_months                                         as MonthsKnownHIVSeroDiscordant,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.recent_unprotected_sex_with_positive_partner                               as SexWithoutCondom,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.children_with_hiv_positive_partner                                         as NumberofchildrenWithPartner,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.date_created \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\th.date_last_modified \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Last_Modified\r\n\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_behaviour_risk_assessment h\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_prep_enrolment e on h.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics d on e.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                    "rank": 31,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepBehaviourRiskExtract",
                    "tempTableName": "TempPrepBehaviourRiskExtract",
                    "id": "82651f02-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepCareTerminationExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepCareTerminationExtract",
                    "display": "Prep Care Termination",
                    "extractSql": "select d.patient_id as PatientPK,\r\n\t\t\t\t\t\t\t\ti.siteCode as SiteCode,\r\n\t\t\t\t\t\t\t\td.unique_prep_number as PrepNumber,\r\n\t\t\t\t\t\t\t\td.openmrs_id as HtsNumber,\r\n\t\t\t\t\t\t\t\t'KenyaEMR' as Emr, 'HMIS' as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_date as ExitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.discontinue_reason as ExitReason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(f.last_prep_dose_date AS DATE) as DateOfLastPrepDose,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_created as DateCreated,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_last_modified as DateModified\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_discontinuation f\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_patient_demographics d on d.patient_id = f.patient_id\r\n\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                    "rank": 35,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepCareTerminationExtract",
                    "tempTableName": "TempPrepCareTerminationExtract",
                    "id": "82652470-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepLabExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepLabExtract",
                    "display": "Prep Labs",
                    "extractSql": "select distinct '' AS SatelliteName, 0 AS FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_prep_number as PrepNumber, d.patient_id as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t d.openmrs_id as HtsNumber,l.encounter_id as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST(l.visit_date AS DATE) as OrderedByDate,CAST(l.visit_date AS DATE) as TestResultDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.facilityName as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcn.name as TestName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.date_test_requested as SampleDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case l.order_reason when 843 then 'Confirmation of treatment failure (repeat VL)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1434 then 'Pregnancy' when 162080 then 'Baseline VL (for infants diagnosed through EID)'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1259 then 'Single Drug Substitution' when 159882 then 'Breastfeeding'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163523 then 'Clinical failure' when 161236 then 'Routine'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160032 then 'Confirmation of persistent low level Viremia (PLLV)' end) as Reason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen c.datatype_id=2 then cn2.name\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.test_result\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend as TestResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tNULL as EnrollmentTest,'' as SampleType,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR' as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II' as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tl.date_created as Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tGREATEST(COALESCE(l.date_last_modified, d.date_last_modified), COALESCE(d.date_last_modified, l.date_last_modified)) as Date_Last_Modified\r\n\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_laboratory_extract l\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_patient_demographics d on d.patient_id=l.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tjoin concept_name cn on cn.concept_id=l.lab_test and cn.concept_name_type='FULLY_SPECIFIED'and cn.locale='en'\r\n\t\t\t\t\t\t\t\t\t\t\tjoin concept c on c.concept_id = l.lab_test\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\t\t\t\t\t\t\tjoin (select p.patient_id from kenyaemr_etl.etl_prep_enrolment p)p on l.patient_id = p.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft outer join concept_name cn2 on cn2.concept_id=l.test_result and cn2.concept_name_type='FULLY_SPECIFIED'\r\n                                      and cn2.locale='en' where p.patient_id is not null",
                    "rank": 33,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepLabExtract",
                    "tempTableName": "TempPrepLabExtract",
                    "id": "8265213c-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepPharmacyExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepPharmacyExtract",
                    "display": "Prep Pharmacy",
                    "extractSql": "select d.patient_id                as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                  as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_prep_number        as PrepNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                as HtsNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0                           as FacilityID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                  as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'HMIS'                      as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_id                  as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.regimen_prescribed        as RegimenPrescribed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_date                as DispenseDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.months_prescribed_regimen as Duration,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_created              as Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_last_modified        as Date_Last_Modified\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_followup f\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_patient_demographics d on d.patient_id = f.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere f.prescribed_PrEP = 'Yes'",
                    "rank": 34,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepPharmacyExtract",
                    "tempTableName": "TempPrepPharmacyExtract",
                    "id": "82652272-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "localhost",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "TempPrepVisitExtract",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "PREP",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PrepVisitExtract",
                    "display": "Prep Visit",
                    "extractSql": "select d.patient_id                                              as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_prep_number                                      as PrepNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td.openmrs_id                                              as HtsNumber,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.encounter_id                                            as EncounterId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'HMIS'                                                    as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_date                                              as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.visit_id                                                as VisitID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws('/', t.systolic_pressure, t.diastolic_pressure) as BloodPressure,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.temperature                                             as Temperature,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.weight                                                  as Weight,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt.height                                                  as Height,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.sti_screened                                            as STIScreening,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcat_ws(',', f.genital_ulcer_disease,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.vaginal_discharge,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.cervical_discharge,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.pid,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.urethral_discharge,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.anal_discharge,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.other_sti_symptoms)                           as STISymptoms,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.sti_treated                                             as STITreated,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.vmmc_status                                             as Circumcised,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.vmmc_referred                                           as VMMCReferral,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.lmp                                                     as LMP,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.menopausal_status                                       as MenopausalStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.pregnant                                                as PregnantAtThisVisit,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.edd                                                     as EDD,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.wanted_pregnancy                                        as PlanningToGetPregnant,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.planned_pregnancy                                       as PregnancyPlanned,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.ended_pregnancy                                         as PregnancyEnded,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.outcome_date                                            as PregnancyEndDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.pregnancy_outcome                                       as PregnancyOutcome,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.defects                                                 as BirthDefects,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.breastfeeding                                           as BreastFeeding,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.fp_status                                               as FamilyPlanningStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.fp_method                                               as FPMethods,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.adherence_counselled                                    as AdherenceDone,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.adherence_outcome                                       as AdherenceOutcome,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.prep_contraindications                                  as ContraindicationsPrep,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.treatment_plan                                          as PrepTreatmentPlan,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.prescribed_PrEP                                         as PrepPrescribed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.regimen_prescribed                                      as RegimenPrescribed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.months_prescribed_regimen                               as MonthsPrescribed,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.condoms_issued                                          as CondomsIssued,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.appointment_given                                       as Tobegivennextappointment,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.reason_no_appointment                                   as Reasonfornotgivingnextappointment,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.appointment_date                                        as NextAppointment,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.clinical_notes                                          as ClinicalNotes,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as AdherenceReasons,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as BMI,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as HepatitisBPositiveResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as HepatitisCPositiveResult,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'' as SymptomsAcuteHIV,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase f.hepatitisB_vaccinated when 1065 then 'Yes' when 1066 then 'No' end as VaccinationForHepBStarted,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase f.hepatitisB_treated when 1065 then 'Yes' when 1066 then 'No' when 1788 then 'Referred' end as TreatedForHepB,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase f.hepatitisC_vaccinated when 1065 then 'Yes' when 1066 then 'No'  end as VaccinationForHepCStarted,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase f.hepatitisC_treated when 1065 then 'Yes' when 1066 then 'No' when 1788 then 'Referred' end as TreatedForHepC,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_created \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tf.date_last_modified \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tas Date_Last_Modified\r\n\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_prep_followup f\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join kenyaemr_etl.etl_patient_triage t on f.patient_id = t.patient_id and f.visit_date = t.visit_date\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_prep_enrolment e on f.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics d on e.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i",
                    "rank": 32,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PrepVisitExtract",
                    "tempTableName": "TempPrepVisitExtract",
                    "id": "8265201a-9db2-11eb-a8b3-0242ac130003",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 0,
                        "loaded": 0,
                        "rejected": 0,
                        "excluded": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            }
        ]
    }
}
