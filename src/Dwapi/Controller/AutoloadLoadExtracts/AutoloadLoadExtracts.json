{
    "loadFromEmrCommand": {
        "loadChangesOnly": false,
        "extracts": [
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientExtract",
                    "display": "All Patients",
                    "extractSql": "select\r\n\t\t\t\t\t\t\t\t\t\t\tCASE WHEN prg.program='TB' THEN prg.status  ELSE null end  AS StatusAtTBClinic,\r\n\t\t\t\t\t\t\t\t\t\t\tCASE WHEN prg.program='MCH-Mother Services' THEN prg.status  ELSE null end  AS  StatusAtPMTCT,\r\n\t\t\t\t\t\t\t\t\t\t\tCASE WHEN prg.program='HIV' THEN prg.status  ELSE null end  AS   StatusATCCC,\r\n\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t'' AS SatelliteName,\r\n\t\t\t\t\t\t\t\t\t\t\t0 AS FacilityId,d.unique_patient_no as PatientID,\r\n\t\t\t\t\t\t\t\t\t\t\td.patient_id as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\td.national_unique_patient_identifier as NUPI,\r\n\t\t\t\t\t\t\t\t\t\t\tpkv.PKV as Pkv,\r\n\t\t\t\t\t\t\t\t\t\t\ti.siteCode as SiteCode,\r\n                                            i.facilityName as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\tcase d.gender when 'M' then 'Male' when 'F' then 'Female' end  as Gender,\r\n\t\t\t\t\t\t\t\t\t\t\td.dob as DOB,\r\n\t\t\t\t\t\t\t\t\t\t\tCAST(min(hiv.visit_date) as Date) as RegistrationDate,\r\n\t\t\t\t\t\t\t\t\t\t\tCAST(coalesce(date_first_enrolled_in_care,min(hiv.visit_date)) as Date) as RegistrationAtCCC,\r\n\t\t\t\t\t\t\t\t\t\t\tCAST(min(mch.visit_date)as Date) as RegistrationATPMTCT,\r\n\t\t\t\t\t\t\t\t\t\t\tCAST(min(tb.visit_date)as Date) as RegistrationAtTBClinic,\r\n\t\t\t\t\t\t\t\t\t\t\tcase  max(hiv.entry_point)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160542 then 'OPD'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160563 then 'Other'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160539 then 'VCT'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160538 then 'PMTCT'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160541 then 'TB'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160536 then 'IPD - Adult'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/*else cn.name*/\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend as PatientSource,\r\n\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t(select state_province from location\r\n\t\t\t\t\t\t\t\t\t\t\t\twhere location_id in (select property_value\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom global_property\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere property='kenyaemr.defaultLocation')) as Region,\r\n\t\t\t\t\t\t\t\t\t\t\t(select county_district from location\r\n\t\t\t\t\t\t\t\t\t\t\t\twhere location_id in (select property_value\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom global_property\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere property='kenyaemr.defaultLocation'))as District,\r\n\t\t\t\t\t\t\t\t\t\t\t(select address6 from location\r\n\t\t\t\t\t\t\t\t\t\t\t\twhere location_id in (select property_value\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom global_property\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere property='kenyaemr.defaultLocation')) as Village,\r\n\t\t\t\t\t\t\t\t\t\t\tUPPER(ts.name) as ContactRelation,\r\n\t\t\t\t\t\t\t\t\t\t\tCAST(GREATEST(coalesce(max(hiv.visit_date),date('1000-01-01')),coalesce(max(de.visit_date),date('1000-01-01')), coalesce(max(enr.visit_date),date('1000-01-01'))) as Date) as LastVisit,\r\n\t\t\t\t\t\t\t\t\t\t\tUPPER(d.marital_status) as MaritalStatus,\r\n\t\t\t\t\t\t\t\t\t\t\tUPPER(d.education_level) as EducationLevel,\r\n\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tCAST(min(hiv.date_confirmed_hiv_positive) as Date) as DateConfirmedHIVPositive,\r\n\t\t\t\t\t\t\t\t\t\t\tmax(hiv.arv_status) as PreviousARTExposure,\r\n\t\t\t\t\t\t\t\t\t\t\tNULL as PreviousARTStartDate,\r\n\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR' as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II' as Project,\r\n\t\t\t\t\t\t\t\t\t\t\tCASE hiv.patient_type\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 160563 THEN 'Transfer in'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 164144\tTHEN 'New client'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 159833\tTHEN 'Re-enroll'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 164931 THEN 'Transit'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tELSE hiv.patient_type\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEND AS PatientType,\r\n\t\t\t\t\t\t\t\t\t\t\tif (c.client_id is not null,'Key population', (select CASE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN mid(max(concat(f.visit_date,f.population_type)),11)=164929\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTHEN 'Key population'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN mid(max(concat(f.visit_date,f.population_type)),11)=164928 THEN 'General Population'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEND  from  kenyaemr_etl.etl_patient_hiv_followup f\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHERE f.encounter_id=max(enr.encounter_id) group by f.patient_id)) AS PopulationType,\r\n\t\t\t\t\t\t\t\t\t\t\tCOALESCE(c.key_population_type,(select\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase mid(max(concat(f.visit_date,f.key_population_type)),11)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 105 THEN 'PWID'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 160578 THEN 'MSM'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 160579  THEN 'FSW'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHEN 1175 THEN 'N/A'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE null END\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom  kenyaemr_etl.etl_patient_hiv_followup f\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWHERE f.encounter_id=max(enr.encounter_id) group by f.patient_id)) AS KeyPopulationType,\r\n\t\t\t\t\t\t\t\t\t\t\tcase hiv.orphan when 1 THEN 'Yes' when 2 THEN 'No' ELSE null END as  'Orphan',\r\n\t\t\t\t\t\t\t\t\t\t\tcase hiv.in_school when 1 THEN 'Yes' when 2 THEN 'No' ELSE null END as 'InSchool',\r\n\t\t\t\t\t\t\t\t\t\t\tpatAd.county_district AS  PatientResidentCounty,\r\n\t\t\t\t\t\t\t\t\t\t\tpatAd.state_province AS PatientResidentSubCounty,\r\n\t\t\t\t\t\t\t\t\t\t\tpatAd.address6 AS PatientResidentLocation,\r\n\t\t\t\t\t\t\t\t\t\t\tpatAd.address5 AS PatientResidentSubLocation,\r\n\t\t\t\t\t\t\t\t\t\t\tpatAd.address4 AS PatientResidentWard,\r\n\t\t\t\t\t\t\t\t\t\t\tpatAd.city_village AS PatientResidentVillage,\r\n\t\t\t\t\t\t\t\t\t\t\tcast(min(hiv.transfer_in_date) as Date) as TransferInDate,\r\n\t\t\t\t\t\t\t\t\t\t\thiv.date_created as Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\tGREATEST(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tCOALESCE(d.date_last_modified, hiv.date_last_modified, prg.date_last_modified),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tCOALESCE(hiv.date_last_modified, prg.date_last_modified, d.date_last_modified),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tCOALESCE(prg.date_last_modified, d.date_last_modified, hiv.date_last_modified)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) as Date_Last_Modified,d.occupation as Occupation\r\n\t\t\t\tfrom kenyaemr_etl.etl_hiv_enrollment hiv\r\n\t\t\t\t\t\t\t\t\t\t\tinner join  kenyaemr_etl.etl_patient_demographics d on hiv.patient_id=d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft outer join kenyaemr_etl.etl_mch_enrollment mch on mch.patient_id=d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft outer join kenyaemr_etl.etl_patient_hiv_followup enr on enr.patient_id=d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft outer join kenyaemr_etl.etl_tb_enrollment tb on tb.patient_id=d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft outer join kenyaemr_etl.etl_drug_event de on de.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join concept_name ts on ts.concept_id=hiv.relationship_of_treatment_supporter and ts.concept_name_type = 'FULLY_SPECIFIED' and ts.locale='en'\r\n\t\t\t\t\t\t\t\t\t\t\tleft join person_address patAd ON patAd.person_id=d.patient_id and patAd.voided = 0\r\n\t\t\t\t\t\t\t\t\t\t\tinner join (    select\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx.patient_id as patient_id,x.sxFirstName,x.sxLastname,x.sxMiddleName,x.dmFirstName,x.dmLastName,x.dmMiddleName,x.Gender,x.DOB,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCASE WHEN locate(';',dmLastName )>0 THEN\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCONCAT(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST( LEFT(Gender ,1) AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,CAST( sxFirstName AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t, CAST( SUBSTRING(dmLastName ,locate(';',dmLastName )+1,LENGTH(dmLastName )) AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t,CAST( LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tELSE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCONCAT(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST( LEFT(Gender ,1)AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t, CAST( sxFirstName AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST( dmLastName AS CHAR CHARACTER SET utf8),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCAST( LTRIM(RTRIM(DATE_FORMAT(DOB, '%Y'))) AS CHAR CHARACTER SET utf8)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEND AS PKV\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSELECT patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(given_name ,'0','O'))) AS sxFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(family_name ,'0','O'))) AS sxLastName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSOUNDEX(UPPER(REPLACE(middle_name ,'0','O'))) AS sxMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(given_name ,'0','O'))) AS dmFirstName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(family_name ,'0','O'))) AS dmLastName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn_getPatientNameDoubleMetaphone(UPPER(REPLACE(middle_name ,'0','O'))) AS dmMiddleName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tGender,DOB\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tFROM kenyaemr_etl.etl_patient_demographics\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)x)pkv on pkv.patient_id = d.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tselect Patient_Id,   program ,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(mid(max(concat(date_enrolled,date_completed)), 20) is null, 'Active', 'Inactive') as status,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdate_created,date_last_modified\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_program\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by Patient_Id,program\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t) as prg on prg.patient_id = d.patient_id\r\n\t\t\t\tleft join kenyaemr_etl.etl_contact c on c.client_id = d.patient_id and prg.status='Active' and prg.program='KP' join kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\twhere unique_patient_no is not null\r\n\t\t\t\tgroup by d.patient_id\r\n\t\t\t\torder by d.patient_id",
                    "rank": 1,
                    "isPriority": true,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientExtract",
                    "tempTableName": "TempPatientExtract",
                    "id": "3a742eb0-5856-e811-8e16-9cb6d0da773c",
                    "extractEvent": {
                        "lastStatus": "Loaded",
                        "found": 987,
                        "loaded": 987,
                        "rejected": 0,
                        "queued": 987,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientArtExtract",
                    "display": "ART Patients",
                    "extractSql": "select ''                                                                                  AS SatelliteName,\r\n       0                                                                                   AS FacilityId,\r\n       d.DOB,\r\n       d.Gender,\r\n       'Government'                                                                        AS Provider,\r\n       d.unique_patient_no                                                                 as PatientID,\r\n       d.patient_id                                                                        as PatientPK,\r\n       timestampdiff(year, d.DOB, hiv.visit_date)                                          as AgeEnrollment,\r\n       timestampdiff(year, d.DOB, reg.art_start_date)                                      as AgeARTStart,\r\n       timestampdiff(year, d.DOB, reg.latest_vis_date)                                     as AgeLastVisit,\r\n       i.siteCode                                                                          as SiteCode,\r\n       i.FacilityName                                                                      as FacilityName,\r\n       CAST(coalesce(date_first_enrolled_in_care, min(hiv.visit_date)) as Date)            as RegistrationDate,\r\n       case max(hiv.entry_point)\r\n           when 160542 then 'OPD'\r\n           when 160563 then 'Other'\r\n           when 160539 then 'VCT'\r\n           when 160538 then 'PMTCT'\r\n           when 160541 then 'TB'\r\n           when 160536 then 'IPD - Adult'\r\n           else ''\r\n           end                                                                             as PatientSource,\r\n       mid(min(concat(hiv.visit_date, hiv.date_started_art_at_transferring_facility)), 11) as PreviousARTStartDate,\r\n       reg.date_started_art_this_facility                                                  as StartARTAtThisFAcility,\r\n       least(ifnull(mid(min(concat(hiv.visit_date, hiv.date_started_art_at_transferring_facility)), 11),\r\n                    reg.date_started + interval rand()*1000 year), reg.date_started)       as StartARTDate,\r\n       reg.PreviousARTUse                                                                  as PreviousARTUse,\r\n       reg.PreviousARTPurpose                                                              as PreviousARTPurpose,\r\n       reg.PreviousARTRegimen                                                              as PreviousARTRegimen,\r\n       reg.DateLastUsed                                                                    as DateLastUsed,\r\n       reg.regimen                                                                         as StartRegimen,\r\n       reg.regimen_line                                                                    as StartRegimenLine,\r\n       case\r\n           when reg.latest_vis_date is not null then reg.latest_vis_date\r\n           else reg.last_art_date end                                                        as LastARTDate,\r\n       reg.last_regimen                                                                    as LastRegimen,\r\n       reg.last_regimen_line                                                               as LastRegimenLine,\r\n       reg.latest_tca                                                                      as ExpectedReturn,\r\n       reg.latest_vis_date                                                                 as LastVisit,\r\n       timestampdiff(month, reg.art_start_date, reg.latest_vis_date)                       as Duration,\r\n       disc.ExitDate                                                                       as ExitDate,\r\n       disc.ExitReason                                                                     as ExitReason,\r\n       'KenyaEMR'                                                                          as Emr,\r\n       'Kenya HMIS II'                                                                     as Project,\r\n       hiv.date_created                                                                    as Date_Created,\r\n       GREATEST(\r\n               COALESCE(hiv.date_last_modified, disc.date_last_modified, reg.date_last_modified),\r\n               COALESCE(disc.date_last_modified, reg.date_last_modified, hiv.date_last_modified),\r\n               COALESCE(reg.date_last_modified, hiv.date_last_modified, disc.date_last_modified)\r\n           )                                                                               as Date_Last_Modified\r\nfrom kenyaemr_etl.etl_hiv_enrollment hiv\r\n         join kenyaemr_etl.etl_patient_demographics d on d.patient_id = hiv.patient_id\r\n         left outer join (select d.patient_id,\r\n                                 coalesce(max(date(d.effective_discontinuation_date)),\r\n                                          max(date(d.visit_date)))as ExitDate,\r\n                                 (case d.discontinuation_reason\r\n                                      when 159492 then 'Transfer Out'\r\n                                      when 160034 then 'Died'\r\n                                      when 5240 then 'LTFU'\r\n                                      when 819 then 'Stopped Treatment'\r\n                                      else'' end)                   as ExitReason,\r\n                                 max(d.date_last_modified)        as date_last_modified\r\n                          from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                          where d.program_name = 'HIV'\r\n                          group by d.patient_id) disc on disc.patient_id = hiv.patient_id\r\n         left outer join (select e.patient_id,\r\n                                 min(e.date_started)                                              as art_start_date,\r\n                                 min(e.date_started)                                              as date_started_art_this_facility,\r\n                                 e.date_started,\r\n                                 e.gender,\r\n                                 e.dob,\r\n                                 d.ExitDate                                                       as dis_date,\r\n                                 if(d.ExitDate is not null, 1, 0)                                 as TOut,\r\n                                 e.regimen,\r\n                                 e.regimen_line,\r\n                                 e.alternative_regimen,\r\n                                 max(fup.next_appointment_date)                                   as latest_tca,\r\n                                 last_art_date,\r\n                                 last_regimen,\r\n                                 last_regimen_line,\r\n                                 if(enr.transfer_in_date is not null, 1, 0)                       as TIn,\r\n                                 case enr.previous_art_use when 1 then 'Yes' when 0 then 'No' end as PreviousARTUse,\r\n                                 enr.previous_art_purpose                                         as PreviousARTPurpose,\r\n                                 enr.previous_art_regimen                                         as PreviousARTRegimen,\r\n                                 ''                                                               as DateLastUsed,\r\n                                 max(fup.visit_date)                                              as latest_vis_date,\r\n                                 e.date_created,\r\n                                 e.date_last_modified\r\n                          from (select e.patient_id,\r\n                                       p.dob,\r\n                                       p.Gender,\r\n                                       min(e.date_started)                                             as date_started,\r\n                                       max(e.date_started)                                             as last_art_date,\r\n                                       mid(min(concat(e.date_started, e.regimen_name)), 11)            as regimen,\r\n                                       mid(min(concat(e.date_started, e.regimen_line)), 11)            as regimen_line,\r\n                                       mid(max(concat(e.date_started, e.regimen_name)), 11)            as last_regimen,\r\n                                       mid(max(concat(e.date_started, e.regimen_line)), 11)            as last_regimen_line,\r\n                                       max(if(discontinued, 1, 0))as                                      alternative_regimen,\r\n                                       GREATEST(COALESCE(p.date_created, ph.date_created),\r\n                                                COALESCE(ph.date_created, p.date_created))             as date_created,\r\n                                       GREATEST(COALESCE(p.date_last_modified, ph.date_last_modified),\r\n                                                COALESCE(ph.date_last_modified, p.date_last_modified)) as date_last_modified,\r\n                                       e.provider                                                      as provider\r\n                                from kenyaemr_etl.etl_drug_event e\r\n                                         join kenyaemr_etl.etl_patient_demographics p on p.patient_id = e.patient_id\r\n                                         left join kenyaemr_etl.etl_pharmacy_extract ph\r\n                                                   on ph.patient_id = e.patient_id and is_arv = 1\r\n                                where e.program = 'HIV'\r\n                                group by e.patient_id) e\r\n                                   left outer join (select d.patient_id,\r\n                                                           coalesce(max(date(d.effective_discontinuation_date)),\r\n                                                                    max(date(d.visit_date))) ExitDate\r\n                                                    from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                                                    where d.program_name = 'HIV'\r\n                                                    group by d.patient_id)d on d.patient_id = e.patient_id\r\n                                   inner join (select e.patient_id                                           as patient_id,\r\n                                                      mid(max(concat(e.visit_date, e.transfer_in_date)), 11) as transfer_in_date,\r\n                                                      case mid(max(concat(e.visit_date, e.arv_status)), 11)\r\n                                                          when 1 then 'Yes'\r\n                                                          when 0\r\n                                                              then 'No' end                                as previous_art_use,\r\n                                                      concat_ws('|', NULLIF(\r\n                                                              case mid(max(concat(pre.visit_date, pre.PMTCT)), 11)\r\n                                                                  when 1065 then 'PMTCT' end, ''),\r\n                                                                NULLIF(case mid(max(concat(pre.visit_date, pre.PEP)), 11)\r\n                                                                           when 1 then 'PEP' end, ''),\r\n                                                                NULLIF(case mid(max(concat(pre.visit_date, pre.PrEP)), 11)\r\n                                                                           when 1065 then 'PrEP' end, ''),\r\n                                                                NULLIF(case mid(max(concat(pre.visit_date, pre.HAART)), 11)\r\n                                                                           when 1185 then 'HAART' end, '')\r\n                                                          )                                                  as previous_art_purpose,\r\n                                                      concat_ws('|', NULLIF(\r\n                                                              case mid(max(concat(pre.visit_date, pre.PMTCT_regimen)), 11)\r\n                                                                  when 164968 then 'AZT/3TC/DTG'\r\n                                                                  when 164969 then 'TDF/3TC/DTG'\r\n                                                                  when 164970 then 'ABC/3TC/DTG'\r\n                                                                  when 164505 then 'TDF-3TC-EFV'\r\n                                                                  when 792 then 'D4T/3TC/NVP'\r\n                                                                  when 160124 then 'AZT/3TC/EFV'\r\n                                                                  when 160104 then 'D4T/3TC/EFV'\r\n                                                                  when 161361 then 'EDF/3TC/EFV'\r\n                                                                  when 104565 then 'EFV/FTC/TDF'\r\n                                                                  when 162201 then '3TC/LPV/TDF/r'\r\n                                                                  when 817 then 'ABC/3TC/AZT'\r\n                                                                  when 162199 then 'ABC/NVP/3TC'\r\n                                                                  when 162200 then '3TC/ABC/LPV/r'\r\n                                                                  when 162565 then '3TC/NVP/TDF'\r\n                                                                  when 1652 then '3TC/NVP/AZT'\r\n                                                                  when 162561 then '3TC/AZT/LPV/r'\r\n                                                                  when 164511 then 'AZT-3TC-ATV/r'\r\n                                                                  when 164512 then 'TDF-3TC-ATV/r'\r\n                                                                  when 162560 then '3TC/D4T/LPV/r'\r\n                                                                  when 162563 then '3TC/ABC/EFV'\r\n                                                                  when 162562 then 'ABC/LPV/R/TDF'\r\n                                                                  when 162559 then 'ABC/DDI/LPV/r' end, ''),\r\n                                                                NULLIF(\r\n                                                                        case mid(max(concat(pre.visit_date, pre.PEP_regimen)), 11)\r\n                                                                            when 164968 then 'AZT/3TC/DTG'\r\n                                                                            when 164969 then 'TDF/3TC/DTG'\r\n                                                                            when 164970 then 'ABC/3TC/DTG'\r\n                                                                            when 164505 then 'TDF-3TC-EFV'\r\n                                                                            when 792 then 'D4T/3TC/NVP'\r\n                                                                            when 160124 then 'AZT/3TC/EFV'\r\n                                                                            when 160104 then 'D4T/3TC/EFV'\r\n                                                                            when 1652 then '3TC/NVP/AZT'\r\n                                                                            when 161361 then 'EDF/3TC/EFV'\r\n                                                                            when 104565 then 'EFV/FTC/TDF'\r\n                                                                            when 162201 then '3TC/LPV/TDF/r'\r\n                                                                            when 817 then 'ABC/3TC/AZT'\r\n                                                                            when 162199 then 'ABC/NVP/3TC'\r\n                                                                            when 162200 then '3TC/ABC/LPV/r'\r\n                                                                            when 162565 then '3TC/NVP/TDF'\r\n                                                                            when 162561 then '3TC/AZT/LPV/r'\r\n                                                                            when 164511 then 'AZT-3TC-ATV/r'\r\n                                                                            when 164512 then 'TDF-3TC-ATV/r'\r\n                                                                            when 162560 then '3TC/D4T/LPV/r'\r\n                                                                            when 162563 then '3TC/ABC/EFV'\r\n                                                                            when 162562 then 'ABC/LPV/R/TDF'\r\n                                                                            when 162559 then 'ABC/DDI/LPV/r' end, ''),\r\n                                                                NULLIF(\r\n                                                                        case mid(max(concat(pre.visit_date, pre.PrEP_regimen)), 11)\r\n                                                                            when 164968 then 'AZT/3TC/DTG'\r\n                                                                            when 164969 then 'TDF/3TC/DTG'\r\n                                                                            when 164970 then 'ABC/3TC/DTG'\r\n                                                                            when 164505 then 'TDF-3TC-EFV'\r\n                                                                            when 792 then 'D4T/3TC/NVP'\r\n                                                                            when 160124 then 'AZT/3TC/EFV'\r\n                                                                            when 160104 then 'D4T/3TC/EFV'\r\n                                                                            when 161361 then 'EDF/3TC/EFV'\r\n                                                                            when 104565 then 'EFV/FTC/TDF'\r\n                                                                            when 162201 then '3TC/LPV/TDF/r'\r\n                                                                            when 817 then 'ABC/3TC/AZT'\r\n                                                                            when 162199 then 'ABC/NVP/3TC'\r\n                                                                            when 162200 then '3TC/ABC/LPV/r'\r\n                                                                            when 162565 then '3TC/NVP/TDF'\r\n                                                                            when 1652 then '3TC/NVP/AZT'\r\n                                                                            when 162561 then '3TC/AZT/LPV/r'\r\n                                                                            when 164511 then 'AZT-3TC-ATV/r'\r\n                                                                            when 164512 then 'TDF-3TC-ATV/r'\r\n                                                                            when 162560 then '3TC/D4T/LPV/r'\r\n                                                                            when 162563 then '3TC/ABC/EFV'\r\n                                                                            when 162562 then 'ABC/LPV/R/TDF'\r\n                                                                            when 162559 then 'ABC/DDI/LPV/r' end, ''),\r\n                                                                NULLIF(\r\n                                                                        case mid(max(concat(pre.visit_date, pre.HAART_regimen)), 11)\r\n                                                                            when 164968 then 'AZT/3TC/DTG'\r\n                                                                            when 164969 then 'TDF/3TC/DTG'\r\n                                                                            when 164970 then 'ABC/3TC/DTG'\r\n                                                                            when 164505 then 'TDF-3TC-EFV'\r\n                                                                            when 792 then 'D4T/3TC/NVP'\r\n                                                                            when 160124 then 'AZT/3TC/EFV'\r\n                                                                            when 160104 then 'D4T/3TC/EFV'\r\n                                                                            when 161361 then 'EDF/3TC/EFV'\r\n                                                                            when 104565 then 'EFV/FTC/TDF'\r\n                                                                            when 162201 then '3TC/LPV/TDF/r'\r\n                                                                            when 817 then 'ABC/3TC/AZT'\r\n                                                                            when 162199 then 'ABC/NVP/3TC'\r\n                                                                            when 162200 then '3TC/ABC/LPV/r'\r\n                                                                            when 162565 then '3TC/NVP/TDF'\r\n                                                                            when 1652 then '3TC/NVP/AZT'\r\n                                                                            when 162561 then '3TC/AZT/LPV/r'\r\n                                                                            when 164511 then 'AZT-3TC-ATV/r'\r\n                                                                            when 164512 then 'TDF-3TC-ATV/r'\r\n                                                                            when 162560 then '3TC/D4T/LPV/r'\r\n                                                                            when 162563 then '3TC/ABC/EFV'\r\n                                                                            when 162562 then 'ABC/LPV/R/TDF'\r\n                                                                            when 162559 then 'ABC/DDI/LPV/r' end, '')\r\n                                                          )                                                  as previous_art_regimen\r\n                                               from kenyaemr_etl.etl_hiv_enrollment e\r\n                                                        left join kenyaemr_etl.etl_pre_hiv_enrollment_art pre\r\n                                                                  on e.visit_id = pre.visit_id and e.patient_id = pre.patient_id\r\n                                               group by e.patient_id) enr on enr.patient_id = e.patient_id\r\n                                   left outer join kenyaemr_etl.etl_patient_hiv_followup fup\r\n                                                   on fup.patient_id = e.patient_id\r\n                          group by e.patient_id)reg on reg.patient_id = hiv.patient_id\r\n         join kenyaemr_etl.etl_default_facility_info i\r\nwhere d.unique_patient_no is not null\r\ngroup by d.patient_id\r\nhaving min(hiv.visit_date) is not null\r\n   and StartARTDate is not null",
                    "rank": 2,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientArtExtract",
                    "tempTableName": "TempPatientArtExtract",
                    "id": "39742eb0-5856-e811-8e16-9cb6d0da773c",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 981,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientBaselineExtract",
                    "display": "Patient Baselines",
                    "extractSql": "select '' AS SatelliteName, 0 AS FacilityId, d.unique_patient_no as PatientID,\r\n                                                                                                  d.patient_id as PatientPK,\r\n                                                                                                  (select siteCode from kenyaemr_etl.etl_default_facility_info) as SiteCode,\r\n                                                                                                   mid(max(if(l.visit_date<=p_dates.enrollment_date,concat(l.visit_date,test_result),null)),11) as eCd4,\r\n                                                                                                   DATE(left(max(if(l.visit_date <= p_dates.enrollment_date, concat(l.visit_date, test_result), null)),\t\r\n                                                                                                   10)) as eCd4Date,\r\n                                                                                                   if(fup.visit_date<=p_dates.enrollment_date,\r\n                                                                                                   case who_stage\r\n                                                                                                   when 1220 then 'WHO I'\r\n                                                                                                   when 1221 then 'WHO II'\r\n                                                                                                   when 1222 then 'WHO III'\r\n                                                                                                   when 1223 then 'WHO IV'\r\n                                                                                                   when 1204 then 'WHO I'\r\n                                                                                                   when 1205 then 'WHO II'\r\n                                                                                                   when 1206 then 'WHO III'\r\n                                                                                                   when 1207 then 'WHO IV'\r\n                                                                                                   end,null) as ewho,\r\n                                                                                                   \tDATE(if(fup.visit_date <= p_dates.enrollment_date and who_stage is not null and\t\r\n                                                                                                   fup.visit_date > '1900-01-01',\t\r\n                                                                                                   fup.visit_date,\t\r\n                                                                                                   null))                                                as ewhodate,\r\n                                                                                                  '' as bCD4,\r\n                                                                                                  NULL as bCD4Date,\r\n                                                                                                  '' as bWHO,\r\n                                                                                                  NULL as bWHODate,\r\n                                                                                                   mid(max(concat(fup.visit_date,case who_stage\r\n                                                                                                   when 1220 then 'WHO I'\r\n                                                                                                   when 1221 then 'WHO II'\r\n                                                                                                   when 1222 then 'WHO III'\r\n                                                                                                   when 1223 then 'WHO IV'\r\n                                                                                                   when 1204 then 'WHO I'\r\n                                                                                                   when 1205 then 'WHO II'\r\n                                                                                                   when 1206 then 'WHO III'\r\n                                                                                                   when 1207 then 'WHO IV'\r\n                                                                                                   end)),11) as lastwho,\r\n                                                                                                   \tDATE(left(max(concat(fup.visit_date, case who_stage\r\n                                                                                                   when 1220 then 'WHO I'\r\n                                                                                                   when 1221 then 'WHO II'\r\n                                                                                                   when 1222 then 'WHO III'\r\n                                                                                                   when 1223 then 'WHO IV'\r\n                                                                                                   when 1204 then 'WHO I'\r\n                                                                                                   when 1205 then 'WHO II'\r\n                                                                                                   when 1206 then 'WHO III'\r\n                                                                                                   when 1207 then 'WHO IV'\r\n                                                                                                   end)),10)) as lastwhodate,\r\n                                                                                                         mid(max(concat(l.visit_date, l.test_result)), 11)             as lastcd4,\r\n                                                                                                         DATE(left(max(concat(l.visit_date, l.test_result)), 10))      as lastcd4date,\r\n                                                                                                         mid(max(if(l.visit_date > p_dates.six_month_date and l.visit_date < p_dates.twelve_month_date,\r\n                                                                                                                    concat(l.visit_date, test_result), null)),\r\n                                                                                                             11)                                                       as m6Cd4,\r\n                                                                                                         DATE(left(max(if(l.visit_date >= p_dates.six_month_date and l.visit_date < p_dates.twelve_month_date,\r\n                                                                                                                          concat(l.visit_date, test_result), null)),\r\n                                                                                                                   10))                                                as m6Cd4Date,\r\n                                                                                                         mid(max(if(l.visit_date >= p_dates.twelve_month_date, concat(l.visit_date, test_result), null)),\r\n                                                                                                             11)                                                       as m12Cd4,\r\n                                                                                                         DATE(left(max(if(l.visit_date > p_dates.twelve_month_date, concat(l.visit_date, test_result), null)),\r\n                                                                                                                   10))                                                as m12Cd4Date,\r\n                                                                                                   '' as eWAB, NULL as eWABDate,'' as bWAB, NULL as bWABDAte,\r\n                                                                                                   'KenyaEMR' as Emr,\r\n                                                                                                   'Kenya HMIS II' as Project,\r\n                                                                                                   '' AS LastWaB,NULL AS LastWABDate, \r\n                                                                                                  fup.date_created as date_created,\t\r\n                                                                                                  fup.date_last_modified as date_last_modified\r\n                                                                                                  from kenyaemr_etl.etl_patient_hiv_followup fup\r\n                                                                                                  join kenyaemr_etl.etl_patient_demographics d on d.patient_id=fup.patient_id\r\n                                                                                                  join (select e.patient_id,date_add(date_add(min(e.visit_date),interval 3 month), interval 1 day) as enrollment_date,\r\n                                                                                                  date_add(date_add(min(e.visit_date), interval 6 month),interval 1 day) as six_month_date,\r\n                                                                                                  date_add(date_add(min(e.visit_date), interval 12 month),interval 1 day) as twelve_month_date,\r\n                                                                                                  e.date_created,e.date_last_modified\r\n                                                                                                  from kenyaemr_etl.etl_hiv_enrollment e\r\n                                                                                                  group by e.patient_id) p_dates on p_dates.patient_id=fup.patient_id\r\n                                                                                                  left outer join kenyaemr_etl.etl_laboratory_extract l on l.patient_id=fup.patient_id and l.lab_test in (5497,730) where d.unique_patient_no is not null\r\n                                                                                                  group by fup.patient_id\r\n                                                                                                  order by m6cd4date desc",
                    "rank": 3,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientBaselinesExtract",
                    "tempTableName": "TempPatientBaselinesExtract",
                    "id": "3c742eb0-5856-e811-8e16-9cb6d0da773c",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 983,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientStatusExtract",
                    "display": "Patient Status",
                    "extractSql": "select '' AS SatelliteName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t0                                                                           AS FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td.unique_patient_no                                                         as PatientID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td.patient_id                                                                as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.siteCode                                                                  as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti.FacilityName                                                              as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t''                                                                          as ExitDescription,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                  as Emr,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                             as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(date(disc.visit_date))                                                  AS ExitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(date(disc.effective_discontinuation_date))                              AS EffectiveDiscontinuationDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(visit_date, (case discontinuation_reason\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159492 then 'Transfer Out'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160034 then 'Died'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5240 then 'LTFU'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 819 then 'Stopped Treatment'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse '' end), '')), 20)                       as ExitReason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(e.latest_enrolment_date > greatest(coalesce(max(date(disc.effective_discontinuation_date)), '0000-00-00'),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcoalesce(max(date(disc.visit_date)), '0000-00-00')), e.latest_enrolment_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnull)                                                                    as ReEnrollmentDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case mid(max(concat(date(disc.visit_date), disc.death_reason)), 11)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163324 then 'HIV disease resulting in TB'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 116030 then 'HIV disease resulting in cancer'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160159 then 'HIV disease resulting in other infectious and parasitic diseases'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160158 then 'Other HIV disease resulting in other diseases or conditions leading to death'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 133478 then 'Other natural causes not directly related to HIV'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 145439 then 'Non-communicable diseases such as Diabetes and hypertension'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 123812 then 'Non-natural causes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 42917 then 'Unknown cause'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse '' end)                                                             as ReasonForDeath,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case mid(max(concat(date(disc.visit_date), disc.specific_death_cause)), 11)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156673 then 'HIV disease resulting in mycobacterial infection'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 155010 then 'HIV disease resulting in Kaposis sarcoma'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156667 then 'HIV disease resulting in Burkitts lymphoma'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 115195 then 'HIV disease resulting in other types of non-Hodgkin lymphoma'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 157593\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'HIV disease resulting in other malignant neoplasms of lymphoid and haematopoietic and related tissue'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156672 then 'HIV disease resulting in multiple malignant neoplasms'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 159988 then 'HIV disease resulting in other malignant neoplasms'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5333 then 'HIV disease resulting in other bacterial infections'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 116031 then 'HIV disease resulting in unspecified malignant neoplasms'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 123122 then 'HIV disease resulting in other viral infections'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156669 then 'HIV disease resulting in cytomegaloviral disease'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156668 then 'HIV disease resulting in candidiasis'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5350 then 'HIV disease resulting in other mycoses'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 882\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'HIV disease resulting in Pneumocystis jirovecii pneumonia - HIV disease resulting in Pneumocystis carinii pneumonia'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156671 then 'HIV disease resulting in multiple infections'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160159 then 'HIV disease resulting in other infectious and parasitic diseases'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 171\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'HIV disease resulting in unspecified infectious or parasitic disease - HIV disease resulting in infection NOS'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 156670\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'HIV disease resulting in other specified diseases including encephalopathy or lymphoid interstitial pneumonitis or wasting syndrome and others'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160160\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthen 'HIV disease resulting in other conditions including acute HIV infection syndrome or persistent generalized lymphadenopathy or hematological and immunological abnormalities and others'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161548 then 'HIV disease resulting in Unspecified HIV disease'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend)                                                                    as SpecificDeathReason,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case mid(max(concat(date(disc.visit_date), disc.trf_out_verified)), 11)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1065 then 'Yes'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1066 then 'No' end)                                                 as TOVerified,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(date(disc.visit_date), disc.trf_out_verification_date)), 11) as TOVerifiedDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(disc.visit_date, disc.date_died)), 11)                       as DeathDate,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisc.date_created                                                           as Date_Created,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisc.date_last_modified                                                     as Date_Last_Modified\r\n\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_program_discontinuation disc\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select e.patient_id                                       as patient_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmax(e.visit_date)                                  as latest_enrolment_date,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmid(max(concat(e.visit_date, e.patient_type)), 11) as patient_type\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_hiv_enrollment e\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgroup by e.patient_id) e on e.patient_id = disc.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_patient_demographics d on d.patient_id = disc.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\t\t\twhere d.unique_patient_no is not null\r\n\t\t\t\t\t\t\t\t\tand disc.program_name = 'HIV'\r\n\t\t\t\t\t\t\tgroup by PatientID\r\n\t\t\t\t\t\t\torder by disc.visit_date ASC",
                    "rank": 4,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientStatusExtract",
                    "tempTableName": "TempPatientStatusExtract",
                    "id": "38742eb0-5856-e811-8e16-9cb6d0da773c",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 144,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientLabExtract",
                    "display": "Patient Labs",
                    "extractSql": "select '' AS SatelliteName, 0 AS FacilityId,\r\n                             d.unique_patient_no as PatientID, d.patient_id as PatientPK, l.encounter_id as VisitId,\r\n                             coalesce(DATE(l.date_test_requested), DATE(l.visit_date)) as OrderedByDate,\r\n                             DATE(l.date_test_result_received) as ReportedByDate,\r\n                             i.siteCode as SiteCode,\r\n                             i.facilityName as FacilityName,\r\n                             (case lab_test\r\n                             when 5497 then 'CD4 Count'\r\n                             when 730 then 'CD4 Percent'\r\n                             when 654 then 'ALT'\r\n                             when 790 then 'Serum creatinine (umol/L)'\r\n                             when 856 then 'HIV Viral Load'\r\n                             when 1305 then 'HIV Viral Load'\r\n                             when 21 then 'Hemoglobin (HGB)'\r\n                             when 1029 then 'VDRL Titre'\r\n                             when 1031 then 'Treponema Pallidum Hemagglutination Assay'\r\n                             when 1619 then 'Rapid Plasma Reagin'\r\n                             when 1032 then 'Treponema Pallidum Hemagglutination Assay, Qualitative'\r\n                             else '' end)                                                                as TestName,\r\n                             date(l.visit_date)                                                               as DateSampleTaken,\r\n                             (case l.order_reason\r\n                             when 843 then 'Confirmation of treatment failure (repeat VL)'\r\n                             when 1434 then 'Pregnancy'\r\n                             when 162080 then 'Baseline VL (for infants diagnosed through EID)'\r\n                             when 1259 then 'Single Drug Substitution'\r\n                             when 159882 then 'Breastfeeding'\r\n                             when 163523 then 'Clinical failure'\r\n                             when 161236 then 'Routine'\r\n                             when 160032 then 'Confirmation of persistent low level Viremia (PLLV)' end) as Reason,\r\n                             if(lab_test = 299, (case test_result\r\n                             when 1228 then 'REACTIVE'\r\n                             when 1229 then 'NON-REACTIVE'\r\n                             when 1304 then 'POOR SAMPLE QUALITY' end),\r\n                             if(lab_test = 1030, (case test_result\r\n                             when 1138 then 'INDETERMINATE'\r\n                             when 664 then 'NEGATIVE'\r\n                             when 703 then 'POSITIVE'\r\n                             when 1304 then 'POOR SAMPLE QUALITY' end),\r\n                             if(lab_test = 302, (case test_result\r\n                             when 1115 then 'Normal'\r\n                             when 1116 then 'Abnormal'\r\n                             when 1067 then 'Unknown' end),\r\n                             if(lab_test = 32, (case test_result\r\n                             when 664 then 'NEGATIVE'\r\n                             when 703 then 'POSITIVE'\r\n                             when 1138 then 'INDETERMINATE' end),\r\n                             if(lab_test = 1305, (case test_result\r\n                             when 1306 then 'BEYOND DETECTABLE LIMIT'\r\n                             when 1301 then 'DETECTED'\r\n                             when 1302 then 'LDL'\r\n                             when 1304 then 'POOR SAMPLE QUALITY' end),\r\n                             if(lab_test = 1029,\r\n                             (case test_result when 664 then 'Negative' when 703 then 'Positive' end),\r\n                             if(lab_test = 1031, (case test_result\r\n                             when 1311 then '<1:2'\r\n                             when 1312 then '01:02'\r\n                             when 1313 then '1:4'\r\n                             when 1314 then '01:08'\r\n                             when 1315 then '01:16'\r\n                             when 1316 then '01:32'\r\n                             when 1317 then '>1:32'\r\n                             when 1304 then 'Poor Sample Quality'\r\n                             when 163621 then '1:64'\r\n                             when 163622 then '1:128'\r\n                             when 163623 then '1:256'\r\n                             when 163624 then '>1:572' end),\r\n                             if(lab_test = 1032, (case test_result\r\n                             when 703 then 'Positive'\r\n                             when 664 then 'Negative'\r\n                             when 1300 then 'Equivocal'\r\n                             when 1304 then 'Poor Sample Quality' end),\r\n                             if(lab_test = 1619, (case test_result\r\n                             when 703 then 'Positive'\r\n                             when 664 then 'Negative'\r\n                             when 1067 then 'Unknown' end),\r\n                             test_result)))))))))                                  as TestResult,\r\n                             NULL                                                                             as EnrollmentTest,\r\n                             o.sample_type                                                                    as SampleType,\r\n                             'KenyaEMR'                                                                       as Emr,\r\n                             'Kenya HMIS II'                                                                  as Project,\r\n                             l.date_created                                                                   as Date_Created,\r\n                             l.date_last_modified                                                             as Date_Last_Modified\r\n                             from kenyaemr_etl.etl_laboratory_extract l\r\n                             left join openmrs.kenyaemr_order_entry_lab_manifest_order o on l.order_id = o.order_id\r\n                             join kenyaemr_etl.etl_patient_demographics d on d.patient_id = l.patient_id\r\n                             join kenyaemr_etl.etl_default_facility_info i\r\n                             where d.unique_patient_no is not null",
                    "rank": 5,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientLaboratoryExtract",
                    "tempTableName": "TempPatientLaboratoryExtract",
                    "id": "3d742eb0-5856-e811-8e16-9cb6d0da773c",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 5949,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientPharmacyExtract",
                    "display": "Patient Pharmacy",
                    "extractSql": "select 'Government'                                                 AS Provider,\r\n                        ''                                                           AS SatelliteName,\r\n                        0                                                            as FacilityId,\r\n                        d.unique_patient_no                                          as PatientID,\r\n                        d.patient_id                                                 as PatientPK,\r\n                        i.Facilityname                                               as FacilityName,\r\n                        i.sitecode                                                   as siteCode,\r\n                        ph.visit_id                                                  as VisitID,\r\n                        Drug,\r\n                        ph.visit_date                                                as DispenseDate,\r\n                        ph.duration                                                  AS duration,\r\n                        ph.duration                                                  AS PeriodTaken,\r\n                        DATE_ADD(ph.visit_date, INTERVAL ph.duration DAY)            as ExpectedReturn,\r\n                        'KenyaEMR'                                                   as Emr,\r\n                        'Kenya HMIS II'                                              as Project,\r\n                        CASE\r\n                            WHEN is_arv = 1 THEN 'ARV'\r\n                            WHEN is_ctx = 1 OR is_dapsone = 1 THEN 'Prophylaxis' END AS TreatmentType,\r\n                        ph.RegimenLine,\r\n                        CASE\r\n                            WHEN is_ctx = 1 THEN 'CTX'\r\n                            WHEN is_dapsone = 1 THEN 'DAPSONE' END                   AS ProphylaxisType,\r\n                        CAST(now() as Date)                                          AS DateExtracted,\r\n                        ph.RegimenChangedSwitched                                    as RegimenChangedSwitched,\r\n                        ph.RegimenChangeSwitchReason                                 as RegimenChangeSwitchReason,\r\n                        ph.StopRegimenReason                                         as StopRegimenReason,\r\n                        ph.StopRegimenDate                                           as StopRegimenDate,\r\n                        ph.date_created,\r\n                        ph.date_last_modified\r\n                 from (SELECT *\r\n                       FROM (\r\n                                (select patient_id,\r\n                                        visit_id,\r\n                                        visit_date,\r\n                                        encounter_id,\r\n                                        (case drug when 105281 then 'CTX' when 74250 then 'DAPSONE' end) as drug,\r\n                                        is_arv,\r\n                                        is_ctx,\r\n                                        is_dapsone,\r\n                                        drug_name                                                        as drugreg,\r\n                                        frequency,\r\n                                        visit_date                                                       as DispenseDate,\r\n                                        duration_in_days                                                 as duration,\r\n                                        duration_in_days                                                 as PeriodTaken,\r\n                                        DATE_ADD(visit_date, INTERVAL duration_in_days DAY)              as ExpectedReturn,\r\n                                        CASE WHEN is_ctx = 1 OR is_dapsone = 1 THEN 'Prophylaxis' END    AS TreatmentType,\r\n                                        ''                                                               as RegimenLine,\r\n                                        ''                                                               as regimen,\r\n                                        CASE\r\n                                            WHEN is_ctx = 1 THEN 'CTX'\r\n                                            WHEN is_dapsone = 1 THEN 'DAPSONE' END                       AS ProphylaxisType,\r\n                                        ''                                                               as previousRegimen,\r\n                                        ''                                                               as RegimenChangedSwitched,\r\n                                        ''                                                               as RegimenChangeSwitchReason,\r\n                                        ''                                                               as StopRegimenReason,\r\n                                        ''                                                               as StopRegimenDate,\r\n                                        ''                                                               as prev_Regimen,\r\n                                        ph.date_created,\r\n                                        ph.date_last_modified\r\n                                 from kenyaemr_etl.etl_pharmacy_extract ph\r\n                                 where is_arv = 1\r\n                                 order by patient_id, DispenseDate)\r\n                                UNION ALL\r\n                                (SELECT e.patient_id                                                                        as patient_id,\r\n                                        ''                                                                                  as visit_id,\r\n                                        e.visit_date,\r\n                                        e.encounter_id,\r\n                                        regimen                                                                                drug,\r\n                                        1                                                                                   as is_arv,\r\n                                        0                                                                                   as is_ctx,\r\n                                        0                                                                                   as is_dapsone,\r\n                                        regimen_name                                                                        as drugreg,\r\n                                        ''                                                                                     frequency,\r\n                                        date_started                                                                        as DispenseDate,\r\n                                        null                                                                                as duration,\r\n                                        null                                                                                as PeriodTaken,\r\n                                        null                                                                                as ExpectedReturn,\r\n                                        'ARV'                                                                               AS TreatmentType,\r\n                                        e.regimen_line                                                                      as regimen_line,\r\n                                        e.regimen                                                                           as regimen,\r\n                                        ''                                                                                  as ProphylaxisType,\r\n                                        @prev_regimen                                                                          previousRegimen,\r\n                                        coalesce(@s := (if(ifnull(@prev_regimen_line, '') <> regimen_line and discontinued = 1, 'Switch',\r\n                                                           NULL)),\r\n                                                 (if(@prev_regimen <> regimen and discontinued = 1, 'Substitution', NULL))) as RegimenChangedSwitched,\r\n                                        (case reason_discontinued\r\n                                             when 160559 then 'Risk of pregnancy'\r\n                                             when 160561 then 'New drug available'\r\n                                             when 160567 then 'New diagnosis of Tuberculosis'\r\n                                             when 160569 then 'Virological failure'\r\n                                             when 159598 then 'Non-compliance with treatment or therapy'\r\n                                             when 1754 then 'Drugs out of stock'\r\n                                             when 1434 then 'Pregnancy'\r\n                                             when 1253 then 'Completed PMTCT'\r\n                                             when 843 then 'Clinical treatment failure'\r\n                                             when 160566 then 'Immunological failure'\r\n                                             when 102 then 'Drug toxicity'\r\n                                             when 5622 then 'Other'\r\n                                             else '' end)                                                                   as RegimenChangeSwitchReason,\r\n                                        if(regimen_stopped = 1260, (case reason_discontinued\r\n                                                                        when 102 then 'Drug toxicity'\r\n                                                                        when 160567 then 'New diagnosis of Tuberculosis'\r\n                                                                        when 160569 then 'Virologic failure'\r\n                                                                        when 159598 then 'Non-compliance with treatment or therapy'\r\n                                                                        when 1754 then 'Medications unavailable'\r\n                                                                        when 160016 then 'Planned Treatment interruption'\r\n                                                                        when 1434 then 'Currently pregnant'\r\n                                                                        when 1253 then 'Completed PMTCT'\r\n                                                                        when 843 then 'Regimen failure'\r\n                                                                        when 5622 then 'Other'\r\n                                                                        when 160559 then 'Risk of pregnancy'\r\n                                                                        when 160561 then 'New drug available'\r\n                                                                        else '' end),\r\n                                           '')                                                                              as StopRegimenReason,\r\n                                        if(discontinued = 1, date_discontinued, NULL)                                       as StopRegimenDate,\r\n                                        @prev_regimen := e.regimen                                                             prev_regimen,\r\n                                        e.date_created                                                                      as date_created,\r\n                                        e.date_last_modified                                                                as date_last_modified\r\n                                 FROM kenyaemr_etl.etl_drug_event e,\r\n                                      (SELECT @s := 0, @prev_regimen := -1, @x := 0, @prev_regimen_line := -1) s\r\n                                 where e.program = 'HIV'\r\n                                 ORDER BY e.patient_id, e.date_started)\r\n                                UNION ALL\r\n                                (select patient_id,\r\n                                        visit_id,\r\n                                        visit_date,\r\n                                        encounter_id,\r\n                                        drug_short_name                                                             as drug,\r\n                                        1                                                                           as is_arv,\r\n                                        ''                                                                          as is_ctx,\r\n                                        ''                                                                          as is_dapsone,\r\n                                        drug_name                                                                   as drugreg,\r\n                                        frequency,\r\n                                        visit_date                                                                  as DispenseDate,\r\n                                        (case duration_units\r\n                                             when 'DAYS' then duration\r\n                                             when 'MONTHS' then duration * 30\r\n                                             when 'WEEKS' then duration * 7 end)                                    as duration,\r\n                                        (case duration_units\r\n                                             when 'DAYS' then duration\r\n                                             when 'MONTHS' then duration * 30\r\n                                             when 'WEEKS' then duration * 7 end)                                    as PeriodTaken,\r\n                                        DATE_ADD(visit_date, INTERVAL (case duration_units\r\n                                                                           when 'DAYS' then duration\r\n                                                                           when 'MONTHS' then duration * 30\r\n                                                                           when 'WEEKS' then duration * 7 end) DAY) as ExpectedReturn,\r\n                                        ''                                                                          AS TreatmentType,\r\n                                        ''                                                                          as RegimenLine,\r\n                                        drug_name                                                                   as regimen,\r\n                                        ''                                                                          AS ProphylaxisType,\r\n                                        ''                                                                          as previousRegimen,\r\n                                        ''                                                                          as RegimenChangedSwitched,\r\n                                        ''                                                                          as RegimenChangeSwitchReason,\r\n                                        ''                                                                          as StopRegimenReason,\r\n                                        ''                                                                          as StopRegimenDate,\r\n                                        ''                                                                          as prev_Regimen,\r\n                                        do.date_created,\r\n                                        do.date_last_modified\r\n                                 from kenyaemr_etl.etl_drug_order do\r\n                                 group by do.order_group_id, do.patient_id, do.encounter_id\r\n                                 order by do.patient_id, DispenseDate)\r\n                            ) A\r\n                       order by A.DispenseDate, A.patient_id) ph\r\n                          join kenyaemr_etl.etl_patient_demographics d on d.patient_id = ph.patient_id\r\n                          left outer join concept_name cn on cn.concept_id = ph.drug and cn.concept_name_type = 'FULLY_SPECIFIED'\r\n                     and cn.locale = 'en'\r\n                          left outer join concept_name cn2 on cn2.concept_id = ph.drug and cn2.concept_name_type = 'SHORT'\r\n                     and cn.locale = 'en'\r\n                          left outer join kenyaemr_etl.etl_patient_hiv_followup fup on fup.encounter_id = ph.encounter_id\r\n                     and fup.patient_id = ph.patient_id\r\n                          join kenyaemr_etl.etl_default_facility_info i\r\n                 where unique_patient_no is not null\r\n                   and drugreg is not null",
                    "rank": 6,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientPharmacyExtract",
                    "tempTableName": "TempPatientPharmacyExtract",
                    "id": "3f742eb0-5856-e811-8e16-9cb6d0da773c",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 4154,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientVisitExtract",
                    "display": "Patient Visit",
                    "extractSql": "select ''                                                                     AS SatelliteName,\r\n                 0                                                                      AS FacilityId,\r\n                 d.unique_patient_no                                                    as PatientID,\r\n                 d.patient_id                                                           as PatientPK,\r\n                 i.facilityName                                                         as FacilityName,\r\n                 i.siteCode                                                             as SiteCode,\r\n                 fup.visit_id                                                           as VisitId,\r\n                 case\r\n                     when fup.visit_date < '1990-01-01' then null\r\n                     else CAST(fup.visit_date AS DATE) end                                AS VisitDate,\r\n                 'Out Patient'                                                          as Service,\r\n                 (case fup.visit_scheduled\r\n                      when 1 then 'Scheduled'\r\n                      when 2 then 'Unscheduled'\r\n                      else '' end)                                                        as VisitType,\r\n                 (case fup.person_present\r\n                      when 978 then 'Self'\r\n                      when 161642 then 'Treatment supporter'\r\n                      when 159802 then 'Refill visit documentation'\r\n                      when 5622 then 'Other' end)                                         as VisitBy,\r\n                 case fup.who_stage\r\n                     when 1220 then 'WHO I'\r\n                     when 1221 then 'WHO II'\r\n                     when 1222 then 'WHO III'\r\n                     when 1223 then 'WHO IV'\r\n                     when 1204 then 'WHO I'\r\n                     when 1205 then 'WHO II'\r\n                     when 1206 then 'WHO III'\r\n                     when 1207 then 'WHO IV'\r\n                     else ''\r\n                     end                                                                as WHOStage,\r\n                 null                                                                   as WABStage,\r\n                 case fup.pregnancy_status\r\n                     when 1065 then 'Yes'\r\n                     when 1066 then 'No'\r\n                     end                                                                as Pregnant,\r\n                 CAST(fup.last_menstrual_period AS DATE)                                as LMP,\r\n                 CAST(fup.expected_delivery_date AS DATE)                               as EDD,\r\n                 t.height                                                             as Height,\r\n                 t.weight                                                             as Weight,\r\n                 concat(t.systolic_pressure, '/', t.diastolic_pressure)             as BP,\r\n                 t.temperature                                                        as Temp,\r\n                 t.pulse_rate                                                         as PulseRate,\r\n                 t.respiratory_rate                                                   as RespiratoryRate,\r\n                 t.oxygen_saturation                                                  as OxygenSaturation,\r\n                 t.muac                                                               as Muac,\r\n                 (case t.nutritional_status\r\n                      when 1115 then 'Normal'\r\n                      when 163302 then 'Severe acute malnutrition'\r\n                      when 163303 then 'Moderate acute malnutrition'\r\n                      when 114413 then 'Overweight/Obese'\r\n                      else '' end)                                                        as NutritionalStatus,\r\n                 (case fup.ever_had_menses\r\n                      when 1065 then 'Yes'\r\n                      when 1066 then 'No'\r\n                      when 1175 then 'N/A' end)                                           as EverHadMenses,\r\n                 if(d.gender = 'F',(case fup.breastfeeding when 1065 then 'Yes' when 1066 then 'No' end),'N/A')  as Breastfeeding,\r\n                 (case menopausal when 113928 then 'Yes' end)                           as Menopausal,\r\n                 (case prophylaxis_given\r\n                      when 105281 then 'Cotrimoxazole'\r\n                      when 74250 then 'Dapsone'\r\n                      when 1107 then 'None' end)                                          as ProphylaxisUsed,\r\n                 (case fup.ctx_adherence\r\n                      when 159405 then 'Good'\r\n                      when 163794 then 'Fair'\r\n                      when 159407 then 'Bad'\r\n                      else '' end)                                                        as CTXAdherence,\r\n                 de.regimen                                                             as CurrentRegimen,\r\n                 (case fup.reason_not_using_family_planning\r\n                      when 160572 then 'Thinks cant get pregnant'\r\n                      when 160573 then 'Not sexually active now'\r\n                      when 5622 then 'Other'\r\n                      else '' end)                                                        as NoFPReason,\r\n                 'ART|CTX'                                                              as AdherenceCategory,\r\n                 concat(\r\n                         IF(fup.arv_adherence = 159405, 'Good',\r\n                            IF(fup.arv_adherence = 159406, 'Fair', IF(fup.arv_adherence = 159407, 'Poor', ''))),\r\n                         IF(fup.arv_adherence in (159405, 159406, 159407), '|', ''),\r\n                         IF(fup.ctx_adherence = 159405, 'Good',\r\n                            IF(fup.ctx_adherence = 159406, 'Fair', IF(fup.ctx_adherence = 159407, 'Poor', '')))\r\n                     )                                                                  AS Adherence,\r\n                 (case next_appointment_reason\r\n                      when 160523 then 'Follow up'\r\n                      when 1283 then 'Lab tests'\r\n                      when 159382 then 'Counseling'\r\n                      when 160521 then 'Pharmacy Refill'\r\n                      when 5622 then 'Other'\r\n                      else '' end)                                                        as TCAReason,\r\n                 fup.clinical_notes                                                     as ClinicalNotes,\r\n                 ''                                                                     as OI,\r\n                 NULL                                                                   as OIDate,\r\n                 fup.general_examination                                                as GeneralExamination,\r\n                 (case fup.system_examination\r\n                      when 1115 then 'Normal'\r\n                      when 1116 then 'Abnormal' end)                                      as SystemExamination,\r\n                 (case fup.skin_findings\r\n                      when 150555 then 'Abscess'\r\n                      when 125201 then 'Swelling/Growth'\r\n                      when 135591 then 'Hair Loss'\r\n                      when 136455 then 'Itching'\r\n                      when 507 then 'Kaposi Sarcoma'\r\n                      when 1249 then 'Skin eruptions/Rashes'\r\n                      when 5244 then 'Oral sores' end)                                    as Skin,\r\n                 (case fup.eyes_findings\r\n                      when 123074 then 'Visual Disturbance'\r\n                      when 140940 then 'Excessive tearing'\r\n                      when 131040 then 'Eye pain'\r\n                      when 127777 then 'Eye redness'\r\n                      when 140827 then 'Light sensitive'\r\n                      when 139100 then 'Itchy eyes' end)                                  as Eyes,\r\n                 (case fup.ent_findings\r\n                      when 148517 then 'Apnea'\r\n                      when 139075 then 'Hearing disorder'\r\n                      when 119558 then 'Dental caries'\r\n                      when 118536 then 'Erythema'\r\n                      when 106 then 'Frequent colds'\r\n                      when 147230 then 'Gingival bleeding'\r\n                      when 135841 then 'Hairy cell leukoplakia'\r\n                      when 117698\r\n                          then 'Hearing loss'\r\n                      when 138554 then 'Hoarseness'\r\n                      when 507 then 'Kaposi Sarcoma'\r\n                      when 152228 then 'Masses'\r\n                      when 128055 then 'Nasal discharge'\r\n                      when 133499 then 'Nosebleed'\r\n                      when 160285 then 'Pain'\r\n                      when 110099 then 'Post nasal discharge'\r\n                      when 126423 then 'Sinus problems'\r\n                      when 126318 then 'Snoring'\r\n                      when 158843 then 'Sore throat'\r\n                      when 5244 then 'Oral sores'\r\n                      when 5334 then 'Thrush'\r\n                      when 123588 then 'Tinnitus'\r\n                      when 124601 then 'Toothache'\r\n                      when 123919 then 'Ulcers'\r\n                      when 111525 then 'Vertigo' end)                                     as ENT,\r\n                 (case fup.chest_findings\r\n                      when 146893 then 'Bronchial breathing'\r\n                      when 127640 then 'Crackles'\r\n                      when 145712 then 'Dullness'\r\n                      when 164440 then 'Reduced breathing'\r\n                      when 127639 then 'Respiratory distress'\r\n                      when 5209 then 'Wheezing' end)                                      as Chest,\r\n                 (case fup.cvs_findings\r\n                      when 140147 then 'Elevated blood pressure'\r\n                      when 136522 then 'Irregular heartbeat'\r\n                      when 562 then 'Cardiac murmur'\r\n                      when 130560 then 'Cardiac rub' end)                                 as CVS,\r\n                 (case fup.abdomen_findings\r\n                      when 150915 then 'Abdominal distension'\r\n                      when 5008 then 'Hepatomegaly'\r\n                      when 5103 then 'Abdominal mass'\r\n                      when 5009 then 'Splenomegaly'\r\n                      when 5105 then 'Abdominal tenderness' end)                          as Abdomen,\r\n                 (case fup.cns_findings\r\n                      when 118872 then 'Altered sensations'\r\n                      when 1836 then 'Bulging fontenelle'\r\n                      when 150817 then 'Abnormal reflexes'\r\n                      when 120345 then 'Confusion'\r\n                      when 157498 then 'Limb weakness'\r\n                      when 112721 then 'Stiff neck'\r\n                      when 136282 then 'Kernicterus' end)                                 as CNS,\r\n                 (case fup.genitourinary_findings\r\n                      when 147241 then 'Bleeding'\r\n                      when 154311 then 'Rectal discharge'\r\n                      when 123529 then 'Urethral discharge'\r\n                      when 123396 then 'Vaginal discharge'\r\n                      when 124087 then 'Ulceration' end)                                  as Genitourinary,\r\n                 case ifnull(fup.family_planning_status, '')\r\n                     when 695 then 'Currently using FP'\r\n                     when 160652 then 'Not using FP'\r\n                     when 1360 then 'Wants FP'\r\n                     else ''\r\n                     end                                                                as FamilyPlanningMethod,\r\n                 concat_ws('|',\r\n                           nullif(case fup.substance_abuse_screening\r\n                                      when 1065 then 'Screened for substance abuse'\r\n                                      else ''\r\n                                      end, ''),\r\n                           nullif(case fup.condom_provided\r\n                                      when 1065 then 'Condoms'\r\n                                      else ''\r\n                                      end, ''),\r\n                           nullif(case fup.pwp_disclosure\r\n                                      when 1065 then 'Disclosure'\r\n                                      else ''\r\n                                      end, ''),\r\n                           nullif(case fup.pwp_partner_tested\r\n                                      when 1065 then 'Partner Testing'\r\n                                      else ''\r\n                                      end, ''),\r\n                           nullif(case fup.screened_for_sti\r\n                                      when 1065 then 'Screened for STI'\r\n                                      else ''\r\n                                      end, ''),\r\nnullif(case fup.cacx_screening\r\nwhen 703 then 'Screened for CaCx'\r\nwhen 664 then 'Screened for CaCx'\r\nend, '')) as                                          PwP,\r\n                 if(fup.last_menstrual_period is not null,\r\n                    timestampdiff(week, fup.last_menstrual_period, fup.visit_date), '') as GestationAge,\r\n                 case\r\n                     when fup.next_appointment_date < '1990-01-01' then null\r\n                     else CAST(fup.next_appointment_date AS DATE) end                     AS NextAppointmentDate,\r\n                 case when fup.refill_date < '1990-01-01' then null\r\n                                       else CAST(fup.refill_date AS DATE) end                   AS RefillDate,\r\n                 'KenyaEMR'                                                             as Emr,\r\n                 'Kenya HMIS II'                                                        as Project,\r\n                 CAST(fup.substitution_first_line_regimen_date AS DATE)                 AS SubstitutionFirstlineRegimenDate,\r\n                 fup.substitution_first_line_regimen_reason                             AS SubstitutionFirstlineRegimenReason,\r\n                 CAST(fup.substitution_second_line_regimen_date AS DATE)                AS SubstitutionSecondlineRegimenDate,\r\n                 fup.substitution_second_line_regimen_reason                            AS SubstitutionSecondlineRegimenReason,\r\n                 CAST(fup.second_line_regimen_change_date AS DATE)                      AS SecondlineRegimenChangeDate,\r\n                 fup.second_line_regimen_change_reason                                  AS SecondlineRegimenChangeReason,\r\n                 CASE fup.stability\r\n                     WHEN 1 THEN 'Stable'\r\n                     WHEN 2 THEN 'Not Stable' END                                         as StabilityAssessment,\r\n                 (case fup.differentiated_care\r\n                      when 164942 then 'Standard Care'\r\n                      when 164943 then 'Fast Track'\r\n                      when 164944 then 'Community ART Distribution - HCW Led'\r\n                      when 164945 then 'Community ART Distribution - Peer Led'\r\n                      when 164946 then 'Facility ART Distribution Group'\r\n                      else '' end)                                                        as DifferentiatedCare,\r\n                 (case population_type\r\n                      when 164928 then 'General Population'\r\n                      when 164929 then 'Key Population'\r\n                      else '' end)                                                        as PopulationType,\r\n                 case fup.key_population_type\r\n                     WHEN 105 THEN 'PWID'\r\n                     WHEN 160578 THEN 'MSM'\r\n                     WHEN 160579 THEN 'FSW'\r\n                     when 165084 then 'MSW'\r\n                     when 165085 then 'PWUD'\r\n                     when 165100 then 'Transgender'\r\n                     WHEN 1175 THEN 'N/A' END                                                        as KeyPopulationType,\r\n                 ''                                                                     as HCWConcern,\r\n                 fup.date_created                                                       as Date_Created,\r\n                 fup.date_last_modified                                                 as Date_Last_Modified\r\n from kenyaemr_etl.etl_patient_demographics d\r\n          join kenyaemr_etl.etl_patient_hiv_followup fup on fup.patient_id = d.patient_id\r\n          join kenyaemr_etl.etl_default_facility_info i\r\n              left join (select t.patient_id,\t\r\nt.visit_date,\t\r\nt.weight,\t\r\nt.height,\t\r\nt.systolic_pressure,\t\r\nt.diastolic_pressure,\t\r\nt.temperature,\t\r\nt.pulse_rate,\t\r\nt.respiratory_rate,\t\r\nt.oxygen_saturation,\t\r\nt.muac,\t\r\nt.nutritional_status\t\r\nfrom kenyaemr_etl.etl_patient_triage t) t\t\r\non fup.patient_id = t.patient_id and date(fup.visit_date) = date(t.visit_date)\r\n          left join (select de.patient_id, mid(max(concat(de.visit_date, de.regimen)), 11) as regimen\r\n                     from kenyaemr_etl.etl_drug_event de\r\n                     where de.discontinued is null\r\n                     group by de.patient_id)de on fup.patient_id = de.patient_id\r\n where d.unique_patient_no is not null\r\n   and fup.visit_date > '1990-01-01' and fup.next_appointment_date is not null\r\n   and fup.visit_id is not null",
                    "rank": 7,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientVisitExtract",
                    "tempTableName": "TempPatientVisitExtract",
                    "id": "40742eb0-5856-e811-8e16-9cb6d0da773c",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 19106,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "PatientAdverseEventExtract",
                    "display": "Patient Adverse Events",
                    "extractSql": "select v.patient_id as PatientPK,\r\n       s.siteCode as SiteCode,\r\n       de.unique_patient_no as PatientID,\r\n       0 AS FacilityId,'KenyaEMR' as Emr,'Kenya HMIS II' as Project,\r\n       s.FacilityName as FacilityName,\r\n       v.visit_date as VisitDate,\r\n       group_concat(case a.cause when 70056 then 'Abicavir' when 162298 then 'ACE inhibitors' when 70878 then 'Allopurinol' when 155060 then 'Aminoglycosides' when 162299 then 'ARBs (angiotensin II receptor blockers)' when 103727 then 'Aspirin' when 71647 then 'Atazanavir' when 72822 then 'Carbamazepine' when 162301 then 'Cephalosporins' when 73300 then 'Chloroquine'  when 73667 then 'Codeine' when 74807 then 'Didanosine' when 75523 then 'Efavirenz' when 162302 then 'Erythromycins' when\r\n                        75948 then 'Ethambutol' when 77164 then 'Griseofulvin' when 162305 then 'Heparins' when 77675 then 'Hydralazine' when 78280 then 'Isoniazid' when 794 then 'Lopinavir/ritonavir' when 80106 then 'Morphine' when 80586 then 'Nevirapine' when 80696 then 'Nitrofurans' when 162306 then 'Non-steroidal anti-inflammatory drugs' when 81723 then 'Penicillamine' when 81724 then 'Penicillin' when 81959 then 'Phenolphthaleins' when 82023 then 'Phenytoin' when\r\n                        82559 then 'Procainamide' when 82900 then 'Pyrazinamide' when 83018 then 'Quinidine' when 767 then 'Rifampin' when 162307 then 'Statins' when 84309 then 'Stavudine'\r\n                                 when 162170 then 'Sulfonamides' when 84795 then 'Tenofovir' when 84893 then 'Tetracycline' when 86663 then 'Zidovudine' when 5622 then 'Other' end SEPARATOR '|') as AdverseEventCause,\r\n       group_concat(case a.adverse_event when 1067 then 'Unknown' when  121629  then 'Anaemia' when 148888 then 'Anaphylaxis' when 148787 then 'Angioedema' when 120148 then 'Arrhythmia' when 108 then 'Bronchospasm' when 143264 then 'Cough' when 142412 then 'Diarrhea' when 118773 then 'Dystonia' when 140238 then 'Fever'\r\n                                         when 140039 then 'Flushing' when 139581 then 'GI upset' when 139084 then 'Headache' when 159098 then 'Hepatotoxicity' when 111061 then 'Hives' when 117399 then 'Hypertension' when 879 then 'Itching' when 121677 then 'Mental status change' when 159347 then 'Musculoskeletal pain'\r\n                                         when 121 then 'Myalgia' when 512 then 'Rash' when 5622 then 'Other' end  SEPARATOR '|') as AdverseEvent,\r\n       group_concat(case a.severity when 1498 then 'Mild' when 1499 then 'Moderate' when 1500 then 'Severe' when 162819 then 'Fatal' when 1067 then 'Unknown' end SEPARATOR '|') as Severity,\r\n       group_concat(a.start_date SEPARATOR '|') as AdverseEventStartDate,'' as AdverseEventEndDate,\r\n       group_concat(case a.action_taken when 1257 then 'CONTINUE REGIMEN' when 1259 then 'SWITCHED REGIMEN'  when 981 then 'CHANGED DOSE'  when 1258 then 'SUBSTITUTED DRUG' when 1107 then 'NONE' when 1260 then 'STOP' when 5622 then 'Other' end SEPARATOR '|') as AdverseEventActionTaken,\r\n       '' as AdverseEventClinicalOutcome, '' as AdverseEventIsPregnant, '' as AdverseEventRegimen,\r\n       a.date_created as Date_Created, a.date_last_modified as Date_Last_Modified\r\nfrom kenyaemr_etl.etl_adverse_events a\r\n       inner join  kenyaemr_etl.etl_patient_hiv_followup v on v.encounter_id = a.encounter_id\r\n       inner join kenyaemr_etl.etl_patient_demographics de on v.patient_id = de.patient_id\r\n       inner join (select e.patient_id, max(e.visit_date) as latest_enrolment_date from kenyaemr_etl.etl_hiv_enrollment e group by e.patient_id)e on v.patient_id = e.patient_id\r\n       left join (select d.patient_id as disc_patient,coalesce(max(date(d.effective_discontinuation_date)),date(d.visit_date)) Outcome_date from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                  where program_name='HIV' group by d.patient_id)d on d.disc_patient = v.patient_id\r\n       join kenyaemr_etl.etl_default_facility_info s\r\nwhere d.disc_patient is null or d.Outcome_date < e.latest_enrolment_date group by a.patient_id,a.encounter_id",
                    "rank": 8,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "PatientAdverseEventExtract",
                    "tempTableName": "TempPatientAdverseEventExtract",
                    "id": "a6226eb4-0e85-11e8-ba89-6fb398c5f449",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 6,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "AllergiesChronicIllnessExtract",
                    "display": "Allergies Chronic Illness",
                    "extractSql": "select ci.patient_id                                             as PatientPK,\r\n                         s.siteCode                                                as SiteCode,\r\n                         de.unique_patient_no                                      as PatientID,\r\n                         0                                                         AS FacilityId,\r\n                         'KenyaEMR'                                                as Emr,\r\n                         'Kenya HMIS II'                                           as Project,\r\n                         s.FacilityName                                            as FacilityName,\r\n                         ci.visit_date                                             as VisitDate,\r\n                         ci.visit_id                                               as VisitID,\r\n                         group_concat(case ci.chronic_illness\r\n                                          when 149019 then 'Alzheimers Disease and other Dementias'\r\n                                          when 148432 then 'Arthritis'\r\n                                          when 153754 then 'Asthma'\r\n                                          when 159351 then 'Cancer'\r\n                                          when 119270 then 'Cardiovascular diseases'\r\n                                          when 120637 then 'Chronic Hepatitis'\r\n                                          when 145438 then 'Chronic Kidney Disease'\r\n                                          when 1295 then 'Chronic Obstructive Pulmonary Disease(COPD)'\r\n                                          when 120576 then 'Chronic Renal Failure'\r\n                                          when 119692 then 'Cystic Fibrosis'\r\n                                          when 120291 then 'Deafness and Hearing impairment'\r\n                                          when 119481 then 'Diabetes'\r\n                                          when 118631 then 'Endometriosis'\r\n                                          when 117855 then 'Epilepsy'\r\n                                          when 117789 then 'Glaucoma'\r\n                                          when 139071 then 'Heart Disease'\r\n                                          when 115728 then 'Hyperlipidaemia'\r\n                                          when 117399 then 'Hypertension'\r\n                                          when 117321 then 'Hypothyroidism'\r\n                                          when 151342 then 'Mental illness'\r\n                                          when 133687 then 'Multiple Sclerosis'\r\n                                          when 115115 then 'Obesity'\r\n                                          when 114662 then 'Osteoporosis'\r\n                                          when 117703 then 'Sickle Cell Anaemia'\r\n                                          when 118976 then 'Thyroid disease'\r\n                                          end SEPARATOR\r\n                                      '|')                                         as ChronicIllness,\r\n                         group_concat(ci.chronic_illness_onset_date SEPARATOR '|') as ChronicOnsetDate,\r\n                         (case coalesce(v.has_known_allergies, p.known_allergies)\r\n                              when 1 then 'Yes'\r\n                              when 2\r\n                                  then 'No' end)                                   as knownAllergies,\r\n                         group_concat(case ci.allergy_causative_agent\r\n                                          when 162543 then 'Beef'\r\n                                          when 72609 then 'Caffeine'\r\n                                          when 162544 then 'Chocolate'\r\n                                          when 162545 then 'Dairy Food'\r\n                                          when 162171 then 'Eggs'\r\n                                          when 162546 then 'Fish'\r\n                                          when 162547 then 'Milk Protein'\r\n                                          when 162172 then 'Peanuts'\r\n                                          when 162175 then 'Shellfish'\r\n                                          when 162176 then 'Soy'\r\n                                          when 162548 then 'Strawberries'\r\n                                          when 162177 then 'Wheat'\r\n                                          when 162542 then 'Adhesive Tape'\r\n                                          when 162536 then 'Bee Stings'\r\n                                          when 162537 then 'Dust'\r\n                                          when 162538 then 'Latex'\r\n                                          when 162539 then 'Mold'\r\n                                          when 162540 then 'Pollen'\r\n                                          when 162541 then 'Ragweed'\r\n                                          when 5622 then 'Other'\r\n                                          end SEPARATOR\r\n                                      '|')                                         as AllergyCausativeAgent,\r\n                         group_concat(case ci.allergy_reaction\r\n                                          when 1067 then 'Unknown'\r\n                                          when 121629 then 'Anaemia'\r\n                                          when 148888 then 'Anaphylaxis'\r\n                                          when 148787 then 'Angioedema'\r\n                                          when 120148 then 'Arrhythmia'\r\n                                          when 108 then 'Bronchospasm'\r\n                                          when 143264 then 'Cough'\r\n                                          when 142412 then 'Diarrhea'\r\n                                          when 118773 then 'Dystonia'\r\n                                          when 140238 then 'Fever'\r\n                                          when 140039 then 'Flushing'\r\n                                          when 139581 then 'GI upset'\r\n                                          when 139084 then 'Headache'\r\n                                          when 159098 then 'Hepatotoxicity'\r\n                                          when 111061 then 'Hives'\r\n                                          when 117399 then 'Hypertension'\r\n                                          when 879 then 'Itching'\r\n                                          when 121677 then 'Mental status change'\r\n                                          when 159347 then 'Musculoskeletal pain'\r\n                                          when 121 then 'Myalgia'\r\n                                          when 512 then 'Rash'\r\n                                          when 5622 then 'Other'\r\n                                          end SEPARATOR\r\n                                      '|')                                         as AllergicReaction,\r\n                         group_concat(case ci.allergy_severity\r\n                                          when 160754 then 'Mild'\r\n                                          when 160755 then 'Moderate'\r\n                                          when 160756 then 'Severe'\r\n                                          when 160758 then 'Fatal'\r\n                                          when 1067 then 'Unknown'\r\n                                          end SEPARATOR\r\n                                      '|')                                         as AllergySeverity,\r\n                         group_concat(ci.allergy_onset_date SEPARATOR '|')         as AllergyOnsetDate,\r\n                         ''                                                        as Skin,\r\n                         ''                                                        as Eyes,\r\n                         ''                                                        as ENT,\r\n                         ''                                                        as Chest,\r\n                         ''                                                        as CVS,\r\n                         ''                                                        as Abdomen,\r\n                         ''                                                        as CNS,\r\n                         ''                                                        AS Genitourinary,\r\n                         ci.date_created                                           as Date_Created,\r\n                         max(ci.date_last_modified)                                    as Date_Last_Modified\r\n                  from kenyaemr_etl.etl_allergy_chronic_illness ci\r\n                           left join (select e.patient_id, max(e.visit_date) as latest_enrolment_date\r\n                                      from kenyaemr_etl.etl_hiv_enrollment e\r\n                                      group by e.patient_id) e on ci.patient_id = e.patient_id\r\n                           left join (select pe.patient_id, max(pe.visit_date) as prep_latest_enrolment_date\r\n                                      from kenyaemr_etl.etl_prep_enrolment pe\r\n                                      group by pe.patient_id) pe on ci.patient_id = pe.patient_id\r\n                           left join kenyaemr_etl.etl_patient_hiv_followup v on ci.encounter_id = v.encounter_id\r\n                           left join kenyaemr_etl.etl_prep_followup p on ci.encounter_id = p.encounter_id\r\n                           left join (select d.patient_id as                                                           hiv_disc_patient,\r\n                                             coalesce(max(date(d.effective_discontinuation_date)), date(d.visit_date)) hiv_outcome_date\r\n                                      from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                                      where program_name = 'HIV'\r\n                                      group by d.patient_id) d on d.hiv_disc_patient = ci.patient_id\r\n                           left join (select d.patient_id as         PrEP_disc_patient,\r\n                                             max(date(d.visit_date)) PrEP_Outcome_date\r\n                                      from kenyaemr_etl.etl_prep_discontinuation d\r\n                                      group by d.patient_id) pd on pd.PrEP_disc_patient = ci.patient_id\r\n                           inner join kenyaemr_etl.etl_patient_demographics de on ci.patient_id = de.patient_id\r\n                           join kenyaemr_etl.etl_default_facility_info s\r\n                  where (d.hiv_disc_patient is null\r\n                      or d.hiv_outcome_date < e.latest_enrolment_date)\r\n                     or (pd.PrEP_disc_patient is null or pd.PrEP_Outcome_date < pe.prep_latest_enrolment_date)\r\n                  group by ci.patient_id,ci.visit_date",
                    "rank": 11,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "AllergiesChronicIllnessExtract",
                    "tempTableName": "TempAllergiesChronicIllnessExtract",
                    "id": "2bbeec20-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 92,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "IptExtract",
                    "display": "IPT",
                    "extractSql": "select v.patient_id                                                               as PatientPK,\r\n                                                                                           site.siteCode                                                              as SiteCode,\r\n                                                                                           de.unique_patient_no                                                       as PatientID,\r\n                                                                                           0                                                                          AS FacilityId,\r\n                                                                                           'KenyaEMR'                                                                 as Emr,\r\n                                                                                           'Kenya HMIS II'                                                            as Project,\r\n                                                                                           site.FacilityName                                                          as FacilityName,\r\n                                                                                           coalesce(v.visit_date, s.visit_date)                                       as VisitDate,\r\n                                                                                           coalesce(v.visit_id, s.visit_id)                                           as VisitID,\r\n                                                                                           case v.on_anti_tb_drugs when 1065 then 'Yes' when 1066 then 'No' end       as OnTBDrugs,\r\n                                                                                           case v.on_ipt when 1065 then 'Yes' when 1066 then 'No' end                 as OnIPT,\r\n                                                                                           case v.ever_on_ipt when 1065 then 'Yes' when 1066 then 'No' end            as EverOnIPT,\r\n                                                                                           (case s.cough when 159799 then 'Yes' when 1066 then 'No' end)              as Cough,\r\n                                                                                           (case s.fever when 1494 then 'Yes' when 1066 then 'No' end)                as Fever,\r\n                                                                                           (case s.weight_loss_poor_gain when 832 then 'Yes' when 1066 then 'No' end) as NoticeableWeightLoss,\r\n                                                                                           (case s.night_sweats when 133027 then 'Yes' when 1066 then 'No' end)       as NightSweats,\r\n                                                                                           (case s.lethargy when 116334 then 'Yes' when 1066 then 'No' end)           as Lethargy,\r\n                                                                                           concat_ws('|', case v.spatum_smear_ordered when 307 then 'Sputum smear' end,\r\n                                                                                                     case v.chest_xray_ordered when 12 then 'Chest Xray' end,\r\n                                                                                                     case v.genexpert_ordered when 162202 then 'GeneXpert' end)         as ICFActionTaken,\r\n                                                                                           concat_ws('|', case v.spatum_smear_result\r\n                                                                                                              when 703 then 'Positive'\r\n                                                                                                              when 664 then 'Negative' end, case v.chest_xray_result\r\n                                                                                                                                                when 1115 then 'Normal'\r\n                                                                                                                                                when 152526 then 'Abnormal' end,\r\n                                                                                                     case v.genexpert_result\r\n                                                                                                         when 162203 then 'Mycobacterium Tuberculosis detected with Rifampicin resistance'\r\n                                                                                                         when 664 then 'Negative'\r\n                                                                                                         when 162204 then 'Mycobacterium Tuberculosis detected without Rifampicin resistance'\r\n                                                                                                         when 164104 then 'Mycobacterium tuberculosis detected with indeterminate rifampin resistance'\r\n                                                                                                         when 163611 then 'Invalid'\r\n                                                                                                         when 1138 then 'Indeterminate' end)                          as TestResult,\r\n                                                                                           (case v.clinical_tb_diagnosis\r\n                                                                                                when 703 then 'Positive'\r\n                                                                                                when 664 then 'Negative' end)                                         as TBClinicalDiagnosis,\r\n                                                                                           (case v.contact_invitation when 1065 then 'Yes' when 1066 then 'No' end)   as ContactsInvited,\r\n                                                                                           (case v.evaluated_for_ipt when 1065 then 'Yes' when 1066 then 'No' end)    as EvaluatedForIPT,\r\n                                                                                           (case started_anti_TB when 1065 then 'Yes' when 1066 then 'No' end)        as StartAntiTBs,\r\n                                                                                           v.tb_rx_date                                                               as TBRxStartDate,\r\n                                                                                           (case v.tb_status\r\n                                                                                                when 1660 then 'No Signs'\r\n                                                                                                when 142177 then 'Presumed TB'\r\n                                                                                                when 1662 then 'TB Confirmed'\r\n                                                                                                when 160737 then 'TB Screening not done' end)                         as TBScreening,\r\n                                                                                           s.IPTClientWorkUp                                                          as IPTClientWorkUp,\r\n                                                                                           (case ifnull(i.isStarted, '') when '' then 'No' else 'Yes' end)            as StartIPT,\r\n                                                                                           if(ifnull(i.IndicationForIPT, ''), '', i.IndicationForIPT)                 as IndicationForIPT,\r\n                                                                                           d.IPT_disc_reason                                                          as IPTDiscontinuation,\r\n                                                                                           d.Outcome_date                                                             as DateOfDiscontinuation,\r\n                                                                                           v.date_created                                                             as Date_Created,\r\n                                                                                           v.date_last_modified                                                       as Date_Last_Modified\r\n                                                                                    from kenyaemr_etl.etl_patient_hiv_followup v\r\n                                                                                             inner join kenyaemr_etl.etl_patient_demographics de on v.patient_id = de.patient_id\r\n                                                                                             inner join (select a.patient_id\r\n                                                                                                         from (select e.patient_id, max(e.visit_date) as latest_enrolment_date\r\n                                                                                                               from kenyaemr_etl.etl_hiv_enrollment e\r\n                                                                                                               group by e.patient_id) a\r\n                                                                                                                  left join (select d.patient_id as              disc_patient,\r\n                                                                                                                                    coalesce(max(date(d.effective_discontinuation_date)),\r\n                                                                                                                                             date(d.visit_date)) Outcome_date\r\n                                                                                                                             from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                                                                                                                             where program_name = 'HIV'\r\n                                                                                                                             group by d.patient_id) d on a.patient_id = d.disc_patient\r\n                                                                                                         where d.disc_patient is null\r\n                                                                                                            or d.Outcome_date < a.latest_enrolment_date\r\n                                                                                                         group by a.patient_id) e on v.patient_id = e.patient_id\r\n                                                                                             left join (select s.patient_id                                                            as patient_id,\r\n                                                                                                                s.visit_date                                                            as visit_date,\r\n                                                                                                                s.visit_id                                                              as visit_id,\r\n                                                                                                                s.cough,\r\n                                                                                                                s.fever,\r\n                                                                                                                s.weight_loss_poor_gain,\r\n                                                                                                                s.night_sweats,\r\n                                                                                                                s.lethargy,\r\n                                                                                                                concat_ws('|', (case Ifnull(s.yellow_urine, '')\r\n                                                                                                                                    when 162311 then 'Yes'\r\n                                                                                                                                    when 1066 then 'No' end), (case ifnull(s.numbness_bs_hands_feet, '')\r\n                                                                                                                                                                   when 132652 then 'Yes'\r\n                                                                                                                                                                   when 1066 then 'No' end),\r\n                                                                                                                          (case ifnull(s.eyes_yellowness, '')\r\n                                                                                                                               when 5192 then 'Yes'\r\n                                                                                                                               when 1066 then 'No' end), (case ifnull(s.upper_rightQ_abdomen_tenderness, '')\r\n                                                                                                                                                              when 124994 then 'Yes'\r\n                                                                                                                                                              when 1066 then 'No' end)) as IPTClientWorkUp\r\n                                                                                                         from kenyaemr_etl.etl_ipt_screening s) s on v.patient_id = s.patient_id and v.visit_date = s.visit_date\r\n                                                                                             left join (select i.patient_id                                         as isStarted,\r\n                                                                                                               (case i.ipt_indication\r\n                                                                                                                    when 138571 then 'PLHIV'\r\n                                                                                                                    when 162277 then 'Prison setting'\r\n                                                                                                                    when 162278 then 'Household contact'\r\n                                                                                                                    when 1555 then 'HCW and other Facility staff'\r\n                                                                                                                    when 5619 then 'Other clinical risk group' end) as IndicationForIPT\r\n                                                                                                        from kenyaemr_etl.etl_ipt_initiation i) i on v.patient_id = i.isStarted\r\n                                                                                             left join (select o.patient_id                    as disc_patient,\r\n                                                                                                               max(date(o.visit_date))            Outcome_date,\r\n                                                                                                               case mid(max(concat(o.visit_date, o.outcome)), 11)\r\n                                                                                                                   when 1267 then 'Treatment completed'\r\n                                                                                                                   when 5240 then 'Lost to followup'\r\n                                                                                                                   when 159836 then 'Discontinued'\r\n                                                                                                                   when 160034 then 'Died'\r\n                                                                                                                   when 159492 then 'Transferred out'\r\n                                                                                                                   when 112141 then 'Active TB Disease'\r\n                                                                                                                   when 102 then 'Adverse drug reaction'\r\n                                                                                                                   when 159598 then 'Poor adherence'\r\n                                                                                                                   when 5622 then 'Others' end as IPT_disc_reason\r\n                                                                                                        from kenyaemr_etl.etl_ipt_outcome o\r\n                                                                                                        group by o.patient_id\r\n                                                                                    ) d on d.disc_patient = v.patient_id\r\n                                                                                             join kenyaemr_etl.etl_default_facility_info site\r\n                                                                                    where de.unique_patient_no is not null\r\n                                                                                    group by v.encounter_id",
                    "rank": 12,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "IptExtract",
                    "tempTableName": "TempIptExtract",
                    "id": "2bbeec21-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 17741,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "DepressionScreeningExtract",
                    "display": "Depression Screening",
                    "extractSql": "select v.patient_id as PatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\ts.siteCode as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\tde.unique_patient_no as PatientID,\r\n\t\t\t\t\t\t\t\t\t\t\t0 AS FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR' as Emr,'Kenya HMIS II' as Project,s.FacilityName as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\tv.visit_id as VisitID,v.visit_date as VisitDate,\r\n\t\t\t\t\t\t\t\t\t\t\t'' as PHQ9_1,'' as PHQ9_2,'' as PHQ9_3,'' as PHQ9_4,'' as PHQ9_5,'' as PHQ9_6,'' as PHQ9_7,'' as PHQ9_8,'' as PHQ9_9,'' as DepressionAssesmentScore,\r\n\t\t\t\t\t\t\t\t\t\t\t(case v.PHQ_9_rating when 1115 then 'Depression unlikely' when 157790 then 'Mild depression'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 134011 then 'Moderate depression' when 134017 then 'Moderate severe depression' when 126627 then 'Severe depression' end) as PHQ_9_rating,\r\n\t\t\t\t\t\t\t\t\t\t\tv.date_created as Date_Created, v.date_last_modified as Date_Last_Modified\r\n\t\t\t\tfrom kenyaemr_etl.etl_depression_screening v\r\n\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics de on v.patient_id = de.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tinner join (select e.patient_id, max(e.visit_date) as latest_enrolment_date from kenyaemr_etl.etl_hiv_enrollment e group by e.patient_id)e on v.patient_id = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tleft join (select d.patient_id as disc_patient,coalesce(max(date(d.effective_discontinuation_date)),date(d.visit_date)) Outcome_date from kenyaemr_etl.etl_patient_program_discontinuation d\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere program_name='HIV' group by d.patient_id)d on d.disc_patient = v.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info s\r\n\t\t\t\twhere d.disc_patient is null or d.Outcome_date < e.latest_enrolment_date",
                    "rank": 13,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "DepressionScreeningExtract",
                    "tempTableName": "TempDepressionScreeningExtract",
                    "id": "2bbeec22-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 157,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "ContactListingExtract",
                    "display": "Contact Listing",
                    "extractSql": "select v.patient_related_to as PatientPK,\r\n                                                            v.patient_id as ContactPatientPK,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ts.siteCode as SiteCode,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tde.unique_patient_no as PatientID,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'KenyaEMR' as Emr,'Kenya HMIS II' as Project,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0 AS FacilityId,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ts.FacilityName as FacilityName,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.patient_id as PartnerPersonID,timestampdiff(YEAR,date(v.birth_date),current_date()) as ContactAge,v.sex as ContactSex,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case v.marital_status when 1057 then 'Single' when 5555 then 'Married Monogamous' when 159715 then 'Married Polygamous'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1058 then 'Divorced' when 1059 then 'Widowed' end)  as ContactMaritalStatus,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(case v.relationship_type when 970 then 'Mother' when 971 then 'Father' when 972 then 'Sibling' when 1528 then 'Child' when 5617 then 'Spouse'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 163565 then 'Partner' when 162221 then 'Co-wife' when 157351 then 'Injectable drug user'end) as RelationshipWithPatient,if(v.ipv_outcome is not null,'Yes','No') as ScreenedForIpv,'' as IpvScreening,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.ipv_outcome as IPVScreeningOutcome,(case v.living_with_patient when 1065 then 'Yes' when 1066 then 'No' else '' end) as CurrentlyLivingWithIndexClient,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.baseline_hiv_status as KnowledgeOfHivStatus, (case v.pns_approach when 162284 then 'Dual referral' when 160551 then 'Passive referral' when 161642 then 'Contract referral' when 163096 then 'Provider referral'  else '' end) as PnsApproach,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.date_created as Date_Created, v.date_last_modified as Date_Last_Modified\r\n\t\t\t\t\t\t\t\tfrom kenyaemr_etl.etl_patient_contact v\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join kenyaemr_etl.etl_patient_demographics de on v.patient_related_to = de.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinner join (select e.patient_id, max(e.visit_date) as latest_enrolment_date from kenyaemr_etl.etl_hiv_enrollment e group by e.patient_id)e on v.patient_related_to = e.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tleft join (select d.patient_id as disc_patient,coalesce(max(date(d.effective_discontinuation_date)),date(d.visit_date)) Outcome_date from kenyaemr_etl.etl_patient_program_discontinuation d\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhere program_name='HIV' group by d.patient_id)d on d.disc_patient = v.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info s\r\n\t\t\t\t\t\t\t\twhere d.disc_patient is null or d.Outcome_date < e.latest_enrolment_date",
                    "rank": 14,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "ContactListingExtract",
                    "tempTableName": "TempContactListingExtract",
                    "id": "2bbeec23-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 22,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "GbvScreeningExtract",
                    "display": "GBV Screening",
                    "extractSql": "select v.patient_id                                                           as PatientPK,\r\n                     s.siteCode                                                             as SiteCode,\r\n                     0                                                                      AS FacilityId,\r\n                     de.unique_patient_no                                                   as PatientID,\r\n                     'KenyaEMR'                                                             as Emr,\r\n                     'Kenya HMIS II'                                                        as Project,\r\n                     s.FacilityName                                                         as FacilityName,\r\n                     v.visit_id                                                             as VisitID,\r\n                     v.visit_date                                                           as VisitDate,\r\n                     (case v.ipv when 1065 then 'Yes' when 1066 then 'No' end)              as IPV,\r\n                     (case v.physical_ipv when 158358 then 'Yes' when 1066 then 'No' end)   as PhysicalIPV,\r\n                     (case v.emotional_ipv when 118688 then 'Yes' when 1066 then 'No' end)  as EmotionalIPV,\r\n                     (case v.sexual_ipv when 152370 then 'Yes' when 1066 then 'No' end)     as SexualIPV,\r\n                     (case v.ipv_relationship when 1582 then 'Yes' when 1066 then 'No' end) as IPVRelationship,\r\n                     v.date_created                                                         as Date_Created,\r\n                     v.date_last_modified                                                   as Date_Last_Modified\r\n              from kenyaemr_etl.etl_gbv_screening v\r\n                       inner join kenyaemr_etl.etl_patient_demographics de on v.patient_id = de.patient_id\r\n                       inner join (select e.patient_id, max(e.visit_date) as latest_enrolment_date\r\n                                   from kenyaemr_etl.etl_hiv_enrollment e\r\n                                   group by e.patient_id) e on e.patient_id = v.patient_id\r\n                       left join (select d.patient_id as                                                           disc_patient,\r\n                                         coalesce(max(date(d.effective_discontinuation_date)), date(d.visit_date)) Outcome_date\r\n                                  from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                                  where program_name = 'HIV'\r\n                                  group by d.patient_id) d on d.disc_patient = v.patient_id\r\n                       join kenyaemr_etl.etl_default_facility_info s\r\n              where d.disc_patient is null\r\n                 or d.Outcome_date < e.latest_enrolment_date",
                    "rank": 15,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "GbvScreeningExtract",
                    "tempTableName": "TempGbvScreeningExtract",
                    "id": "2bbeec24-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 3563,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "EnhancedAdherenceCounsellingExtract",
                    "display": "Enhanced Adherence Counselling",
                    "extractSql": "select v.patient_id as PatientPK,\r\n       s.siteCode as SiteCode,\r\n       de.unique_patient_no as PatientID,\r\n       'KenyaEMR' as Emr,\r\n       'Kenya HMIS II' as Project,\r\n       0 AS FacilityId,\r\n       s.FacilityName as FacilityName,\r\n       v.visit_id as VisitID,v.visit_date as VisitDate,v.session_number as SessionNumber,v.first_session_date as DateOfFirstSession,v.pill_count as PillCountAdherence,\r\n       '' as MMAS4_1,'' as MMAS4_2,'' as MMAS4_3,'' as MMAS4_4,'' as MMSA8_1,'' as MMSA8_2,'' as MMSA8_3,'' as MMSA8_4,\r\n       v.arv_adherence as MMSAScore ,v.has_vl_results as EACRecievedVL, v.vl_results_suppressed as EACVL,v.vl_results_feeling as EACVLConcerns,\r\n       v.cause_of_high_vl as EACVLThoughts,v.way_forward as EACWayForward,v.patient_hiv_knowledge as EACCognitiveBarrier,v.patient_drugs_uptake as EACBehaviouralBarrier_1,\r\n       v.patient_drugs_reminder_tools as EACBehaviouralBarrier_2,v.patient_drugs_uptake_during_travels as EACBehaviouralBarrier_3,v.patient_drugs_side_effects_response as EACBehaviouralBarrier_4,\r\n       v.patient_drugs_uptake_most_difficult_times as EACBehaviouralBarrier_5,v.patient_drugs_daily_uptake_feeling as EACEmotionalBarriers_1,v.patient_ambitions as EACEmotionalBarriers_2,\r\n       v.patient_has_people_to_talk as EACEconBarrier_1,v.patient_enlisting_social_support as EACEconBarrier_2,v.patient_income_sources as EACEconBarrier_3,v.patient_challenges_reaching_clinic as EACEconBarrier_4,\r\n       v.patient_worried_of_accidental_disclosure as EACEconBarrier_5, v.patient_treated_differently as EACEconBarrier_6,v.stigma_hinders_adherence as EACEconBarrier_7,v.patient_tried_faith_healing as EACEconBarrier_8,\r\n       v.patient_adherence_improved as EACReviewImprovement,v.patient_doses_missed as EACReviewMissedDoses,v.review_and_barriers_to_adherence as EACReviewStrategy,v.other_referrals as EACReferral,\r\n       v.appointments_honoured as EACReferralApp,v.referral_experience as EACReferralExperience,v.home_visit_benefit as EACHomevisit,v.adherence_plan as EACAdherencePlan,v.next_appointment_date as EACFollowupDate,\r\n       v.date_created as Date_Created, v.date_last_modified as Date_Last_Modified\r\n\t\t\tfrom kenyaemr_etl.etl_enhanced_adherence v\r\n       inner join kenyaemr_etl.etl_patient_demographics de on v.patient_id = de.patient_id\r\n       inner join (select e.patient_id, max(e.visit_date) as latest_enrolment_date from kenyaemr_etl.etl_hiv_enrollment e group by e.patient_id)e on v.patient_id = e.patient_id\r\n       left join (select d.patient_id as disc_patient,coalesce(max(date(d.effective_discontinuation_date)),date(d.visit_date)) Outcome_date from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                  where program_name='HIV' group by d.patient_id)d on d.disc_patient = v.patient_id\r\n       join kenyaemr_etl.etl_default_facility_info s\r\nwhere d.disc_patient is null or d.Outcome_date < e.latest_enrolment_date",
                    "rank": 16,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "EnhancedAdherenceCounsellingExtract",
                    "tempTableName": "TempEnhancedAdherenceCounsellingExtract",
                    "id": "2bbeec25-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 26,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "DrugAlcoholScreeningExtract",
                    "display": "Drug and Alcohol Screening",
                    "extractSql": "select v.patient_id as PatientPK,\r\n       s.siteCode as SiteCode,\r\n       de.unique_patient_no as PatientID,\r\n       'KenyaEMR' as Emr,'Kenya HMIS II' as Project,\r\n       s.FacilityName as FacilityName,\r\n       0 AS FacilityId,\r\n       v.visit_id as VisitID,v.visit_date as VisitDate,\r\n       (case v.alcohol_drinking_frequency when 1090 then 'Never' when 1091 then 'Monthly or less' when 1092 then '2 to 4 times a month' when 1093 then '2 to 3 times a week' when 1094 then '4 or More Times a Week' end) as DrinkingAlcohol,\r\n       (case v.smoking_frequency when 1090 then 'Never smoked' when 156358 then 'Former cigarette smoker' when 163197 then 'Current some day smoker' when 163196 then 'Current light tobacco smoker'\r\n                                 when 163195 then 'Current heavy tobacco smoker' when 163200 then 'Unknown if ever smoked' end) as Smoking,\r\n       (case v.drugs_use_frequency when 1090 then 'Never' when 1091 then 'Monthly or less' when 1092 then '2 to 4 times a month' when 1093 then '2 to 3 times a week' when 1094 then '4 or More Times a Week' end) as DrugUse,\r\n       v.date_created as Date_Created, v.date_last_modified as Date_Last_Modified\r\n\t\tfrom kenyaemr_etl.etl_alcohol_drug_abuse_screening v\r\n       inner join kenyaemr_etl.etl_patient_demographics de on v.patient_id = de.patient_id\r\n       inner join (select e.patient_id, max(e.visit_date) as latest_enrolment_date from kenyaemr_etl.etl_hiv_enrollment e group by e.patient_id)e on v.patient_id = e.patient_id\r\n       left join (select d.patient_id as disc_patient,coalesce(max(date(d.effective_discontinuation_date)),date(d.visit_date)) Outcome_date from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                  where program_name='HIV' group by d.patient_id)d on d.disc_patient = v.patient_id\r\n       join kenyaemr_etl.etl_default_facility_info s\r\nwhere d.disc_patient is null or d.Outcome_date < e.latest_enrolment_date",
                    "rank": 17,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "DrugAlcoholScreeningExtract",
                    "tempTableName": "TempDrugAlcoholScreeningExtract",
                    "id": "2bbeec26-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 3454,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "OvcExtract",
                    "display": "OVC",
                    "extractSql": "select v.patient_id as PatientPK,0 AS FacilityId,s.siteCode as SiteCode,de.unique_patient_no as PatientID,'KenyaEMR' as Emr,'Kenya HMIS II' as Project,s.FacilityName as FacilityName,\r\n       v.encounter_id as VisitID,v.visit_date as VisitDate,v.visit_date as OVCEnrollmentDate,coalesce(v.relationship_to_client,r.b_is_to_a) as RelationshipToClient,\r\n       de.CPIMS_unique_identifier as CPIMSUniqueIdentifier,v.partner_offering_ovc as PartnerOfferingOVCServices,v.client_enrolled_cpims as EnrolledinCPIMS,\r\n       concat_ws(',',NULLIF(if(v.ovc_comprehensive_program='Yes','OVC Comprehensive',''),''),\r\n                 NULLIF(if(v.dreams_program='Yes','DREAMS',''),''),\r\n                 NULLIF(if(v.ovc_preventive_program='Yes','OVC Preventive',''),'')) as ProgramModel,d.attrition_reason as OVCExitReason, d.Outcome_date as ExitDate, v.date_created as Date_Created, greatest(v.date_last_modified,v.date_last_modified) as Date_Last_Modified\r\nfrom kenyaemr_etl.etl_ovc_enrolment v\r\n       inner join kenyaemr_etl.etl_patient_demographics de on v.patient_id = de.patient_id\r\n       left join (SELECT r.person_b,r.person_a,t.a_is_to_b,t.b_is_to_a FROM openmrs.relationship r inner join openmrs.relationship_type t on r.relationship = t.relationship_type_id where r.voided =0)r on v.patient_id = r.person_b\r\n       left join (select d.patient_id,coalesce(max(date(d.effective_discontinuation_date)),date(d.visit_date)) Outcome_date,(case mid(max(concat(date(d.visit_date),d.discontinuation_reason)),11) when 160036 then 'Transfer out to a PEPFAR supported facility' when 159492 then 'Transfer out to a non PEPFAR supported facility'\r\n                                                                                                                                                                                                   when 165219 then 'Exit without graduation' when 1267 then 'Graduated out of OVC' when 160034 then 'Died' end ) as attrition_reason from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                  where program_name='OVC' group by d.patient_id)d on d.patient_id = v.patient_id\r\n       join kenyaemr_etl.etl_default_facility_info s",
                    "rank": 18,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "OvcExtract",
                    "tempTableName": "TempOvcExtract",
                    "id": "2bbeec27-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 29,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "OtzExtract",
                    "display": "OTZ",
                    "extractSql": "select a.patient_id as PatientPK,0 AS FacilityId,s.siteCode as SiteCode,de.unique_patient_no as PatientID,'KenyaEMR' as Emr,'Kenya HMIS II' as Project,s.FacilityName as FacilityName,\r\n       a.visit_id as VisitID,a.visit_date as VisitDate,e.OTZEnrollmentDate,e.TransferInStatus, e.ModulesPreviouslyCovered\r\n    ,concat_ws(',',NULLIF(if(a.orientation='Yes','OTZ Orientation',null),''),NULLIF(if(a.participation='Yes','OTZ Participation',''),''),NULLIF(if(a.making_decision_future='Yes','OTZ Making decisions for the future',''),'')\r\n       ,NULLIF(if(a.transition_to_adult_care='Yes','OTZ Transition to Adult care',''),''),NULLIF(if(a.treatment_literacy='Yes','OTZ Treatment literacy',''),''),NULLIF(if(a.srh='Yes','OTZ SRH',''),''),NULLIF(if(a.leadership='Yes','Leadership',''),''),\r\n               NULLIF(if(a.beyond_third_ninety='Yes','OTZ Beyond the 3rd 90',null),'')) as ModulesCompletedToday,a.attended_support_group as SupportGroupInvolvement,\r\n       a.remarks as Remarks,d.attrition_reason as TransitionAttritionReason, d.Outcome_date as OutcomeDate, a.date_created as Date_Created, greatest(NULLIF(a.date_last_modified,'0000-00-00'),NULLIF(a.date_last_modified,'0000-00-00')) as Date_Last_Modified\r\nfrom kenyaemr_etl.etl_otz_activity a\r\n       inner join kenyaemr_etl.etl_patient_demographics de on a.patient_id = de.patient_id\r\n       inner join (select e.patient_id, greatest(max(e.visit_date),'0000-00-00') as OTZEnrollmentDate,mid(max(concat(e.visit_date,e.transfer_in)),11) as TransferInStatus,\r\n                          concat_ws(',',NULLIF(if(e.orientation='Yes','OTZ Orientation',null),''),NULLIF(if(e.participation='Yes','OTZ Participation',''),''),NULLIF(if(e.making_decision_future='Yes','OTZ Making decisions for the future',''),''),\r\n                                    NULLIF(if(e.transition_to_adult_care='Yes','OTZ Transition to Adult care',''),''),NULLIF(if(e.treatment_literacy='Yes','OTZ Treatment literacy',''),''),NULLIF(if(e.srh='Yes','OTZ SRH',''),''),\r\n                                    NULLIF(if(e.beyond_third_ninety='Yes','OTZ Beyond the 3rd 90',null),'')) as ModulesPreviouslyCovered,e.date_created as date_created, e.date_last_modified as date_last_modified\r\n                   from kenyaemr_etl.etl_otz_enrollment e group by e.patient_id)e on a.patient_id = e.patient_id\r\n       left join (select d.patient_id,coalesce(max(date(d.effective_discontinuation_date)),date(d.visit_date)) Outcome_date,(case mid(max(concat(date(d.visit_date),d.discontinuation_reason)),11) when 5240 then 'LTFU' when 159492 then 'Transfer Out'\r\n                                                                                                                                                                                                   when 160034 then 'Died' when 159836 then 'Opt out of OTZ' when 165363 then 'Transition to Adult Care' end ) as attrition_reason from kenyaemr_etl.etl_patient_program_discontinuation d\r\n                  where program_name='OTZ' group by d.patient_id)d on d.patient_id = a.patient_id\r\n       join kenyaemr_etl.etl_default_facility_info s",
                    "rank": 19,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "OtzExtract",
                    "tempTableName": "TempOtzExtract",
                    "id": "2bbeec28-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 81,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "CovidExtract",
                    "display": "Covid",
                    "extractSql": "select d.patient_id                                                                  PatientPK,\r\n       i.siteCode                                                                    SiteCode,\r\n       d.unique_patient_no                                                           PatientID,\r\n       'KenyaEMR'                                                                    Emr,\r\n       'Kenya HMIS II'                                                               Project,\r\n       i.facilityName                                                                FacilityName,\r\n       0 as                                                                          FacilityId,\r\n       a.visit_id                                                                    VisitID,\r\n       a.visit_date                                                                  Covid19AssessmentDate,\r\n       if(a.final_vaccination_status in (166192, 5585), 'Yes', 'No')               as ReceivedCOVID19Vaccine,\r\n       a.first_dose_date                                                          as DateGivenFirstDose,\r\n       (case a.first_vaccine_type\r\n            when 166156 then 'Astrazeneca'\r\n            when 166355 then 'Johnson and Johnson'\r\n            when 166154 then 'Moderna'\r\n            when 166155 then 'Pfizer'\r\n            when 166157 then 'Sputnik'\r\n            when 166379 then 'Sinopharm'\r\n            when 1067 then 'Unknown'\r\n            when 5622\r\n                then 'Other' end)                                               as FirstDoseVaccineAdministered,\r\n       a.second_dose_date                                                         as DateGivenSecondDose,\r\n       (case a.second_vaccine_type\r\n            when 166156 then 'Astrazeneca'\r\n            when 166355 then 'Johnson and Johnson'\r\n            when 166154 then 'Moderna'\r\n            when 166155 then 'Pfizer'\r\n            when 166157 then 'Sputnik'\r\n            when 166379 then 'Sinopharm'\r\n            when 1067 then 'Unknown'\r\n            when 5622\r\n                then 'Other' end)                                               as SecondDoseVaccineAdministered,\r\n       (case a.final_vaccination_status\r\n            when 166192 then 'Partially Vaccinated'\r\n            when 5585 then 'Fully Vaccinated'\r\n            else 'Not Vaccinated' end)                                              as VaccinationStatus,\r\n       (case a.first_vaccination_verified when 164134 then 'Yes' else 'No' end)   as VaccineVerification,\r\n       (case a.second_vaccination_verified when 164134 then 'Yes' else 'No' end)  as VaccineVerificationSecondDose,\r\n       (case a.ever_received_booster\r\n            when 1065 then 'Yes'\r\n            when 1066 then 'No' end)                                                as BoosterGiven,\r\n       (case a.booster_vaccine_taken\r\n            when 166156 then 'Astrazeneca'\r\n            when 166355 then 'Johnson and Johnson'\r\n            when 166154 then 'Moderna'\r\n            when 166155 then 'Pfizer'\r\n            when 166157 then 'Sputnik'\r\n            when 166379 then 'Sinopharm'\r\n            when 1067 then 'Unknown'\r\n            when 5622 then 'Other(Specify)' end)                                  as BoosterDose,\r\n       a.date_taken_booster_vaccine                                               as BoosterDoseDate,\r\n       a.booster_sequence                                                         as Sequence,\r\n       (case a.ever_tested_covid_19_positive\r\n            when 703 then 'Yes'\r\n            when 664 then 'No'\r\n            when 1067 then 'Unknown' end)                                         as EverCOVID19Positive,\r\n       (case a.ever_tested_covid_19_positive\r\n            when 703 then 'Yes'\r\n            when 664 then 'No'\r\n            when 1067 then 'Unknown' end)                                         as COVID19TestResult,\r\n       (case booster_dose_verified when 164134 then 'Yes' end)                    as BoosterDoseVerified,\r\n       a.date_tested_positive                                                     as COVID19TestDate,\r\n       (case a.symptomatic\r\n            when 1068 then 'Symptomatic'\r\n            when 165912 then 'Asymptomatic' END)                                            as PatientStatus,\r\n       (case a.hospital_admission\r\n            when 1065 then 'Yes'\r\n            when 1066 then 'No' end)                                              as AdmissionStatus,\r\n       a.admission_unit                                                           as AdmissionUnit,\r\n       ''                                                                         as MissedAppointmentDueToCOVID19,\r\n       ''                                                                         as COVID19PositiveSinceLasVisit,\r\n       ''                                                                         as COVID19TestDateSinceLastVisit,\r\n       ''                                                                         as PatientStatusSinceLastVisit,\r\n       ''                                                                         as AdmissionStatusSinceLastVisit,\r\n       ''                                                                         as AdmissionStartDate,\r\n       ''                                                                         as AdmissionEndDate,\r\n       ''                                                                         as AdmissionUnitSinceLastVisit,\r\n       (case a.on_oxygen_supplement when 1065 then 'Yes' when 1066 then 'No' end) as SupplementalOxygenReceived,\r\n       (case a.on_ventillator when 1065 then 'Yes' when 1066 then 'No' end)       as PatientVentilated,\r\n       a.date_created                                                             as Date_Created,\r\n       a.date_last_modified                                                       as Date_Last_Modified,\r\n       '' as TracingFinalOutcome,\r\n       '' as CauseOfDeath\r\nfrom kenyaemr_etl.etl_patient_demographics d\r\n         join kenyaemr_etl.etl_covid19_assessment a on d.patient_id = a.patient_id\r\n         join kenyaemr_etl.etl_default_facility_info i\r\n\t\t\t\t\t\t\t\t\tgroup by a.visit_id",
                    "rank": 20,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "CovidExtract",
                    "tempTableName": "TempCovidExtract",
                    "id": "2bbeec30-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 1051,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            },
            {
                "databaseProtocol": {
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "extracts": [],
                    "databaseType": 2,
                    "host": "127.0.0.1",
                    "port": 3309,
                    "username": "dwapi",
                    "password": "dwapi",
                    "databaseName": "openmrs",
                    "advancedProperties": "Allow User Variables=True",
                    "databaseTypeName": "MySQL",
                    "diffSqlCheck": "\r\n                     select date_last_modified from kenyaemr_etl.etl_patient_demographics \r\n                     limit 1\r\n                     ",
                    "diffSupport": true,
                    "supportsDifferential": true,
                    "id": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b"
                },
                "extract": {
                    "destination": "dwhstage",
                    "emrSystemId": "a6221856-0e85-11e8-ba89-0ed5f89f718b",
                    "docketId": "NDWH",
                    "databaseProtocolId": "a6221aa4-0e85-11e8-ba89-0ed5f89f718b",
                    "name": "DefaulterTracingExtract",
                    "display": "Defaulter Tracing",
                    "extractSql": "select d.patient_id                                                              PatientPK,\r\n       i.siteCode                                                                SiteCode,\r\n\t\t\t\t\t\t\t\t\td.unique_patient_no                                                       PatientID,\r\n\t\t\t\t\t\t\t\t\t'KenyaEMR'                                                                Emr,\r\n\t\t\t\t\t\t\t\t\t'Kenya HMIS II'                                                           Project,\r\n\t\t\t\t\t\t\t\t\ti.facilityName                                                            FacilityName,\r\n\t\t\t\t\t\t\t\t\t0 as                                                                          FacilityId,\r\n\t\t\t\t\t\t\t\t\tf.visit_id                                                                VisitID,\r\n\t\t\t\t\t\t\t\t\tf.visit_date                                                              VisitDate,\r\n\t\t\t\t\t\t\t\t\tf.encounter_id                                                         as EncounterId,\r\n\t\t\t\t\t\t\t\t\t(case f.tracing_type\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1650 then 'Client Called'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 164965 then 'Physical Tracing'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 161642 then 'Treatment supporter' end)                         as TracingType,\r\n\t\t\t\t\t\t\t\t\t(case f.tracing_outcome\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1267 then 'Contact'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1118 then 'No contact' end)                                    as TracingOutcome,\r\n\t\t\t\t\t\t\t\t\tf.attempt_number                                                       as AttemptNumber,\r\n\t\t\t\t\t\t\t\t\t(case f.is_final_trace when 1267 then 'Yes' when 163339 then 'No' end) as IsFinalTrace,\r\n\t\t\t\t\t\t\t\t\t(case f.tracing_outcome\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 165610 then 'COVID19 Positive'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160432 then 'Dead'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1693 then 'Receiving ART from another clinic/Transferred'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 160037 then 'Still in care at CCC'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5240 then 'Lost to follow up'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 164435 then 'Stopped treatment' end)                           as TrueStatus,\r\n\t\t\t\t\t\t\t\t\t(case f.cause_of_death\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 165609 then 'Infection due to COVID-19'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 162574 then 'Death related to HIV infection'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 116030 then 'Cancer'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 164500 then 'TB'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 151522 then 'Other infectious and parasitic diseases'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 133481 then 'Natural cause'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 1603 then 'Unnatural Cause'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen 5622 then 'Unknown cause' end)                                 as CauseOfDeath,\r\n\t\t\t\t\t\t\t\t\tf.comments                                                             as Comments,\r\n\t\t\t\t\t\t\t\t\tdate(f.booking_date)                                                   as BookingDate,\r\n\t\t\t\t\t\t\t\t\tf.date_created                                                         as Date_Created,\r\n\t\t\t\t\t\t\t\t\tf.date_last_modified                                                   as Date_Last_Modified\r\n\t\tfrom kenyaemr_etl.etl_patient_demographics d\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_ccc_defaulter_tracing f on d.patient_id = f.patient_id\r\n\t\t\t\t\t\t\t\t\t\t\tjoin kenyaemr_etl.etl_default_facility_info i\r\n\t\tgroup by f.visit_id",
                    "rank": 21,
                    "isPriority": false,
                    "emr": null,
                    "mainName": "TempPatientExtracts",
                    "tableName": "DefaulterTracingExtract",
                    "tempTableName": "TempDefaulterTracingExtract",
                    "id": "2bbeec31-7754-11eb-9439-0242ac130002",
                    "extractEvent": {
                        "lastStatus": "Found",
                        "found": 16,
                        "loaded": 0,
                        "rejected": 0,
                        "queued": 0,
                        "sent": 0
                    }
                }
            }
        ]
    },
    "extractMpi": null,
    "loadMpi": false,
    "emrSetup": 0
}
